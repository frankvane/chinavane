var N=Object.defineProperty;var w=(r,t,i)=>t in r?N(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i;var g=(r,t,i)=>w(r,typeof t!="symbol"?t+"":t,i);import{r as x,j as e}from"./index-C7SuDyTR.js";import{C as E}from"./ComponentTemplate-BzrYXZsv.js";class C{constructor(){g(this,"state",{errors:[],visibleErrors:[],totalCount:0});g(this,"listeners",new Set);g(this,"maxCacheSize",6);g(this,"maxVisibleSize",3);g(this,"autoHideTimer",new Map)}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notify(){this.listeners.forEach(t=>t(this.state))}addError(t){const i=this.generateErrorKey(t.message,t.type,t.source),a=this.state.errors.find(l=>this.generateErrorKey(l.message,l.type,l.source)===i);if(a)a.count+=1,a.timestamp=Date.now(),this.resetAutoHideTimer(a.id);else{const l={...t,id:`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),count:1};if(this.state.errors.push(l),this.state.totalCount+=1,this.state.errors.length>this.maxCacheSize){const c=this.state.errors.shift();c&&this.clearAutoHideTimer(c.id)}this.setAutoHideTimer(l.id)}this.updateVisibleErrors(),this.notify()}generateErrorKey(t,i,a){return`${i}_${a||"unknown"}_${t}`}updateVisibleErrors(){const t=[...this.state.errors].sort((i,a)=>{const l={error:3,warning:2,info:1},c=l[i.type],m=l[a.type];return c!==m?m-c:a.timestamp-i.timestamp});this.state.visibleErrors=t.slice(0,this.maxVisibleSize)}setAutoHideTimer(t){const i=setTimeout(()=>{this.removeError(t)},5e3);this.autoHideTimer.set(t,i)}resetAutoHideTimer(t){this.clearAutoHideTimer(t),this.setAutoHideTimer(t)}clearAutoHideTimer(t){const i=this.autoHideTimer.get(t);i&&(clearTimeout(i),this.autoHideTimer.delete(t))}removeError(t){const i=this.state.errors.findIndex(a=>a.id===t);i!==-1&&(this.state.errors.splice(i,1),this.clearAutoHideTimer(t),this.updateVisibleErrors(),this.notify())}clearAll(){this.state.errors.forEach(t=>{this.clearAutoHideTimer(t.id)}),this.state.errors=[],this.state.visibleErrors=[],this.notify()}getState(){return{...this.state}}setConfig(t){if(t.maxCacheSize!==void 0)for(this.maxCacheSize=t.maxCacheSize;this.state.errors.length>this.maxCacheSize;){const i=this.state.errors.shift();i&&this.clearAutoHideTimer(i.id)}t.maxVisibleSize!==void 0&&(this.maxVisibleSize=t.maxVisibleSize),this.updateVisibleErrors(),this.notify()}}const p=new C,v=x.createContext(null),S=({children:r})=>{const[t,i]=x.useState(p.getState());return x.useEffect(()=>{const a=p.subscribe(i);return()=>{a()}},[]),e.jsx(v.Provider,{value:{state:t,addError:a=>p.addError(a),removeError:a=>p.removeError(a),clearAll:()=>p.clearAll(),setConfig:a=>p.setConfig(a)},children:r})},f=()=>{const r=x.useContext(v);if(!r)throw new Error("useErrorQueue must be used within ErrorQueueProvider");return r},A=()=>{const{state:r,addError:t,removeError:i,clearAll:a}=f(),l=()=>{t({message:"网络请求失败，请检查网络连接",type:"error",source:"API"})},c=()=>{t({message:"数据加载较慢，请耐心等待",type:"warning",source:"Performance"})},m=()=>{t({message:"操作已成功完成",type:"info",source:"User Action"})},n=()=>{t({message:"网络请求失败，请检查网络连接",type:"error",source:"API"})},b=o=>{switch(o){case"error":return"❌";case"warning":return"⚠️";case"info":return"ℹ️";default:return"📝"}},j=o=>{switch(o){case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"错误队列操作"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsx("button",{onClick:l,className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors",children:"添加错误"}),e.jsx("button",{onClick:c,className:"px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition-colors",children:"添加警告"}),e.jsx("button",{onClick:m,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"添加信息"}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-red-400 text-white rounded hover:bg-red-500 transition-colors",children:"重复错误"}),e.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"清除所有"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"队列状态"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"总错误数"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.errors.length})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"显示错误数"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.visibleErrors.length})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"累计总数"}),e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:r.totalCount})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"当前错误列表"}),r.errors.length===0?e.jsx("div",{className:"text-gray-500 text-center py-8",children:"暂无错误消息"}):e.jsx("div",{className:"space-y-2",children:r.errors.map((o,y)=>e.jsx("div",{className:`p-3 rounded-lg border ${j(o.type)} ${r.visibleErrors.includes(o)?"ring-2 ring-blue-300":"opacity-60"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-2 flex-1",children:[e.jsx("span",{className:"text-lg",children:b(o.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:o.message}),e.jsxs("div",{className:"text-xs opacity-75 mt-1",children:["来源: ",o.source," | 类型: ",o.type,o.count>1&&` | 重复 ${o.count} 次`]}),e.jsxs("div",{className:"text-xs opacity-75",children:["时间: ",new Date(o.timestamp).toLocaleTimeString()]}),r.visibleErrors.includes(o)&&e.jsx("div",{className:"text-xs text-blue-600 font-medium mt-1",children:"✓ 当前显示"})]})]}),e.jsx("button",{onClick:()=>i(o.id),className:"ml-2 text-gray-400 hover:text-gray-600 transition-colors",title:"删除",children:"✕"})]})},o.id))})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"功能说明"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• 错误会按类型优先级排序：错误 > 警告 > 信息"}),e.jsx("li",{children:"• 相同错误会合并显示，并显示重复次数"}),e.jsx("li",{children:"• 最多缓存6条错误，显示3条错误（带蓝色边框）"}),e.jsx("li",{children:"• 错误会在5秒后自动清除"}),e.jsx("li",{children:"• 点击右上角 ✕ 可手动删除单个错误"})]})]})]})},P=()=>{const{state:r,addError:t,clearAll:i,setConfig:a}=f(),[l,c]=x.useState(6),[m,n]=x.useState(3),b=()=>{a({maxCacheSize:l,maxVisibleSize:m})},j=()=>{const s=["error","warning","info"],d=["API","Validation","System","User"],u=["网络连接失败","数据验证错误","系统资源不足","用户权限不足","文件上传失败","数据库连接超时","缓存清理完成","配置更新成功"];for(let h=0;h<8;h++)setTimeout(()=>{t({message:u[h],type:s[h%3],source:d[h%4]})},h*200)},o=s=>{switch(s){case"error":return"❌";case"warning":return"⚠️";case"info":return"ℹ️";default:return"📝"}},y=s=>{switch(s){case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"队列配置"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["最大缓存数量: ",l]}),e.jsx("input",{type:"range",min:"3",max:"10",value:l,onChange:s=>c(Number(s.target.value)),className:"w-full"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"控制系统最多保存多少条错误消息"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["最大显示数量: ",m]}),e.jsx("input",{type:"range",min:"1",max:"6",value:m,onChange:s=>n(Number(s.target.value)),className:"w-full"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"控制同时显示多少条错误消息"})]})]}),e.jsxs("div",{className:"mt-4 space-x-3",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"应用配置"}),e.jsx("button",{onClick:j,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors",children:"添加多个错误"}),e.jsx("button",{onClick:i,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"清除所有"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"当前状态"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"缓存错误"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.errors.length})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"显示错误"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.visibleErrors.length})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"缓存限制"}),e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:l})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"显示限制"}),e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:m})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"错误列表（按优先级排序）"}),r.errors.length===0?e.jsx("div",{className:"text-gray-500 text-center py-8",children:"暂无错误消息"}):e.jsx("div",{className:"space-y-2",children:r.errors.map((s,d)=>{const u=r.visibleErrors.includes(s);return e.jsx("div",{className:`p-3 rounded-lg border ${y(s.type)} ${u?"ring-2 ring-green-300 shadow-md":"opacity-50"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start space-x-2 flex-1",children:[e.jsx("span",{className:"text-lg",children:o(s.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.message}),e.jsxs("div",{className:"text-xs opacity-75 mt-1",children:["来源: ",s.source," | 类型: ",s.type,s.count>1&&` | 重复 ${s.count} 次`]}),e.jsxs("div",{className:"text-xs opacity-75",children:["时间: ",new Date(s.timestamp).toLocaleTimeString()]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded ${u?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:u?"✓ 显示中":"隐藏"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["排序位置: #",d+1]})]})]})]})})},s.id)})})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"配置说明"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"缓存数量"}),"：控制系统最多保存多少条错误，超出时删除最旧的"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"显示数量"}),"：控制同时在界面上显示多少条错误"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"优先级排序"}),"：错误 > 警告 > 信息，相同类型按时间排序"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"实时调整"}),"：配置变更后立即生效，现有错误会重新排序"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"超出处理"}),"：当错误数量超出限制时，自动移除优先级低的旧错误"]})]})]})]})},T=({position:r="top-right",showCount:t=!0})=>{const{state:i,removeError:a}=f(),l={"top-right":"top-4 right-4","top-left":"top-4 left-4","bottom-right":"bottom-4 right-4","bottom-left":"bottom-4 left-4"},c=n=>{switch(n){case"error":return"❌";case"warning":return"⚠️";case"info":return"ℹ️";default:return"📝"}},m=n=>{switch(n){case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}};return i.visibleErrors.length===0?null:e.jsx("div",{className:`fixed ${l[r]} z-50 space-y-2 max-w-sm`,children:i.visibleErrors.map(n=>e.jsx("div",{className:`p-3 rounded-lg border shadow-lg transition-all duration-300 ${m(n.type)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-2 flex-1",children:[e.jsx("span",{className:"text-lg",children:c(n.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:n.message}),n.source&&e.jsxs("div",{className:"text-xs opacity-75 mt-1",children:["来源: ",n.source]}),t&&n.count>1&&e.jsxs("div",{className:"text-xs opacity-75 mt-1",children:["重复 ",n.count," 次"]}),e.jsx("div",{className:"text-xs opacity-75 mt-1",children:new Date(n.timestamp).toLocaleTimeString()})]})]}),e.jsx("button",{onClick:()=>a(n.id),className:"ml-2 text-gray-400 hover:text-gray-600 transition-colors",title:"关闭",children:"✕"})]})},n.id))})},k=()=>{const{state:r,addError:t}=f(),[i,a]=x.useState(!1),[l,c]=x.useState({username:"",email:"",password:""}),m=async()=>{a(!0),await new Promise(u=>setTimeout(u,1e3));const s=[{message:"服务器连接超时，请稍后重试",type:"error",source:"API",details:{endpoint:"/api/users",status:408}},{message:"用户认证失败，请重新登录",type:"error",source:"Auth",details:{code:"AUTH_FAILED"}},{message:"数据库连接异常",type:"error",source:"Database",details:{error:"Connection timeout"}}],d=s[Math.floor(Math.random()*s.length)];t(d),a(!1)},n=()=>{const s=[];l.username.trim()?l.username.length<3&&s.push({message:"用户名至少需要3个字符",type:"warning",source:"Validation",details:{field:"username",minLength:3}}):s.push({message:"用户名不能为空",type:"warning",source:"Validation",details:{field:"username"}}),l.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email)||s.push({message:"请输入有效的邮箱地址",type:"warning",source:"Validation",details:{field:"email",pattern:"email"}}):s.push({message:"邮箱地址不能为空",type:"warning",source:"Validation",details:{field:"email"}}),l.password.trim()?l.password.length<6&&s.push({message:"密码至少需要6个字符",type:"warning",source:"Validation",details:{field:"password",minLength:6}}):s.push({message:"密码不能为空",type:"warning",source:"Validation",details:{field:"password"}}),s.forEach(d=>t(d)),s.length===0&&t({message:"表单验证通过",type:"info",source:"Validation",details:{status:"success"}})},b=()=>{const s=[{message:"CPU使用率过高 (85%)",type:"warning",source:"System Monitor",details:{metric:"cpu",value:85,threshold:80}},{message:"内存使用率达到警告线 (78%)",type:"warning",source:"System Monitor",details:{metric:"memory",value:78,threshold:75}},{message:"磁盘空间不足 (92%)",type:"error",source:"System Monitor",details:{metric:"disk",value:92,threshold:90}}],d=s[Math.floor(Math.random()*s.length)];t(d)},j=()=>{const s=[{message:"文件上传成功",type:"info",source:"File Upload",details:{fileName:"document.pdf",size:"2.3MB"}},{message:"设置已保存",type:"info",source:"Settings",details:{section:"preferences"}},{message:"数据同步完成",type:"info",source:"Sync",details:{records:156,duration:"2.3s"}}],d=s[Math.floor(Math.random()*s.length)];t(d)},o=s=>{switch(s){case"error":return"❌";case"warning":return"⚠️";case"info":return"ℹ️";default:return"📝"}},y=s=>{switch(s){case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-red-800",children:"API请求错误"}),e.jsx("p",{className:"text-sm text-red-700 mb-4",children:"模拟网络请求、认证失败、服务器错误等场景"}),e.jsx("button",{onClick:m,disabled:i,className:"w-full px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors disabled:opacity-50",children:i?"请求中...":"模拟API错误"})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-yellow-800",children:"表单验证"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",placeholder:"用户名",value:l.username,onChange:s=>c(d=>({...d,username:s.target.value})),className:"w-full px-3 py-2 border rounded text-sm"}),e.jsx("input",{type:"email",placeholder:"邮箱地址",value:l.email,onChange:s=>c(d=>({...d,email:s.target.value})),className:"w-full px-3 py-2 border rounded text-sm"}),e.jsx("input",{type:"password",placeholder:"密码",value:l.password,onChange:s=>c(d=>({...d,password:s.target.value})),className:"w-full px-3 py-2 border rounded text-sm"}),e.jsx("button",{onClick:n,className:"w-full px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition-colors",children:"验证表单"})]})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-orange-800",children:"系统监控"}),e.jsx("p",{className:"text-sm text-orange-700 mb-4",children:"模拟CPU、内存、磁盘等系统资源监控警告"}),e.jsx("button",{onClick:b,className:"w-full px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 transition-colors",children:"模拟系统警告"})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-blue-800",children:"用户操作反馈"}),e.jsx("p",{className:"text-sm text-blue-700 mb-4",children:"模拟文件上传、设置保存、数据同步等操作反馈"}),e.jsx("button",{onClick:j,className:"w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"模拟操作反馈"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"错误统计"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"错误总数"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.errors.filter(s=>s.type==="error").length})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"警告总数"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:r.errors.filter(s=>s.type==="warning").length})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"信息总数"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.errors.filter(s=>s.type==="info").length})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"显示中"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.visibleErrors.length})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"错误详情（按优先级排序）"}),r.errors.length===0?e.jsx("div",{className:"text-gray-500 text-center py-8",children:"暂无错误消息"}):e.jsx("div",{className:"space-y-2",children:r.errors.map(s=>{const d=r.visibleErrors.includes(s);return e.jsx("div",{className:`p-4 rounded-lg border ${y(s.type)} ${d?"ring-2 ring-green-300 shadow-md":"opacity-60"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("span",{className:"text-lg",children:o(s.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.message}),e.jsxs("div",{className:"text-sm opacity-75 mt-1",children:[e.jsx("span",{className:"font-medium",children:"来源:"})," ",s.source,s.count>1&&e.jsxs("span",{className:"ml-2",children:[e.jsx("span",{className:"font-medium",children:"重复:"})," ",s.count," 次"]})]}),s.details&&e.jsxs("div",{className:"text-xs bg-black bg-opacity-10 p-2 rounded mt-2",children:[e.jsx("span",{className:"font-medium",children:"详细信息:"}),e.jsx("pre",{className:"mt-1",children:JSON.stringify(s.details,null,2)})]}),e.jsx("div",{className:"text-xs opacity-75 mt-1",children:new Date(s.timestamp).toLocaleString()}),d&&e.jsx("div",{className:"text-xs text-green-600 font-medium mt-1",children:"✓ 当前显示"})]})]})},s.id)})})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"实际应用场景"}),e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"API错误"}),"：网络请求失败、服务器错误、认证问题等"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"表单验证"}),"：用户输入验证、数据格式检查等"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"系统监控"}),"：资源使用率、性能指标、系统状态等"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"用户反馈"}),"：操作成功、状态更新、进度通知等"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"优先级管理"}),"：错误 ",">"," 警告 ",">"," ","信息，确保重要消息优先显示"]})]})]})]})},V=[{title:"核心概念",items:["错误队列：统一管理应用中的错误消息","智能去重：相同错误自动合并，显示重复次数","优先级排序：错误 > 警告 > 信息，确保重要信息优先显示","自动清理：设定时间后自动移除错误消息"]},{title:"主要优势",items:["统一的错误处理机制，避免错误信息散乱","智能去重减少重复信息干扰","可配置的队列大小和显示策略","实时状态监控和管理"]},{title:"适用场景",items:["API请求错误处理","表单验证错误展示","系统监控警告","用户操作反馈"]},{title:"注意事项",items:["合理设置队列大小，避免内存占用过多","根据业务需求调整自动清理时间","注意错误消息的分类和优先级设置"]}],z=()=>e.jsx(E,{title:"错误队列管理",description:"智能错误消息队列系统，支持去重、优先级排序、自动清理等功能",overview:V,examples:[{title:"基础错误队列",component:e.jsx(A,{}),description:"演示基本的错误添加、去重和清理功能",observationPoints:["点击不同类型的错误按钮，观察错误消息的显示效果","测试去重机制，连续添加相同错误时会合并显示","观察队列状态的实时更新","错误消息会在5秒后自动清理"],keyPoints:["错误消息支持error、warning、info三种类型","相同的错误会自动去重，显示重复次数","队列状态包含总数、缓存数、显示数等信息","支持手动清除单个或所有错误"],commonTraps:["频繁添加错误可能导致性能问题","错误消息过长可能影响显示效果","未正确设置错误类型导致优先级混乱"],solutions:["使用防抖机制控制错误添加频率","限制错误消息长度或使用省略号","明确定义错误类型的使用场景"]},{title:"配置管理",component:e.jsx(P,{}),description:"动态配置队列大小和显示数量",observationPoints:["调整最大缓存数量，观察队列容量变化","修改最大显示数量，查看界面显示效果","填充队列测试配置限制","观察错误优先级排序效果"],keyPoints:["maxCacheSize控制队列最大容量","maxVisibleSize控制同时显示的错误数量","配置变更会立即生效","超出限制的错误会被自动移除"],commonTraps:["设置过小的缓存大小导致重要错误丢失","显示数量过多影响用户体验","配置参数不合理导致功能异常"],solutions:["根据应用规模合理设置缓存大小","显示数量建议控制在3-5个","添加配置参数验证"]},{title:"实际应用场景",component:e.jsx(k,{}),description:"模拟真实应用中的各种错误场景",observationPoints:["API请求失败时的错误处理","表单验证错误的批量显示","系统监控警告的实时展示","用户操作成功的信息反馈"],keyPoints:["不同场景使用不同的错误类型","错误消息包含详细的上下文信息","支持异步错误处理","可以记录错误的来源和详细信息"],importantTips:["API错误应包含请求URL和状态码","表单验证错误要指明具体字段","系统警告要包含具体的指标数值","用户操作信息要简洁明了"]}],tutorial:{concepts:["错误队列是一个统一管理应用错误消息的系统","支持error、warning、info三种错误类型","具备智能去重功能，相同错误会自动合并","按优先级和时间进行排序显示","支持自动清理和手动管理","可配置队列大小和显示策略"],steps:["导入ErrorQueueProvider并包装应用根组件","使用useErrorQueue Hook获取队列操作方法","调用addError方法添加错误消息","使用ErrorDisplay组件显示错误列表","根据需要配置队列参数","实现错误处理的业务逻辑"],tips:["合理设置错误类型，确保优先级正确","错误消息要简洁明了，包含必要信息","使用source字段标识错误来源","定期清理过期错误，避免内存泄漏","在关键操作中添加错误处理","考虑用户体验，避免错误信息过多"]},interview:{questions:[{question:"错误队列的去重机制是如何实现的？",answer:"通过生成错误键（包含消息、类型、来源）来识别相同错误，相同错误会增加计数而不是创建新条目，同时更新时间戳并重置自动清理定时器。"},{question:"如何处理错误队列的内存管理？",answer:"设置maxCacheSize限制队列大小，超出限制时按优先级和时间排序移除最旧的低优先级错误，同时清理对应的定时器避免内存泄漏。"},{question:"错误优先级排序的策略是什么？",answer:"按类型优先级排序（error > warning > info），相同类型按时间戳排序（新的在前），确保重要错误优先显示。"},{question:"如何实现错误的自动清理？",answer:"为每个错误设置setTimeout定时器，在指定时间后自动调用removeError方法，同时维护定时器映射表便于管理和清理。"}],keyPoints:["错误队列使用观察者模式实现状态同步","去重机制基于错误特征生成唯一键","优先级排序确保重要信息优先显示","自动清理机制防止错误堆积","配置化设计支持不同场景需求","Context API提供全局状态管理"]},bestPractices:{dos:["为不同类型的错误设置合适的优先级","在错误消息中包含足够的上下文信息","合理设置队列大小和自动清理时间","使用source字段标识错误来源","在关键业务流程中添加错误处理","定期监控错误队列的状态和性能"],donts:["不要在错误消息中包含敏感信息","不要设置过小的队列大小导致错误丢失","不要忽略错误的分类和优先级","不要在高频操作中直接添加错误","不要让错误队列无限增长","不要在错误处理中再次抛出错误"],patterns:["使用工厂模式创建不同类型的错误","采用观察者模式实现状态同步","使用策略模式处理不同的错误场景","实现装饰器模式增强错误信息","使用单例模式管理全局错误队列","采用责任链模式处理错误传播"]}}),M=()=>e.jsx(S,{children:e.jsxs("div",{className:"relative",children:[e.jsx(T,{position:"top-right",showCount:!0}),e.jsx(z,{})]})});export{M as default};
