var K=Object.defineProperty;var _=(d,n,r)=>n in d?K(d,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):d[n]=r;var y=(d,n,r)=>_(d,typeof n!="symbol"?n+"":n,r);import{r as m,j as e}from"./index-C7SuDyTR.js";import{C as Q}from"./ComponentTemplate-BzrYXZsv.js";var l=(d=>(d.CONNECTING="connecting",d.CONNECTED="connected",d.CLOSED="closed",d.ERROR="error",d))(l||{});class W{constructor(n){y(this,"eventSource",null);y(this,"config");y(this,"state",l.CLOSED);y(this,"eventListeners",new Map);y(this,"stateListeners",[]);y(this,"errorListeners",[]);y(this,"stats",{totalEvents:0,eventsByType:{},connectionTime:0,lastEventTime:0,reconnectCount:0});y(this,"reconnectTimer",null);y(this,"reconnectAttempts",0);this.config={withCredentials:!1,reconnectInterval:3e3,maxReconnectAttempts:5,eventTypes:["message"],...n}}connect(){if(!(this.state===l.CONNECTED||this.state===l.CONNECTING)){this.setState(l.CONNECTING),this.stats.connectionTime=Date.now();try{this.eventSource=new EventSource(this.config.url,{withCredentials:this.config.withCredentials}),this.setupEventListeners()}catch(n){this.handleError(n)}}}setupEventListeners(){var n;this.eventSource&&(this.eventSource.onopen=()=>{this.setState(l.CONNECTED),this.reconnectAttempts=0,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)},this.eventSource.onerror=r=>{this.handleError(r)},this.eventSource.onmessage=r=>{this.handleEvent({id:r.lastEventId,type:"message",data:this.parseEventData(r.data),timestamp:Date.now()})},(n=this.config.eventTypes)==null||n.forEach(r=>{r!=="message"&&this.eventSource&&this.eventSource.addEventListener(r,x=>{this.handleEvent({id:x.lastEventId,type:r,data:this.parseEventData(x.data),timestamp:Date.now()})})}))}handleEvent(n){this.stats.totalEvents++,this.stats.lastEventTime=n.timestamp,this.stats.eventsByType[n.type]=(this.stats.eventsByType[n.type]||0)+1,(this.eventListeners.get(n.type)||[]).forEach(u=>{try{u(n)}catch(N){console.error("Error in event listener:",N)}}),(this.eventListeners.get("*")||[]).forEach(u=>{try{u(n)}catch(N){console.error("Error in event listener:",N)}})}parseEventData(n){try{return JSON.parse(n)}catch{return n}}handleError(n){this.setState(l.ERROR),this.errorListeners.forEach(r=>{try{r(n)}catch(x){console.error("Error in error listener:",x)}}),this.attemptReconnect()}attemptReconnect(){if(this.reconnectAttempts>=(this.config.maxReconnectAttempts||5)){this.setState(l.CLOSED);return}this.reconnectAttempts++,this.stats.reconnectCount++;const n=this.config.reconnectInterval*Math.pow(2,this.reconnectAttempts-1);this.reconnectTimer=setTimeout(()=>{this.disconnect(),this.connect()},n)}subscribe(n,r){return this.eventListeners.has(n)||this.eventListeners.set(n,[]),this.eventListeners.get(n).push(r),()=>{const x=this.eventListeners.get(n);if(x){const u=x.indexOf(r);u>-1&&x.splice(u,1)}}}onStateChange(n){return this.stateListeners.push(n),()=>{const r=this.stateListeners.indexOf(n);r>-1&&this.stateListeners.splice(r,1)}}onError(n){return this.errorListeners.push(n),()=>{const r=this.errorListeners.indexOf(n);r>-1&&this.errorListeners.splice(r,1)}}disconnect(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.setState(l.CLOSED),this.reconnectAttempts=0}setState(n){this.state!==n&&(this.state=n,this.stateListeners.forEach(r=>{try{r(n)}catch(x){console.error("Error in state listener:",x)}}))}getState(){return this.state}getStats(){return{...this.stats}}resetStats(){this.stats={totalEvents:0,eventsByType:{},connectionTime:Date.now(),lastEventTime:0,reconnectCount:0}}isConnected(){return this.state===l.CONNECTED}getConnectionDuration(){return this.stats.connectionTime===0?0:Date.now()-this.stats.connectionTime}}class q{constructor(){y(this,"isRunning",!1);y(this,"eventInterval",null);y(this,"eventTypes",["message","notification","update","alert","metrics","log"]);y(this,"listeners",[])}start(){this.isRunning||(this.isRunning=!0,this.eventInterval=setInterval(()=>{this.generateRandomEvent()},2e3))}stop(){this.isRunning=!1,this.eventInterval&&(clearInterval(this.eventInterval),this.eventInterval=null)}generateRandomEvent(){const n=this.eventTypes[Math.floor(Math.random()*this.eventTypes.length)],r={id:Date.now().toString(),type:n,data:this.generateEventData(n),timestamp:Date.now()};this.listeners.forEach(x=>x(r))}generateEventData(n){switch(n){case"metrics":return{cpu:Math.random()*100,memory:Math.random()*100,disk:Math.random()*100,network:Math.random()*1e3};case"log":const r=["info","warn","error","debug"],x=["User login successful","Database connection established","Cache miss for key: user_123","API request completed","Background job started"];return{level:r[Math.floor(Math.random()*r.length)],message:x[Math.floor(Math.random()*x.length)],source:"system"};case"alert":const u=["low","medium","high","critical"],N=[{title:"High CPU Usage",description:"CPU usage exceeded 80%"},{title:"Memory Warning",description:"Memory usage is high"},{title:"Disk Space Low",description:"Disk space below 10%"},{title:"Network Latency",description:"High network latency detected"}],i=N[Math.floor(Math.random()*N.length)];return{severity:u[Math.floor(Math.random()*u.length)],...i,source:"monitor"};default:return{message:`Random ${n} event`,value:Math.random()*100,status:Math.random()>.5?"success":"warning"}}}onEvent(n){return this.listeners.push(n),()=>{const r=this.listeners.indexOf(n);r>-1&&this.listeners.splice(r,1)}}sendCustomEvent(n,r){const x={id:Date.now().toString(),type:n,data:r,timestamp:Date.now()};this.listeners.forEach(u=>u(x))}isActive(){return this.isRunning}}const V=()=>{const[d,n]=m.useState(l.CLOSED),[r,x]=m.useState([]),[u,N]=m.useState({totalEvents:0,eventsByType:{},connectionTime:0,lastEventTime:0,reconnectCount:0}),[i,w]=m.useState(!1),[S,O]=m.useState([]),[C,$]=m.useState("custom"),[T,k]=m.useState('{"message": "Hello from client!"}'),o=m.useRef(null),g=m.useRef(null);m.useEffect(()=>{g.current=new q,o.current=new W({url:"/api/sse",reconnectInterval:3e3,maxReconnectAttempts:5,eventTypes:["message","notification","update","alert","metrics","log","custom"]});const a=o.current,f=a.onStateChange(s=>{n(s),h(`连接状态变更: ${s}`)}),R=a.subscribe("*",s=>{x(t=>[s,...t.slice(0,49)]),N(a.getStats()),h(`接收到事件: ${s.type}`)}),J=a.onError(s=>{h(`连接错误: ${s.type}`)}),M=g.current.onEvent(s=>{a.isConnected()&&a.handleEvent(s)});return()=>{var s;f(),R(),J(),M(),a.disconnect(),(s=g.current)==null||s.stop()}},[]);const h=a=>{const f=new Date().toLocaleTimeString();O(R=>[`[${f}] ${a}`,...R.slice(0,19)])},p=()=>{g.current&&(g.current.start(),w(!0),h("模拟服务器已启动"))},j=()=>{g.current&&(g.current.stop(),w(!1),h("模拟服务器已停止"),o.current&&o.current.disconnect())},P=()=>{o.current&&i?(o.current.connect(),h("尝试建立SSE连接")):h("请先启动模拟服务器")},A=()=>{o.current&&(o.current.disconnect(),h("断开SSE连接"))},H=()=>{if(g.current&&i)try{const a=JSON.parse(T);g.current.sendCustomEvent(C,a),h(`发送自定义事件: ${C}`)}catch{h("自定义事件数据格式错误")}else h("服务器未运行，无法发送事件")},U=()=>{x([]),o.current&&(o.current.resetStats(),N(o.current.getStats())),h("事件历史已清空")},L=a=>{switch(a){case l.CONNECTED:return"text-green-600";case l.CONNECTING:return"text-yellow-600";case l.ERROR:return"text-red-600";default:return"text-gray-600"}},B=a=>{switch(a){case l.CONNECTED:return"🟢";case l.CONNECTING:return"🟡";case l.ERROR:return"🔴";default:return"⚪"}},G=a=>({message:"bg-blue-100 text-blue-800",notification:"bg-green-100 text-green-800",update:"bg-yellow-100 text-yellow-800",alert:"bg-red-100 text-red-800",metrics:"bg-purple-100 text-purple-800",log:"bg-gray-100 text-gray-800",custom:"bg-indigo-100 text-indigo-800"})[a]||"bg-gray-100 text-gray-800";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"模拟服务器控制"}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`text-sm font-medium ${i?"text-green-600":"text-gray-600"}`,children:i?"🟢 运行中":"⚪ 已停止"})}),e.jsx("button",{onClick:p,disabled:i,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"启动服务器"}),e.jsx("button",{onClick:j,disabled:!i,className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"停止服务器"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"SSE连接状态"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"连接状态:"}),e.jsxs("span",{className:`text-sm font-medium ${L(d)}`,children:[B(d)," ",d]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"总事件数:"}),e.jsx("span",{className:"text-sm",children:u.totalEvents})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"重连次数:"}),e.jsx("span",{className:"text-sm",children:u.reconnectCount})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"连接时长:"}),e.jsxs("span",{className:"text-sm",children:[o.current?Math.floor(o.current.getConnectionDuration()/1e3):0,"秒"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"最后事件:"}),e.jsx("span",{className:"text-sm",children:u.lastEventTime?new Date(u.lastEventTime).toLocaleTimeString():"无"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:P,disabled:d===l.CONNECTED||d===l.CONNECTING,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"连接SSE"}),e.jsx("button",{onClick:A,disabled:d===l.CLOSED,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"断开连接"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"发送自定义事件"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"事件类型:"}),e.jsx("input",{type:"text",value:C,onChange:a=>$(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"输入事件类型"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"事件数据 (JSON):"}),e.jsx("textarea",{value:T,onChange:a=>k(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"输入JSON格式的事件数据"})]}),e.jsx("button",{onClick:H,disabled:!i,className:"px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"发送事件"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"事件历史"}),e.jsx("button",{onClick:U,className:"px-3 py-1 bg-gray-500 text-white rounded hover:bg-gray-600",children:"清空历史"})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:r.length===0?e.jsx("div",{className:"text-gray-500 text-center py-8",children:"暂无事件数据"}):r.map((a,f)=>e.jsxs("div",{className:"border border-gray-200 rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${G(a.type)}`,children:a.type}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(a.timestamp).toLocaleTimeString()})]}),a.id&&e.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:["ID: ",a.id]}),e.jsx("div",{className:"text-sm",children:e.jsx("pre",{className:"whitespace-pre-wrap text-xs bg-gray-50 p-2 rounded",children:JSON.stringify(a.data,null,2)})})]},`${a.timestamp}-${f}`))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"操作日志"}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:S.length===0?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"暂无日志"}):S.map((a,f)=>e.jsx("div",{className:"text-sm text-gray-700 font-mono",children:a},f))})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-blue-800",children:"功能特性"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-700",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"连接管理:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• 自动重连机制"}),e.jsx("li",{children:"• 连接状态监控"}),e.jsx("li",{children:"• 错误处理和恢复"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"事件处理:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• 多种事件类型支持"}),e.jsx("li",{children:"• JSON数据自动解析"}),e.jsx("li",{children:"• 事件历史记录"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"统计信息:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• 事件计数统计"}),e.jsx("li",{children:"• 连接时长监控"}),e.jsx("li",{children:"• 重连次数记录"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"模拟功能:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• 模拟SSE服务器"}),e.jsx("li",{children:"• 自定义事件发送"}),e.jsx("li",{children:"• 实时事件生成"})]})]})]})]})]})},X=()=>{const[d,n]=m.useState(l.CLOSED),[r,x]=m.useState([]),[u,N]=m.useState([]),[i,w]=m.useState({enabledTypes:new Set(["message","notification","update","alert","metrics","log"]),maxEvents:50,timeRange:0}),[S,O]=m.useState(!1),[C,$]=m.useState([]),[T,k]=m.useState({}),o=m.useRef(null),g=m.useRef(null),h=["message","notification","update","alert","metrics","log","custom"];m.useEffect(()=>{g.current=new q,o.current=new W({url:"/api/sse",reconnectInterval:3e3,maxReconnectAttempts:5,eventTypes:h});const s=o.current,t=s.onStateChange(b=>{n(b),p(`连接状态变更: ${b}`)}),c=s.subscribe("*",b=>{x(I=>[b,...I.slice(0,199)]),k(I=>({...I,[b.type]:(I[b.type]||0)+1})),p(`接收到事件: ${b.type}`)}),D=g.current.onEvent(b=>{s.isConnected()&&s.handleEvent(b)});return()=>{var b;t(),c(),D(),s.disconnect(),(b=g.current)==null||b.stop()}},[]),m.useEffect(()=>{let s=r.filter(t=>!(!i.enabledTypes.has(t.type)||i.timeRange&&i.timeRange>0&&Date.now()-t.timestamp>i.timeRange*60*1e3));s.length>i.maxEvents&&(s=s.slice(0,i.maxEvents)),N(s)},[r,i]);const p=s=>{const t=new Date().toLocaleTimeString();$(c=>[`[${t}] ${s}`,...c.slice(0,19)])},j=()=>{g.current&&(g.current.start(),O(!0),p("模拟服务器已启动"))},P=()=>{g.current&&(g.current.stop(),O(!1),p("模拟服务器已停止"),o.current&&o.current.disconnect())},A=()=>{o.current&&S?(o.current.connect(),p("尝试建立SSE连接")):p("请先启动模拟服务器")},H=()=>{o.current&&(o.current.disconnect(),p("断开SSE连接"))},U=s=>{w(t=>{const c=new Set(t.enabledTypes);return c.has(s)?c.delete(s):c.add(s),{...t,enabledTypes:c}})},L=()=>{w(s=>({...s,enabledTypes:new Set(h)}))},B=()=>{w(s=>({...s,enabledTypes:new Set}))},G=()=>{x([]),N([]),k({}),p("事件历史已清空")},a=s=>({message:"bg-blue-100 text-blue-800 border-blue-200",notification:"bg-green-100 text-green-800 border-green-200",update:"bg-yellow-100 text-yellow-800 border-yellow-200",alert:"bg-red-100 text-red-800 border-red-200",metrics:"bg-purple-100 text-purple-800 border-purple-200",log:"bg-gray-100 text-gray-800 border-gray-200",custom:"bg-indigo-100 text-indigo-800 border-indigo-200"})[s]||"bg-gray-100 text-gray-800 border-gray-200",f=s=>{switch(s){case l.CONNECTED:return"text-green-600";case l.CONNECTING:return"text-yellow-600";case l.ERROR:return"text-red-600";default:return"text-gray-600"}},R=s=>{switch(s){case l.CONNECTED:return"🟢";case l.CONNECTING:return"🟡";case l.ERROR:return"🔴";default:return"⚪"}},J=(s,t)=>t>0?Math.round(s/t*100):0,M=Object.values(T).reduce((s,t)=>s+t,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"服务器控制"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`text-sm font-medium ${S?"text-green-600":"text-gray-600"}`,children:S?"🟢 运行中":"⚪ 已停止"})}),e.jsx("button",{onClick:j,disabled:S,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50",children:"启动服务器"}),e.jsx("button",{onClick:P,disabled:!S,className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50",children:"停止服务器"}),e.jsx("button",{onClick:A,disabled:d===l.CONNECTED||!S,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:"连接SSE"}),e.jsx("button",{onClick:H,disabled:d===l.CLOSED,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 disabled:opacity-50",children:"断开连接"})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:`text-sm font-medium ${f(d)}`,children:[R(d)," 连接状态: ",d]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"事件过滤器"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium",children:"事件类型:"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:L,className:"px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600",children:"全选"}),e.jsx("button",{onClick:B,className:"px-3 py-1 text-sm bg-gray-500 text-white rounded hover:bg-gray-600",children:"全不选"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:h.map(s=>{const t=i.enabledTypes.has(s),c=T[s]||0;return e.jsxs("button",{onClick:()=>U(s),className:`px-3 py-2 rounded border-2 transition-all ${t?a(s):"bg-gray-50 text-gray-400 border-gray-200"}`,children:[e.jsx("span",{className:"font-medium",children:s}),e.jsxs("span",{className:"ml-2 text-xs",children:["(",c,")"]})]},s)})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["最大事件数: ",i.maxEvents]}),e.jsx("input",{type:"range",min:"10",max:"200",step:"10",value:i.maxEvents,onChange:s=>w(t=>({...t,maxEvents:parseInt(s.target.value)})),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["时间范围: ",i.timeRange===0?"不限制":`${i.timeRange}分钟`]}),e.jsx("input",{type:"range",min:"0",max:"60",step:"5",value:i.timeRange,onChange:s=>w(t=>({...t,timeRange:parseInt(s.target.value)})),className:"w-full"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"事件统计"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:M}),e.jsx("div",{className:"text-sm text-gray-600",children:"总事件数"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"过滤后"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:i.enabledTypes.size}),e.jsx("div",{className:"text-sm text-gray-600",children:"启用类型"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:h.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"总类型数"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium mb-2",children:"事件类型分布:"}),h.map(s=>{const t=T[s]||0,c=J(t,M);return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium min-w-20 text-center ${a(s)}`,children:s}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${c}%`}})}),e.jsxs("div",{className:"text-sm text-gray-600 min-w-16 text-right",children:[t," (",c,"%)"]})]},s)})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["过滤后的事件 (",u.length,"/",r.length,")"]}),e.jsx("button",{onClick:G,className:"px-3 py-1 bg-gray-500 text-white rounded hover:bg-gray-600",children:"清空历史"})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:u.length===0?e.jsx("div",{className:"text-gray-500 text-center py-8",children:r.length===0?"暂无事件数据":"没有符合过滤条件的事件"}):u.map((s,t)=>e.jsxs("div",{className:"border border-gray-200 rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${a(s.type)}`,children:s.type}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.timestamp).toLocaleTimeString()})]}),e.jsx("div",{className:"text-sm",children:e.jsx("pre",{className:"whitespace-pre-wrap text-xs bg-gray-50 p-2 rounded",children:JSON.stringify(s.data,null,2)})})]},`${s.timestamp}-${t}`))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"操作日志"}),e.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:C.length===0?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"暂无日志"}):C.map((s,t)=>e.jsx("div",{className:"text-sm text-gray-700 font-mono",children:s},t))})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-blue-800",children:"过滤功能说明"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-700",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"类型过滤:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• 支持多选事件类型"}),e.jsx("li",{children:"• 实时显示各类型事件数量"}),e.jsx("li",{children:"• 全选/全不选快捷操作"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"数量控制:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• 限制显示的最大事件数"}),e.jsx("li",{children:"• 防止内存占用过多"}),e.jsx("li",{children:"• 保持界面响应速度"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"时间过滤:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• 按时间范围过滤事件"}),e.jsx("li",{children:"• 只显示最近的事件"}),e.jsx("li",{children:"• 自动清理过期事件"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"统计分析:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• 事件类型分布图"}),e.jsx("li",{children:"• 实时统计计数"}),e.jsx("li",{children:"• 百分比可视化"})]})]})]})]})]})},Y=()=>{const[d,n]=m.useState(l.CLOSED),[r,x]=m.useState(!1),[u,N]=m.useState([]),[i,w]=m.useState({cpu:0,memory:0,disk:0,network:0,timestamp:Date.now()}),[S,O]=m.useState([]),[C,$]=m.useState([]),[T,k]=m.useState([]),[o,g]=m.useState({metrics:!0,logs:!0,alerts:!0}),h=m.useRef(null),p=m.useRef(null);m.useEffect(()=>{p.current=new q,h.current=new W({url:"/api/realtime",reconnectInterval:2e3,maxReconnectAttempts:10,eventTypes:["metrics","log","alert"]});const t=h.current,c=t.onStateChange(v=>{n(v),j(`连接状态变更: ${v}`)}),D=t.subscribe("metrics",v=>{if(o.metrics){const E=v.data;w({...E,timestamp:v.timestamp}),O(F=>[{...E,timestamp:v.timestamp},...F.slice(0,49)]),j(`系统指标更新: CPU ${E.cpu.toFixed(1)}%`)}}),b=t.subscribe("log",v=>{if(o.logs){const E={...v.data,timestamp:v.timestamp};$(F=>[E,...F.slice(0,99)]),j(`新日志: [${E.level.toUpperCase()}] ${E.message}`)}}),I=t.subscribe("alert",v=>{if(o.alerts){const E={...v.data,timestamp:v.timestamp};k(F=>[E,...F.slice(0,49)]),j(`新告警: [${E.severity.toUpperCase()}] ${E.title}`)}}),z=p.current.onEvent(v=>{t.isConnected()&&t.handleEvent(v)});return()=>{var v;c(),D(),b(),I(),z(),t.disconnect(),(v=p.current)==null||v.stop()}},[o]);const j=t=>{const c=new Date().toLocaleTimeString();N(D=>[`[${c}] ${t}`,...D.slice(0,19)])},P=()=>{p.current&&(p.current.start(),x(!0),j("实时数据流服务器已启动"))},A=()=>{p.current&&(p.current.stop(),x(!1),j("实时数据流服务器已停止"),h.current&&h.current.disconnect())},H=()=>{h.current&&r?(h.current.connect(),j("尝试连接实时数据流")):j("请先启动服务器")},U=()=>{h.current&&(h.current.disconnect(),j("断开实时数据流连接"))},L=t=>{g(c=>({...c,[t]:!c[t]})),j(`${o[t]?"取消":"启用"}${t}事件订阅`)},B=()=>{O([]),$([]),k([]),j("所有数据已清空")},G=t=>{switch(t){case l.CONNECTED:return"text-green-600";case l.CONNECTING:return"text-yellow-600";case l.ERROR:return"text-red-600";default:return"text-gray-600"}},a=t=>{switch(t){case l.CONNECTED:return"🟢";case l.CONNECTING:return"🟡";case l.ERROR:return"🔴";default:return"⚪"}},f=(t,c=80)=>t>=c?"text-red-600":t>=c*.7?"text-yellow-600":"text-green-600",R=(t,c=80)=>t>=c?"bg-red-500":t>=c*.7?"bg-yellow-500":"bg-green-500",J=t=>({error:"bg-red-100 text-red-800 border-red-200",warn:"bg-yellow-100 text-yellow-800 border-yellow-200",info:"bg-blue-100 text-blue-800 border-blue-200",debug:"bg-gray-100 text-gray-800 border-gray-200"})[t]||"bg-gray-100 text-gray-800 border-gray-200",M=t=>({critical:"bg-red-100 text-red-800 border-red-300",high:"bg-orange-100 text-orange-800 border-orange-300",medium:"bg-yellow-100 text-yellow-800 border-yellow-300",low:"bg-blue-100 text-blue-800 border-blue-300"})[t]||"bg-gray-100 text-gray-800 border-gray-300",s=t=>{if(t===0)return"0 B";const c=1024,D=["B","KB","MB","GB"],b=Math.floor(Math.log(t)/Math.log(c));return parseFloat((t/Math.pow(c,b)).toFixed(2))+" "+D[b]};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"实时监控控制台"}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`text-sm font-medium ${r?"text-green-600":"text-gray-600"}`,children:r?"🟢 服务器运行中":"⚪ 服务器已停止"})}),e.jsx("button",{onClick:P,disabled:r,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50",children:"启动服务器"}),e.jsx("button",{onClick:A,disabled:!r,className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50",children:"停止服务器"}),e.jsx("button",{onClick:H,disabled:d===l.CONNECTED||!r,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:"连接数据流"}),e.jsx("button",{onClick:U,disabled:d===l.CLOSED,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 disabled:opacity-50",children:"断开连接"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:`text-sm font-medium ${G(d)}`,children:[a(d)," 连接状态: ",d]}),e.jsx("button",{onClick:B,className:"px-3 py-1 bg-gray-500 text-white rounded hover:bg-gray-600",children:"清空数据"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"数据流订阅"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.metrics,onChange:()=>L("metrics"),className:"rounded"}),e.jsx("span",{className:"text-sm font-medium",children:"系统指标"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.logs,onChange:()=>L("logs"),className:"rounded"}),e.jsx("span",{className:"text-sm font-medium",children:"系统日志"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.alerts,onChange:()=>L("alerts"),className:"rounded"}),e.jsx("span",{className:"text-sm font-medium",children:"系统告警"})]})]})]}),o.metrics&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"实时系统指标"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${f(i.cpu)}`,children:[i.cpu.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"CPU使用率"}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${R(i.cpu)}`,style:{width:`${Math.min(i.cpu,100)}%`}})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${f(i.memory)}`,children:[i.memory.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"内存使用率"}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${R(i.memory)}`,style:{width:`${Math.min(i.memory,100)}%`}})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${f(i.disk)}`,children:[i.disk.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"磁盘使用率"}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${R(i.disk)}`,style:{width:`${Math.min(i.disk,100)}%`}})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s(i.network)}),e.jsx("div",{className:"text-sm text-gray-600",children:"网络流量"}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:new Date(i.timestamp).toLocaleTimeString()})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"历史趋势 (最近50个数据点)"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["数据点数量: ",S.length]})]})]}),o.logs&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["系统日志流 (",C.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:C.length===0?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"暂无日志数据"}):C.map((t,c)=>e.jsxs("div",{className:"flex items-start gap-3 p-2 border border-gray-200 rounded",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${J(t.level)}`,children:t.level.toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm",children:t.message}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.source," • ",new Date(t.timestamp).toLocaleTimeString()]})]})]},`${t.timestamp}-${c}`))})]}),o.alerts&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["系统告警 (",T.length,")"]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:T.length===0?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"暂无告警数据"}):T.map((t,c)=>e.jsxs("div",{className:`p-3 border-2 rounded-lg ${M(t.severity)}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:t.title}),e.jsx("span",{className:"text-xs",children:new Date(t.timestamp).toLocaleTimeString()})]}),e.jsx("div",{className:"text-sm mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{children:["来源: ",t.source]}),e.jsxs("span",{className:"font-medium",children:["严重程度: ",t.severity.toUpperCase()]})]})]},`${t.timestamp}-${c}`))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"操作日志"}),e.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:u.length===0?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"暂无日志"}):u.map((t,c)=>e.jsx("div",{className:"text-sm text-gray-700 font-mono",children:t},c))})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-blue-800",children:"实时监控功能"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-700",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"系统指标监控:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• 实时CPU、内存、磁盘使用率"}),e.jsx("li",{children:"• 网络流量监控"}),e.jsx("li",{children:"• 历史数据趋势分析"}),e.jsx("li",{children:"• 阈值告警提示"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"日志流处理:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• 多级别日志分类"}),e.jsx("li",{children:"• 实时日志流展示"}),e.jsx("li",{children:"• 日志来源标识"}),e.jsx("li",{children:"• 时间戳记录"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"告警管理:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• 多级别告警分类"}),e.jsx("li",{children:"• 告警详情描述"}),e.jsx("li",{children:"• 告警来源追踪"}),e.jsx("li",{children:"• 实时告警推送"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"订阅控制:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• 选择性数据订阅"}),e.jsx("li",{children:"• 动态订阅管理"}),e.jsx("li",{children:"• 数据流量控制"}),e.jsx("li",{children:"• 性能优化"})]})]})]})]})]})},Z=[{title:"核心概念",items:["基于HTTP长连接的服务器推送技术","使用EventSource API在客户端接收事件流","支持自定义事件类型和数据格式","提供自动重连和错误恢复机制","单向通信，只能服务器向客户端推送数据"]},{title:"主要优势",items:["基于标准HTTP协议，兼容性好","服务器主动推送，实时性高","支持自动重连和错误恢复","简单易用，开发成本低","支持多种事件类型和数据格式"]},{title:"适用场景",items:["实时数据监控和仪表板","系统日志和事件流","股票价格、体育比分等实时更新","聊天应用的消息推送","进度条和状态更新"]},{title:"注意事项",items:["单向通信，客户端无法向服务器发送数据","连接数限制，浏览器对同域名连接有限制","需要处理网络中断和重连逻辑","服务器需要正确设置CORS和缓存头","移动端网络切换时需要特殊处理"]}],re=()=>e.jsx(Q,{title:"SSE (Server-Sent Events) 支持",description:"Server-Sent Events (SSE) 是一种允许服务器向客户端推送数据的Web标准技术。它基于HTTP协议，提供了一种简单而高效的实时通信方案，特别适合需要服务器主动推送数据的场景。",overview:Z,examples:[{title:"基础SSE连接",component:e.jsx(V,{}),description:"演示SSE的基本连接、事件接收和服务器控制功能",observationPoints:["启动模拟服务器后才能建立SSE连接","连接建立后开始接收各种类型的事件数据","事件按时间顺序显示，包含类型、数据和时间戳","可以发送自定义事件测试不同的数据格式","连接状态实时更新，显示当前连接状态"],keyPoints:["SSE基于HTTP长连接实现服务器推送","支持多种事件类型和自定义数据格式","事件数据采用JSON格式便于解析和处理","连接状态管理包括连接中、已连接、已关闭","模拟服务器演示了SSE的基本工作原理"],commonTraps:["忘记启动服务器就尝试连接","没有正确处理JSON解析错误","事件监听器没有正确清理导致内存泄漏","连接状态更新不及时","事件数据格式不一致"],solutions:["连接前检查服务器状态","使用try-catch包装JSON解析","在组件卸载时清理所有监听器","使用状态回调及时更新连接状态","定义统一的事件数据接口"],importantTips:["SSE连接是单向的，只能接收服务器数据","浏览器会自动处理基本的重连逻辑","事件ID可用于断线重连时的数据同步","服务器需要设置正确的Content-Type头"]},{title:"事件过滤和分类",component:e.jsx(X,{}),description:"演示如何过滤和分类不同类型的SSE事件",observationPoints:["可以选择性显示特定类型的事件","事件类型分布图显示各类型事件的比例","过滤器实时生效，立即更新显示结果","统计信息显示总事件数和过滤后的数量","不同事件类型使用不同的颜色标识"],keyPoints:["事件过滤基于事件类型进行分类","支持多选过滤器和全选/全不选操作","实时统计各类型事件的数量和比例","过滤逻辑在客户端执行，响应速度快","可视化展示帮助理解事件分布情况"],commonTraps:["过滤器状态管理复杂容易出错","事件类型硬编码不够灵活","统计计算没有考虑性能优化","颜色映射不够直观","过滤后的事件列表没有及时更新"],solutions:["使用Set数据结构管理过滤器状态","从配置或服务器动态获取事件类型","使用useMemo优化统计计算","定义语义化的颜色映射规则","使用useEffect监听过滤器变化"],importantTips:["过滤器只影响显示，不影响数据接收","事件历史保存在内存中，注意控制大小","颜色编码有助于快速识别事件类型","统计信息可以帮助分析系统行为"]},{title:"实时数据流监控",component:e.jsx(Y,{}),description:"演示实时监控系统指标、日志和告警的完整场景",observationPoints:["系统指标每秒更新，显示CPU、内存等实时数据","日志事件随机生成，模拟真实的系统日志","告警事件较少但优先级高，需要特别关注","不同数据流使用独立的订阅和显示区域","实时指标面板显示最新的系统状态"],keyPoints:["使用事件订阅机制分别处理不同类型的数据","实时数据流需要控制数据量避免内存溢出","不同优先级的数据使用不同的显示策略","监控面板提供系统状态的直观展示","数据生成频率可以根据需要调整"],commonTraps:["数据更新频率过高导致性能问题","没有限制历史数据大小导致内存泄漏","事件订阅没有正确取消","UI更新过于频繁影响用户体验","告警数据没有突出显示"],solutions:["合理设置数据更新间隔","使用滑动窗口限制历史数据大小","在组件卸载时取消所有订阅","使用防抖或节流优化UI更新","为告警数据设计特殊的视觉样式"],importantTips:["实时监控需要平衡数据精度和性能","不同类型的数据需要不同的处理策略","告警数据通常需要持久化存储","监控系统本身也需要监控和告警"]}],tutorial:{concepts:["SSE (Server-Sent Events) 是HTML5标准的一部分，提供服务器向客户端推送数据的能力","基于HTTP协议，使用长连接保持服务器与客户端的通信通道","事件流格式简单，使用纯文本格式传输事件数据","支持自定义事件类型，可以根据业务需要定义不同的事件","浏览器提供原生的EventSource API，使用简单","支持自动重连机制，网络中断后可以自动恢复连接"],steps:["创建SSE配置对象，包含URL、重连设置、事件类型等","实例化SSE管理器，传入配置参数","调用connect方法建立与服务器的连接","使用subscribe方法订阅感兴趣的事件类型","在事件回调中处理接收到的数据","实现连接状态监听，处理连接、断开等状态变化","在组件卸载时调用disconnect方法清理资源"],tips:["服务器端需要设置正确的Content-Type: text/event-stream","使用事件ID可以实现断线重连时的数据同步","合理设置重连间隔，避免对服务器造成压力","在移动端需要处理网络切换导致的连接中断","使用心跳机制检测连接是否正常","对于大量数据流，考虑使用WebSocket替代SSE"]},interview:{questions:[{question:"SSE与WebSocket有什么区别？",answer:"SSE是单向通信，只能服务器向客户端推送数据；WebSocket是双向通信，支持客户端和服务器互相发送数据。SSE基于HTTP协议，实现简单；WebSocket是独立协议，功能更强大但复杂度更高。SSE有浏览器连接数限制；WebSocket没有此限制。"},{question:"如何处理SSE连接的错误和重连？",answer:"监听onerror事件处理连接错误；检查readyState判断连接状态；实现指数退避算法控制重连间隔；设置最大重连次数避免无限重连；使用事件ID实现断线重连时的数据同步；在网络状态变化时主动重连。"},{question:"SSE在生产环境中需要注意什么？",answer:"服务器需要正确设置CORS头支持跨域；配置反向代理支持长连接；监控连接数量避免资源耗尽；实现客户端连接管理和清理；处理移动端网络切换；设置合适的超时和心跳机制；考虑负载均衡对长连接的影响。"},{question:"如何优化SSE的性能？",answer:"控制事件推送频率避免过载；使用事件过滤减少不必要的数据传输；实现客户端数据缓存和去重；合理设置连接池大小；使用CDN加速静态资源；监控内存使用避免泄漏；在高并发场景考虑使用消息队列。"}],keyPoints:["SSE适合服务器主动推送数据的场景","基于HTTP协议，兼容性和部署简单","支持自动重连和错误恢复机制","事件类型和数据格式灵活可定制","需要考虑连接数限制和资源管理","在移动端需要特殊的网络处理"]},bestPractices:{dos:["使用事件类型对不同数据进行分类","实现完善的错误处理和重连机制","控制事件推送频率避免性能问题","在组件卸载时正确清理连接和监听器","使用心跳机制检测连接健康状态","为不同优先级的事件设计不同的处理策略"],donts:["不要忽略连接状态的管理和监控","不要在高频数据场景滥用SSE","不要忘记处理JSON解析错误","不要让事件历史数据无限增长","不要在不支持SSE的环境中强制使用","不要忽略服务器端的资源限制"],patterns:["事件订阅模式：基于事件类型的订阅和分发机制","状态管理模式：统一管理连接状态和事件数据","重连策略模式：实现指数退避的重连算法","数据流模式：处理连续的实时数据流","过滤器模式：客户端事件过滤和分类","监控模式：实时监控系统状态和性能指标"]}});export{re as default};
