var I=Object.defineProperty;var A=(n,s,a)=>s in n?I(n,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[s]=a;var T=(n,s,a)=>A(n,typeof s!="symbol"?s+"":s,a);import{r as h,j as e}from"./index-C7SuDyTR.js";import{C as z}from"./ComponentTemplate-BzrYXZsv.js";class E{constructor(){T(this,"state",{isLoading:!1,loadingCount:0,loadingTasks:new Map});T(this,"listeners",new Set);T(this,"minLoadingDuration",300)}subscribe(s){return this.listeners.add(s),()=>this.listeners.delete(s)}notify(){this.listeners.forEach(s=>s({...this.state}))}startLoading(s,a={}){const d={id:s,name:a.name||s,startTime:Date.now(),minDuration:a.minDuration||this.minLoadingDuration,priority:a.priority||"medium"};return this.state.loadingTasks.set(s,d),this.state.loadingCount++,this.state.isLoading=!0,this.notify(),s}async endLoading(s){const a=this.state.loadingTasks.get(s);if(!a)return;const d=Date.now()-a.startTime,g=Math.max(0,(a.minDuration||0)-d);g>0&&await new Promise(c=>setTimeout(c,g)),this.state.loadingTasks.delete(s),this.state.loadingCount=Math.max(0,this.state.loadingCount-1),this.state.isLoading=this.state.loadingCount>0,this.notify()}clearAll(){this.state.loadingTasks.clear(),this.state.loadingCount=0,this.state.isLoading=!1,this.notify()}getState(){return{...this.state}}getHighPriorityCount(){return Array.from(this.state.loadingTasks.values()).filter(s=>s.priority==="high").length}}const y=new E,S=h.createContext(null),G=({children:n})=>{const[s,a]=h.useState(y.getState());return h.useEffect(()=>{const d=y.subscribe(a);return()=>{d()}},[]),e.jsx(S.Provider,{value:{state:s,startLoading:y.startLoading.bind(y),endLoading:y.endLoading.bind(y),clearAll:y.clearAll.bind(y)},children:n})},L=()=>{const n=h.useContext(S);if(!n)throw new Error("useGlobalLoading must be used within GlobalLoadingProvider");return n},C=({position:n="top",showTaskCount:s=!0,showTaskList:a=!1})=>{const{state:d}=L();if(!d.isLoading)return null;const g={top:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50",center:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50",bottom:"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50"};return e.jsxs("div",{className:`${g[n]} bg-white rounded-lg shadow-lg p-4 border`,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"正在加载..."}),s&&e.jsxs("span",{className:"text-xs text-gray-500",children:[d.loadingCount," 个任务进行中"]})]})]}),a&&d.loadingTasks.size>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"当前任务:"}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:Array.from(d.loadingTasks.values()).map(c=>{const v=Date.now()-c.startTime,u={low:"text-gray-500",medium:"text-blue-500",high:"text-red-500"};return e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:`${u[c.priority]} truncate max-w-32`,children:c.name}),e.jsxs("span",{className:"text-gray-400 ml-2",children:[Math.round(v/100)/10,"s"]})]},c.id)})})]})]})},q=()=>{const{state:n,startLoading:s,endLoading:a}=L(),[d,g]=h.useState("top"),[c,v]=h.useState(!0),[u,f]=h.useState(300),[l,m]=h.useState(!1),[p,j]=h.useState(1);h.useEffect(()=>{if(!l)return;const i=setInterval(()=>{const t=`auto-task-${Date.now()}`,r=["low","medium","high"],o=["数据同步","缓存更新","状态检查","配置刷新"],x=r[Math.floor(Math.random()*r.length)],b=o[Math.floor(Math.random()*o.length)],N=Math.random()*2e3+500;s(t,{name:b,minDuration:u,priority:x}),setTimeout(async()=>{await a(t)},N)},1e3);return()=>clearInterval(i)},[l,u,s,a]);const D=async()=>{const i=[{name:"验证用户",duration:800,priority:"high"},{name:"获取权限",duration:600,priority:"high"},{name:"加载数据",duration:1200,priority:"medium"},{name:"渲染界面",duration:400,priority:"low"}];for(let t=0;t<i.length;t++){const r=i[t],o=`api-step-${p}-${t}`;s(o,{name:`${r.name} (${t+1}/${i.length})`,minDuration:u,priority:r.priority}),await new Promise(x=>{setTimeout(async()=>{await a(o),x(void 0)},r.duration)})}j(t=>t+1)},P=async()=>{[{name:"document.pdf",size:"2.3MB"},{name:"image.jpg",size:"1.8MB"},{name:"data.xlsx",size:"4.1MB"}].forEach((t,r)=>{const o=`upload-${p}-${r}`;s(o,{name:`上传 ${t.name} (${t.size})`,minDuration:u,priority:"medium"});const x=Math.random()*3e3+1e3;setTimeout(async()=>{await a(o)},x)}),j(t=>t+1)},$=async()=>{const t=`batch-${p}`;s(t,{name:"批量处理 5 项",minDuration:u,priority:"high"}),setTimeout(async()=>{await a(t)},2500),j(r=>r+1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(C,{position:d,showTaskCount:!0,showTaskList:c}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"高级配置"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"指示器位置"}),e.jsxs("select",{value:d,onChange:i=>g(i.target.value),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"top",children:"顶部"}),e.jsx("option",{value:"center",children:"中心"}),e.jsx("option",{value:"bottom",children:"底部"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"最小持续时间 (ms)"}),e.jsx("input",{type:"number",value:u,onChange:i=>f(Number(i.target.value)),min:"0",max:"2000",step:"100",className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:i=>v(i.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"显示任务列表"})]})}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:i=>m(i.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"自动生成任务"})]})})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"高级加载场景"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("button",{onClick:D,className:"px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:"API 请求序列"}),e.jsx("div",{className:"text-xs opacity-90",children:"模拟多步骤API调用"})]})}),e.jsx("button",{onClick:P,className:"px-4 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition-all duration-200 shadow-md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:"文件上传"}),e.jsx("div",{className:"text-xs opacity-90",children:"模拟多文件并发上传"})]})}),e.jsx("button",{onClick:$,className:"px-4 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all duration-200 shadow-md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:"批量操作"}),e.jsx("div",{className:"text-xs opacity-90",children:"模拟大批量数据处理"})]})})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-blue-50 p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"实时统计"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n.loadingCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"总任务数"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:Array.from(n.loadingTasks.values()).filter(i=>i.priority==="high").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"高优先级"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:Array.from(n.loadingTasks.values()).filter(i=>i.priority==="medium").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"中优先级"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:Array.from(n.loadingTasks.values()).filter(i=>i.priority==="low").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"低优先级"})]})]})]}),e.jsxs("div",{className:"bg-amber-50 p-6 rounded-lg border border-amber-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-amber-800",children:"高级功能说明"}),e.jsxs("ul",{className:"space-y-2 text-sm text-amber-700",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"动态配置"}),"：实时调整指示器位置、最小持续时间等参数"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"API 请求序列"}),"：模拟真实的多步骤API调用流程"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"文件上传"}),"：模拟多文件并发上传场景"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"批量操作"}),"：模拟大批量数据处理任务"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"自动任务"}),"：持续生成随机任务，测试系统稳定性"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"优先级管理"}),"：不同优先级任务的可视化展示"]})]})]})]})},B=()=>{const{state:n,startLoading:s,endLoading:a,clearAll:d}=L(),[g,c]=h.useState(1),v=async()=>{const l=`short-task-${g}`;c(m=>m+1),s(l,{name:"短时间任务",minDuration:500,priority:"medium"}),setTimeout(async()=>{await a(l)},800)},u=async()=>{const l=`long-task-${g}`;c(m=>m+1),s(l,{name:"长时间任务",minDuration:300,priority:"high"}),setTimeout(async()=>{await a(l)},3e3)},f=async()=>{const l=[{name:"数据获取",duration:1e3,priority:"high"},{name:"图片加载",duration:1500,priority:"medium"},{name:"配置加载",duration:800,priority:"low"}];l.forEach((m,p)=>{const j=`multi-task-${g+p}`;s(j,{name:m.name,minDuration:300,priority:m.priority}),setTimeout(async()=>{await a(j)},m.duration)}),c(m=>m+l.length)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(C,{position:"top",showTaskCount:!0,showTaskList:!0}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"基础加载操作"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx("button",{onClick:v,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"短时间加载"}),e.jsx("button",{onClick:u,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors",children:"长时间加载"}),e.jsx("button",{onClick:f,className:"px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors",children:"多个并发加载"}),e.jsx("button",{onClick:d,className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors",disabled:!n.isLoading,children:"清除所有"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"当前状态"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"加载状态"}),e.jsx("div",{className:`text-lg font-semibold ${n.isLoading?"text-blue-600":"text-gray-400"}`,children:n.isLoading?"加载中":"空闲"})]}),e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"任务数量"}),e.jsx("div",{className:"text-lg font-semibold text-purple-600",children:n.loadingCount})]}),e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"高优先级任务"}),e.jsx("div",{className:"text-lg font-semibold text-red-600",children:Array.from(n.loadingTasks.values()).filter(l=>l.priority==="high").length})]})]})]}),n.loadingTasks.size>0&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"活动任务列表"}),e.jsx("div",{className:"space-y-2",children:Array.from(n.loadingTasks.values()).map(l=>{const m=Date.now()-l.startTime,p={low:"bg-gray-100 text-gray-700",medium:"bg-blue-100 text-blue-700",high:"bg-red-100 text-red-700"};return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${p[l.priority]}`,children:l.priority.toUpperCase()}),e.jsx("span",{className:"font-medium",children:l.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",l.id,")"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[Math.round(m/100)/10,"s"]})]},l.id)})})]}),e.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-blue-800",children:"功能说明"}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-700",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"短时间加载"}),"：模拟快速完成的任务，展示最小加载时间防闪烁机制"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"长时间加载"}),"：模拟耗时较长的任务，展示持续加载状态"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"多个并发加载"}),"：同时启动多个不同优先级的加载任务"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"清除所有"}),"：立即停止所有正在进行的加载任务"]}),e.jsx("li",{children:"• 加载指示器会根据任务数量和优先级动态显示状态"})]})]})]})},U=()=>{const{state:n,startLoading:s,endLoading:a}=L(),[d,g]=h.useState(null),[c,v]=h.useState(null),[u,f]=h.useState(!1),[l,m]=h.useState({}),p=async()=>{try{const i=s("auth-validation",{name:"验证用户凭据",priority:"high",minDuration:500});await new Promise(o=>setTimeout(o,800)),await a(i);const t=s("user-info",{name:"获取用户信息",priority:"high",minDuration:300});await new Promise(o=>setTimeout(o,600)),g({name:"张三",email:"zhangsan@example.com",role:"管理员",avatar:"https://via.placeholder.com/40"}),await a(t);const r=s("user-settings",{name:"加载用户设置",priority:"medium",minDuration:200});await new Promise(o=>setTimeout(o,400)),await a(r),f(!0)}catch(i){console.error("登录失败:",i)}},j=async()=>{const t=[{id:"analytics",name:"加载分析数据",duration:1200,priority:"high"},{id:"notifications",name:"获取通知",duration:800,priority:"medium"},{id:"recent-activity",name:"最近活动",duration:600,priority:"low"},{id:"system-status",name:"系统状态",duration:400,priority:"low"}].map(async x=>{const b=s(x.id,{name:x.name,priority:x.priority,minDuration:300});return await new Promise(N=>setTimeout(N,x.duration)),await a(b),{[x.id]:`${x.name}数据已加载`}}),o=(await Promise.all(t)).reduce((x,b)=>({...x,...b}),{});v(o)},D=async()=>{[{name:"报告.pdf",size:2.3},{name:"数据.xlsx",size:1.8},{name:"图片.jpg",size:4.1}].forEach(async(t,r)=>{const o=`upload-${Date.now()}-${r}`;s(o,{name:`上传 ${t.name} (${t.size}MB)`,priority:"medium",minDuration:500});const x=t.size*1e3,b=20,N=x/b;for(let w=0;w<=b;w++){await new Promise(M=>setTimeout(M,N));const k=w/b*100;m(M=>({...M,[o]:k}))}await a(o),m(w=>{const k={...w};return delete k[o],k})})},P=async()=>{const i=["同步用户数据","同步配置信息","同步缓存数据","同步日志文件","同步备份数据"];for(let t=0;t<i.length;t++){const r=`sync-${Date.now()}-${t}`;s(r,{name:`${i[t]} (${t+1}/${i.length})`,priority:t<2?"high":"medium",minDuration:400}),await new Promise(o=>setTimeout(o,Math.random()*1e3+500)),await a(r)}},$=async()=>{const i=[{name:"检查系统兼容性",duration:800,priority:"high"},{name:"加载核心模块",duration:1200,priority:"high"},{name:"初始化数据库连接",duration:600,priority:"high"},{name:"加载插件",duration:1e3,priority:"medium"},{name:"准备用户界面",duration:400,priority:"low"}];for(const t of i){const r=`init-${Date.now()}-${Math.random()}`;s(r,{name:t.name,priority:t.priority,minDuration:300}),await new Promise(o=>setTimeout(o,t.duration)),await a(r)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(C,{position:"top",showTaskCount:!0,showTaskList:!0}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"用户状态"}),u&&d?e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-semibold",children:d.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:d.name}),e.jsx("div",{className:"text-sm text-gray-600",children:d.email}),e.jsx("div",{className:"text-xs text-blue-600",children:d.role})]})]}):e.jsx("div",{className:"text-gray-500",children:"未登录"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"真实应用场景"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx("button",{onClick:p,className:"px-4 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition-all duration-200 shadow-md",disabled:n.isLoading,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:"用户登录"}),e.jsx("div",{className:"text-xs opacity-90",children:"多步骤认证流程"})]})}),e.jsx("button",{onClick:j,className:"px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-md",disabled:!u,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:"加载仪表板"}),e.jsx("div",{className:"text-xs opacity-90",children:"并行数据获取"})]})}),e.jsx("button",{onClick:D,className:"px-4 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all duration-200 shadow-md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:"文件上传"}),e.jsx("div",{className:"text-xs opacity-90",children:"带进度显示"})]})}),e.jsx("button",{onClick:P,className:"px-4 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all duration-200 shadow-md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:"数据同步"}),e.jsx("div",{className:"text-xs opacity-90",children:"顺序执行任务"})]})}),e.jsx("button",{onClick:$,className:"px-4 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:"系统初始化"}),e.jsx("div",{className:"text-xs opacity-90",children:"启动流程模拟"})]})})]})]}),c&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"仪表板数据"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(c).map(([i,t])=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 capitalize",children:i.replace("-"," ")}),e.jsx("div",{className:"text-xs text-gray-600",children:t})]},i))})]}),Object.keys(l).length>0&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"上传进度"}),e.jsx("div",{className:"space-y-3",children:Object.entries(l).map(([i,t])=>{const r=n.loadingTasks.get(i);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:(r==null?void 0:r.name)||i}),e.jsxs("span",{children:[Math.round(t),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${t}%`}})})]},i)})})]}),e.jsxs("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-green-800",children:"真实应用场景"}),e.jsxs("ul",{className:"space-y-2 text-sm text-green-700",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"用户登录"}),"：模拟完整的用户认证流程，包括凭据验证、用户信息获取和设置初始化"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"仪表板加载"}),"：并行加载多个数据源，展示不同优先级任务的处理"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"文件上传"}),"：模拟真实的文件上传场景，包含进度显示和状态管理"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"数据同步"}),"：顺序执行多个同步任务，适用于数据备份和迁移场景"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"系统初始化"}),"：模拟应用启动时的各个初始化步骤"]}),e.jsx("li",{children:"• 所有场景都考虑了任务优先级、最小持续时间和用户体验优化"})]})]})]})},R=[{title:"核心概念",items:["加载计数器：跟踪当前进行中的加载任务数量","任务优先级：区分不同重要程度的加载任务","防闪烁机制：避免短时间任务造成的加载指示器闪烁","全局状态管理：统一管理应用中的所有加载状态"]},{title:"主要优势",items:["提供一致的加载体验和视觉反馈","避免多个加载指示器同时出现","智能防闪烁，提升用户体验","支持任务优先级和批量管理"]},{title:"适用场景",items:["页面初始化时的多资源并发加载","表单提交和数据保存操作","搜索和筛选功能的实时反馈","文件上传下载的进度管理"]},{title:"注意事项",items:["合理设置最小显示时间，通常推荐300ms","根据业务重要性设置任务优先级","避免过多的并发加载任务","提供清晰的加载状态和错误处理"]}],O=()=>e.jsx(z,{title:"全局加载管理",description:"通过统一的加载状态管理，提供一致的用户体验和防闪烁机制",overview:R,examples:[{title:"基础加载管理",component:e.jsx(B,{}),description:"演示全局加载状态的基本管理功能",observationPoints:["不同优先级任务的加载指示器显示","加载计数器实时更新","多任务并发时的状态管理","清除所有任务的功能"],keyPoints:["加载计数器跟踪所有进行中的任务","高优先级任务会影响加载指示器的显示","支持任务的批量管理和清除","提供详细的任务状态信息"],commonTraps:["忘记调用endLoading导致加载状态一直存在","没有设置合适的任务优先级","同时启动过多的加载任务"],solutions:["使用try-finally确保endLoading被调用","根据业务重要性合理设置优先级","控制并发任务数量，避免性能问题"],importantTips:["高优先级任务会优先显示在加载指示器中","加载计数器为0时自动隐藏加载指示器","每个任务都有唯一的ID用于管理"]},{title:"防闪烁机制",component:e.jsx(q,{}),description:"演示如何避免短时间任务造成的加载指示器闪烁",observationPoints:["短时间任务会延迟隐藏加载指示器","最小显示时间的设置影响","实际显示时间与任务执行时间的关系","不同最小时间设置的效果对比"],keyPoints:["防闪烁机制通过最小显示时间实现","推荐设置300ms的最小显示时间","实际显示时间 = max(任务时间, 最小显示时间)","平衡用户体验和响应速度"],commonTraps:["最小显示时间设置过长导致用户感觉卡顿","最小显示时间设置过短无法防止闪烁","没有考虑不同场景的时间需求"],solutions:["根据任务类型设置不同的最小显示时间","通过用户测试确定最佳的时间设置","为关键操作设置更长的最小显示时间"],importantTips:["300ms是经过验证的最佳防闪烁时间","快速任务会自动延迟隐藏加载指示器","防闪烁不会影响实际的任务执行时间"]},{title:"实际应用场景",component:e.jsx(U,{}),description:"演示在真实应用中的全局加载管理",observationPoints:["页面初始化时多个资源的并发加载","表单提交的高优先级加载状态","搜索功能的快速响应加载","不同场景下的加载策略"],keyPoints:["页面初始化使用并发加载提高效率","关键操作使用高优先级确保用户感知","搜索等交互使用中优先级快速响应","根据业务场景选择合适的加载策略"],commonTraps:["所有任务都设置为高优先级","没有区分关键和非关键的加载任务","忽略用户体验的连续性"],solutions:["根据业务重要性合理分配优先级","关键路径优先，非关键任务可以延后","保持加载状态的一致性和连续性"],importantTips:["页面初始化应该优先加载关键数据","用户操作反馈要及时显示加载状态","搜索等高频操作需要快速响应"]}],tutorial:{concepts:["全局加载状态管理的核心概念和优势","任务优先级系统的设计和实现","防闪烁机制的原理和配置","React Context 和 Hook 的集成方式","加载指示器的自定义和配置"],steps:["创建 GlobalLoadingManager 类管理加载状态","实现任务的开始、结束和清理方法","设计 React Context 和 Provider 组件","创建 useGlobalLoading Hook 供组件使用","实现加载指示器组件和样式","添加防闪烁机制和最小显示时间","集成优先级系统和任务管理","测试和优化用户体验"],tips:["使用单例模式确保全局状态的一致性","合理设置任务优先级，区分关键和非关键操作","防闪烁机制的最小时间建议设置为 300-500ms","在组件卸载时记得清理未完成的任务","使用 try-finally 确保 endLoading 总是被调用","考虑网络状况和设备性能调整配置参数"]},interview:{questions:[{question:"全局加载管理相比局部加载状态有什么优势？",answer:"全局加载管理提供统一的状态管理，避免多个组件各自维护加载状态导致的不一致问题。它支持任务优先级、防闪烁机制、并发任务管理等高级功能，提供更好的用户体验。同时便于调试和监控，可以统一处理加载异常情况。"},{question:"如何设计任务优先级系统？",answer:"任务优先级应该根据业务重要性设计：高优先级用于用户直接操作（登录、表单提交），中优先级用于页面数据加载，低优先级用于后台任务（统计、缓存）。优先级影响显示样式和用户感知，高优先级任务应该有明显的视觉提示。"},{question:"防闪烁机制的实现原理是什么？",answer:"防闪烁机制通过设置最小显示时间来避免加载指示器快速出现和消失。当任务执行时间小于最小显示时间时，会延迟隐藏指示器直到达到最小时间。这样可以避免用户看到闪烁效果，提供更流畅的体验。"},{question:"如何处理并发任务和任务清理？",answer:"使用 Map 数据结构管理并发任务，每个任务有唯一ID。提供 clearAll 方法处理异常情况。在组件卸载时应该清理未完成的任务，避免内存泄漏。使用 try-finally 确保任务状态正确结束。"}],keyPoints:["全局状态管理避免组件间状态不一致","任务优先级系统提升用户体验","防闪烁机制优化视觉效果","支持并发任务和异常处理","React Context 集成简化使用"]},bestPractices:{dos:["使用唯一的任务ID避免状态冲突","根据业务重要性合理设置任务优先级","在异步操作中使用 try-finally 确保状态清理","设置合适的最小显示时间防止闪烁","在组件卸载时清理未完成的任务","提供清除所有任务的功能处理异常情况"],donts:["不要忘记调用 endLoading 结束任务","不要所有任务都设置为高优先级","不要设置过长的最小显示时间","不要在快速连续操作中累积延迟","不要忽略加载失败的异常处理","不要在生产环境中使用过于频繁的自动任务"],patterns:["单例模式：确保全局状态管理器的唯一性","观察者模式：使用订阅机制通知状态变化","策略模式：不同优先级任务的不同处理策略","装饰器模式：为基础加载功能添加防闪烁等增强","工厂模式：根据配置创建不同类型的加载任务"]}}),J=()=>e.jsx(G,{children:e.jsxs("div",{className:"relative",children:[e.jsx(C,{position:"top",showTaskCount:!0,showTaskList:!0}),e.jsx(O,{})]})});export{J as default};
