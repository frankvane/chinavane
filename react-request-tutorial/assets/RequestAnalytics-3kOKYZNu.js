var z=Object.defineProperty;var F=(N,e,s)=>e in N?z(N,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):N[e]=s;var S=(N,e,s)=>F(N,typeof e!="symbol"?e+"":e,s);import{r as R,j as t}from"./index-C7SuDyTR.js";import{C as L}from"./ComponentTemplate-BzrYXZsv.js";class ${constructor(e={}){S(this,"config");S(this,"data",[]);S(this,"aggregatedData",new Map);S(this,"listeners",new Set);S(this,"aggregationTimer");this.config={enabled:!0,sampleRate:1,retentionDays:30,aggregationInterval:6e4,enableRealTime:!0,enableGeolocation:!1,enableUserTracking:!0,enablePerformanceTracking:!0,customDimensions:[],excludePatterns:[],includePatterns:[],...e},this.config.enableRealTime&&this.startAggregation()}track(e){if(!this.config.enabled||!this.shouldTrack(e))return;const s={id:this.generateId(),timestamp:Date.now(),url:"",method:"GET",statusCode:200,duration:0,size:0,...e};if(this.enrichData(s),this.data.push(s),this.cleanupOldData(),this.config.enableRealTime){const r=this.calculateMetrics();this.notifyListeners(r)}}trackBatch(e){e.forEach(s=>this.track(s))}getMetrics(e){const s=this.filterData(e);return this.calculateMetrics(s)}getTimeSeries(e,s=36e5,r){const a=this.filterData(r),d=[];if(a.length===0)return d;const m=Math.min(...a.map(p=>p.timestamp)),g=Math.max(...a.map(p=>p.timestamp));for(let p=m;p<=g;p+=s){const v=a.filter(c=>c.timestamp>=p&&c.timestamp<p+s),b=this.calculateMetrics(v),T=this.extractMetricValue(b,e);d.push({timestamp:p,value:T})}return d}getTopEndpoints(e=10,s){const r=this.filterData(s),a=new Map;return r.forEach(d=>{const m=this.normalizeEndpoint(d.url),g=a.get(m)||{count:0,totalTime:0,errors:0,totalSize:0};g.count++,g.totalTime+=d.duration,g.totalSize+=d.size,d.statusCode>=400&&g.errors++,a.set(m,g)}),Array.from(a.entries()).map(([d,m])=>({endpoint:d,count:m.count,avgTime:m.totalTime/m.count,errorRate:m.errors/m.count*100,totalSize:m.totalSize})).sort((d,m)=>m.count-d.count).slice(0,e)}getErrorAnalysis(e){const s=this.filterData(e),r=s.filter(c=>c.statusCode>=400),a=s.length,d={};r.forEach(c=>{d[c.statusCode]=(d[c.statusCode]||0)+1});const m=new Map,g=new Map;s.forEach(c=>{const l=this.normalizeEndpoint(c.url);g.set(l,(g.get(l)||0)+1),c.statusCode>=400&&m.set(l,(m.get(l)||0)+1)});const p=Array.from(m.entries()).map(([c,l])=>({endpoint:c,count:l,rate:l/(g.get(c)||1)*100})).sort((c,l)=>l.count-c.count),v=this.getTimeSeries("errorRate",36e5,e).map(c=>({timestamp:c.timestamp,count:Math.round(c.value/100*a)})),b=new Map;r.forEach(c=>{c.error&&b.set(c.error,(b.get(c.error)||0)+1)});const T=Array.from(b.entries()).map(([c,l])=>({error:c,count:l})).sort((c,l)=>l.count-c.count).slice(0,10);return{totalErrors:r.length,errorRate:a>0?r.length/a*100:0,errorsByStatus:d,errorsByEndpoint:p,errorTrends:v,commonErrors:T}}getPerformanceAnalysis(e){const s=this.filterData(e),r=s.map(l=>l.duration).sort((l,u)=>l-u),a=r.length>0?r.reduce((l,u)=>l+u,0)/r.length:0,d=r.length>0?r[Math.floor(r.length/2)]:0,m=r.length>0?r[Math.floor(r.length*.95)]:0,g=r.length>0?r[Math.floor(r.length*.99)]:0,p=new Map;s.forEach(l=>{const u=this.normalizeEndpoint(l.url);p.has(u)||p.set(u,[]),p.get(u).push(l.duration)});const v=Array.from(p.entries()).map(([l,u])=>{const o=u.sort((f,E)=>f-E);return{endpoint:l,avgTime:u.reduce((f,E)=>f+E,0)/u.length,p95Time:o[Math.floor(o.length*.95)]||0}}).sort((l,u)=>u.avgTime-l.avgTime).slice(0,10),b=this.getTimeSeries("avgResponseTime",36e5,e).map(l=>({timestamp:l.timestamp,avgTime:l.value,p95Time:0})),c=[{min:0,max:1024,label:"< 1KB"},{min:1024,max:10240,label:"1-10KB"},{min:10240,max:102400,label:"10-100KB"},{min:102400,max:1048576,label:"100KB-1MB"},{min:1048576,max:1/0,label:"> 1MB"}].map(l=>{const u=s.filter(o=>o.size>=l.min&&o.size<l.max);return{range:l.label,count:u.length,avgTime:u.length>0?u.reduce((o,f)=>o+f.duration,0)/u.length:0}});return{avgResponseTime:a,medianResponseTime:d,p95ResponseTime:m,p99ResponseTime:g,slowestEndpoints:v,performanceTrends:b,sizeDistribution:c}}getUserAnalysis(e){const s=this.filterData(e),r=new Set(s.map(o=>o.userId).filter(Boolean)),a=new Map;s.forEach(o=>{if(!o.userId)return;const f=a.get(o.userId)||{requests:0,totalTime:0,firstSeen:o.timestamp,lastSeen:o.timestamp};f.requests++,f.totalTime+=o.duration,f.firstSeen=Math.min(f.firstSeen,o.timestamp),f.lastSeen=Math.max(f.lastSeen,o.timestamp),a.set(o.userId,f)});const d={};s.forEach(o=>{o.region&&(d[o.region]=(d[o.region]||0)+1)});const m={};s.forEach(o=>{o.device&&(m[o.device]=(m[o.device]||0)+1)});const g={};s.forEach(o=>{o.browser&&(g[o.browser]=(g[o.browser]||0)+1)});const p=Date.now(),v=p-24*60*60*1e3,b=Array.from(a.values()).filter(o=>o.lastSeen>v).length,T=(e==null?void 0:e.startTime)||p-30*24*60*60*1e3,c=Array.from(a.values()).filter(o=>o.firstSeen>T).length,l=Array.from(a.entries()).map(([o,f])=>({userId:o,requests:f.requests,avgTime:f.totalTime/f.requests})).sort((o,f)=>f.requests-o.requests).slice(0,10),u=[{step:"首次访问",users:c,dropRate:0},{step:"第二次访问",users:Math.floor(c*.6),dropRate:40},{step:"活跃用户",users:b,dropRate:20},{step:"重度用户",users:Math.floor(b*.3),dropRate:70}];return{totalUsers:r.size,activeUsers:b,newUsers:c,usersByRegion:d,usersByDevice:m,usersByBrowser:g,topUsers:l,userJourney:u}}export(e="json",s){const r=this.filterData(s);if(e==="json")return JSON.stringify({metadata:{exportTime:new Date().toISOString(),totalRecords:r.length,filter:s},data:r,metrics:this.getMetrics(s)},null,2);if(e==="csv"){const a=["id","timestamp","url","method","statusCode","duration","size","userId","region","device","browser","cached","error"],d=[a.join(",")];return r.forEach(m=>{const g=a.map(p=>{const v=m[p];return typeof v=="string"&&v.includes(",")?`"${v}"`:v||""});d.push(g.join(","))}),d.join(`
`)}return JSON.stringify(r)}generateReport(e){const s=this.getMetrics(e),r=this.getPerformanceAnalysis(e),a=this.getErrorAnalysis(e),d=this.getUserAnalysis(e),m=this.getTopEndpoints(10,e),g=this.generateRecommendations(s,r,a);return{summary:s,performance:r,errors:a,users:d,topEndpoints:m,recommendations:g}}generateRecommendations(e,s,r){const a=[];return e.errorRate>5&&a.push("错误率过高，建议检查错误日志并修复常见问题"),e.avgResponseTime>1e3&&a.push("平均响应时间过长，建议优化性能瓶颈"),e.cacheHitRate<50&&a.push("缓存命中率较低，建议优化缓存策略"),s.p95ResponseTime>3e3&&a.push("P95响应时间过长，建议关注慢查询优化"),r.totalErrors>e.totalRequests*.1&&a.push("错误数量较多，建议加强错误监控和处理"),a}filterData(e){if(!e)return this.data;let s=this.data;if(e.timeRange&&e.timeRange!=="custom"){const r=this.getTimeRangeMs(e.timeRange);if(r){const a=Date.now()-r;s=s.filter(d=>d.timestamp>=a)}}else(e.startTime||e.endTime)&&(e.startTime&&(s=s.filter(r=>r.timestamp>=e.startTime)),e.endTime&&(s=s.filter(r=>r.timestamp<=e.endTime)));return e.methods&&e.methods.length>0&&(s=s.filter(r=>e.methods.includes(r.method))),e.statusCodes&&e.statusCodes.length>0&&(s=s.filter(r=>e.statusCodes.includes(r.statusCode))),e.endpoints&&e.endpoints.length>0&&(s=s.filter(r=>e.endpoints.some(a=>r.url.includes(a)))),e.userIds&&e.userIds.length>0&&(s=s.filter(r=>r.userId&&e.userIds.includes(r.userId))),e.regions&&e.regions.length>0&&(s=s.filter(r=>r.region&&e.regions.includes(r.region))),e.devices&&e.devices.length>0&&(s=s.filter(r=>r.device&&e.devices.includes(r.device))),e.browsers&&e.browsers.length>0&&(s=s.filter(r=>r.browser&&e.browsers.includes(r.browser))),e.minDuration!==void 0&&(s=s.filter(r=>r.duration>=e.minDuration)),e.maxDuration!==void 0&&(s=s.filter(r=>r.duration<=e.maxDuration)),e.excludeErrors&&(s=s.filter(r=>r.statusCode<400)),e.onlyCached&&(s=s.filter(r=>r.cached)),s}calculateMetrics(e=this.data){if(e.length===0)return this.getEmptyMetrics();const s=e.length,r=e.filter(n=>n.statusCode>=200&&n.statusCode<400),a=e.filter(n=>n.statusCode>=400),d=e.filter(n=>n.cached),m=new Set(e.map(n=>n.userId).filter(Boolean)).size,g=e.map(n=>n.duration).sort((n,h)=>n-h),p=g.reduce((n,h)=>n+h,0)/g.length,v=g[Math.floor(g.length*.95)]||0,b=g[Math.floor(g.length*.99)]||0,T=e.length>1?(Math.max(...e.map(n=>n.timestamp))-Math.min(...e.map(n=>n.timestamp)))/1e3:1,c=s/Math.max(T,1),l=e.reduce((n,h)=>n+h.size,0),u=new Map;e.forEach(n=>{const h=this.normalizeEndpoint(n.url),w=u.get(h)||{count:0,totalTime:0};w.count++,w.totalTime+=n.duration,u.set(h,w)});const o=Array.from(u.entries()).map(([n,h])=>({endpoint:n,count:h.count,avgTime:h.totalTime/h.count})).sort((n,h)=>h.count-n.count).slice(0,10),f={};a.forEach(n=>{const h=n.error||`HTTP ${n.statusCode}`;f[h]=(f[h]||0)+1});const j=[{min:0,max:100,label:"< 100ms"},{min:100,max:500,label:"100-500ms"},{min:500,max:1e3,label:"500ms-1s"},{min:1e3,max:3e3,label:"1-3s"},{min:3e3,max:1/0,label:"> 3s"}].map(n=>({range:n.label,count:e.filter(h=>h.duration>=n.min&&h.duration<n.max).length})),k={};e.forEach(n=>{n.region&&(k[n.region]=(k[n.region]||0)+1)});const M={};e.forEach(n=>{n.device&&(M[n.device]=(M[n.device]||0)+1)});const i={};e.forEach(n=>{n.browser&&(i[n.browser]=(i[n.browser]||0)+1)});const x=new Map;e.forEach(n=>{const h=new Date(n.timestamp).getHours(),w=x.get(h)||{requests:0,totalTime:0};w.requests++,w.totalTime+=n.duration,x.set(h,w)});const D=Array.from(x.entries()).map(([n,h])=>({hour:n,requests:h.requests,avgTime:h.totalTime/h.requests})).sort((n,h)=>n.hour-h.hour),y={};return e.forEach(n=>{y[n.statusCode]=(y[n.statusCode]||0)+1}),{totalRequests:s,successRate:r.length/s*100,errorRate:a.length/s*100,avgResponseTime:p,p95ResponseTime:v,p99ResponseTime:b,throughput:c,totalDataTransfer:l,cacheHitRate:d.length>0?d.length/s*100:0,uniqueUsers:m,topEndpoints:o,errorsByType:f,responseTimeDistribution:j,geographicDistribution:k,deviceDistribution:M,browserDistribution:i,hourlyTraffic:D,statusCodeDistribution:y}}getEmptyMetrics(){return{totalRequests:0,successRate:0,errorRate:0,avgResponseTime:0,p95ResponseTime:0,p99ResponseTime:0,throughput:0,totalDataTransfer:0,cacheHitRate:0,uniqueUsers:0,topEndpoints:[],errorsByType:{},responseTimeDistribution:[],geographicDistribution:{},deviceDistribution:{},browserDistribution:{},hourlyTraffic:[],statusCodeDistribution:{}}}getTimeRangeMs(e){switch(e){case"1h":return 60*60*1e3;case"6h":return 6*60*60*1e3;case"24h":return 24*60*60*1e3;case"7d":return 7*24*60*60*1e3;case"30d":return 30*24*60*60*1e3;default:return null}}normalizeEndpoint(e){return e.split("?")[0].split("#")[0].replace(/\/\d+/g,"/:id")}extractMetricValue(e,s){const r=e[s];return typeof r=="number"?r:0}shouldTrack(e){if(Math.random()>this.config.sampleRate)return!1;if(e.url){for(const s of this.config.excludePatterns)if(s.test(e.url))return!1;if(this.config.includePatterns.length>0&&!this.config.includePatterns.some(r=>r.test(e.url)))return!1}return!0}enrichData(e){if(e.userAgent&&!e.browser){const s=this.parseUserAgent(e.userAgent);e.browser=s.browser,e.os=s.os,e.device=s.device}e.ip&&!e.region&&this.config.enableGeolocation&&(e.region=this.getRegionFromIP(e.ip))}parseUserAgent(e){let s="Unknown",r="Unknown",a="Desktop";return e.includes("Chrome")?s="Chrome":e.includes("Firefox")?s="Firefox":e.includes("Safari")?s="Safari":e.includes("Edge")&&(s="Edge"),e.includes("Windows")?r="Windows":e.includes("Mac OS")?r="macOS":e.includes("Linux")?r="Linux":e.includes("Android")?r="Android":e.includes("iOS")&&(r="iOS"),e.includes("Mobile")||e.includes("iPhone")||e.includes("Android")?a="Mobile":(e.includes("Tablet")||e.includes("iPad"))&&(a="Tablet"),{browser:s,os:r,device:a}}getRegionFromIP(e){const s=["北京","上海","广州","深圳","杭州","成都","武汉","西安"],r=e.split(".").reduce((a,d)=>a+parseInt(d),0);return s[r%s.length]}cleanupOldData(){const e=Date.now()-this.config.retentionDays*24*60*60*1e3;this.data=this.data.filter(s=>s.timestamp>e)}startAggregation(){this.aggregationTimer=setInterval(()=>{this.aggregate()},this.config.aggregationInterval)}aggregate(){const e=Date.now(),s=Math.floor(e/this.config.aggregationInterval).toString(),r=this.calculateMetrics();this.aggregatedData.set(s,r)}notifyListeners(e){this.listeners.forEach(s=>{try{s(e)}catch(r){console.error("Error in analytics listener:",r)}})}generateId(){return Math.random().toString(36).substr(2,9)}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}updateConfig(e){this.config={...this.config,...e},this.aggregationTimer&&clearInterval(this.aggregationTimer),this.config.enableRealTime&&this.startAggregation()}clear(){this.data=[],this.aggregatedData.clear()}destroy(){this.aggregationTimer&&clearInterval(this.aggregationTimer),this.listeners.clear(),this.clear()}}const H=({className:N=""})=>{const[e]=R.useState(()=>new $({enableRealTime:!0,aggregationInterval:5e3,retentionDays:7})),[s,r]=R.useState(null),[a,d]=R.useState({timeRange:"24h"}),[m,g]=R.useState("overview"),[p,v]=R.useState(!1),[b,T]=R.useState(!1),c=R.useRef(null),l=()=>{const i=e.getMetrics(a);r(i)},u=(i=50)=>{v(!0);const x=["GET","POST","PUT","DELETE","PATCH"],D=["/api/users","/api/products","/api/orders","/api/auth/login","/api/auth/logout","/api/dashboard","/api/settings","/api/reports","/api/analytics","/api/notifications"],y=["北京","上海","广州","深圳","杭州","成都","武汉","西安"],n=["Desktop","Mobile","Tablet"],h=["Chrome","Firefox","Safari","Edge"],w=Array.from({length:20},(C,P)=>`user_${P+1}`),B=[];for(let C=0;C<i;C++){const P=x[Math.floor(Math.random()*x.length)],U=D[Math.floor(Math.random()*D.length)],I=Math.random()<.1,A=Math.random()<.3,O={url:U+(Math.random()<.3?`/${Math.floor(Math.random()*1e3)}`:""),method:P,statusCode:I?[400,401,403,404,500,502,503][Math.floor(Math.random()*7)]:[200,201,204][Math.floor(Math.random()*3)],duration:Math.floor(Math.random()*2e3)+(I?5e3:100),size:Math.floor(Math.random()*1e5)+1e3,timestamp:Date.now()-Math.floor(Math.random()*24*60*60*1e3),userId:w[Math.floor(Math.random()*w.length)],region:y[Math.floor(Math.random()*y.length)],device:n[Math.floor(Math.random()*n.length)],browser:h[Math.floor(Math.random()*h.length)],cached:A,error:I?"网络错误":void 0,ip:`192.168.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,userAgent:`Mozilla/5.0 (${n[Math.floor(Math.random()*n.length)]}) ${h[Math.floor(Math.random()*h.length)]}`};B.push(O)}e.trackBatch(B),l(),v(!1)},o=()=>{e.clear(),l()},f=i=>{const x=e.export(i,a),D=new Blob([x],{type:i==="json"?"application/json":"text/csv"}),y=URL.createObjectURL(D),n=document.createElement("a");n.href=y,n.download=`analytics_${Date.now()}.${i}`,n.click(),URL.revokeObjectURL(y)},E=()=>{const i=e.generateReport(a),x=JSON.stringify(i,null,2),D=new Blob([x],{type:"application/json"}),y=URL.createObjectURL(D),n=document.createElement("a");n.href=y,n.download=`analytics_report_${Date.now()}.json`,n.click(),URL.revokeObjectURL(y)};R.useEffect(()=>(b?c.current=setInterval(()=>{u(10)},3e3):c.current&&(clearInterval(c.current),c.current=null),()=>{c.current&&clearInterval(c.current)}),[b]),R.useEffect(()=>{const i=x=>{r(x)};return e.addListener(i),l(),()=>{e.removeListener(i)}},[e,a]);const j=i=>i>=1e6?(i/1e6).toFixed(1)+"M":i>=1e3?(i/1e3).toFixed(1)+"K":i.toString(),k=i=>i>=1024*1024*1024?(i/(1024*1024*1024)).toFixed(1)+" GB":i>=1024*1024?(i/(1024*1024)).toFixed(1)+" MB":i>=1024?(i/1024).toFixed(1)+" KB":i+" B",M=i=>i>=1e3?(i/1e3).toFixed(2)+"s":Math.round(i)+"ms";return t.jsxs("div",{className:`space-y-6 ${N}`,children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"请求分析控制台"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[t.jsx("button",{onClick:()=>u(50),disabled:p,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:p?"生成中...":"生成数据"}),t.jsx("button",{onClick:()=>T(!b),className:`px-4 py-2 rounded ${b?"bg-red-500 text-white hover:bg-red-600":"bg-green-500 text-white hover:bg-green-600"}`,children:b?"停止自动生成":"开始自动生成"}),t.jsx("button",{onClick:o,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"清空数据"}),t.jsx("button",{onClick:E,className:"px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600",children:"生成报告"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"时间范围"}),t.jsxs("select",{value:a.timeRange||"24h",onChange:i=>d({...a,timeRange:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"1h",children:"最近1小时"}),t.jsx("option",{value:"6h",children:"最近6小时"}),t.jsx("option",{value:"24h",children:"最近24小时"}),t.jsx("option",{value:"7d",children:"最近7天"}),t.jsx("option",{value:"30d",children:"最近30天"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"导出数据"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:()=>f("json"),className:"px-3 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600 text-sm",children:"JSON"}),t.jsx("button",{onClick:()=>f("csv"),className:"px-3 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600 text-sm",children:"CSV"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"过滤选项"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:a.excludeErrors||!1,onChange:i=>d({...a,excludeErrors:i.target.checked}),className:"mr-1"}),t.jsx("span",{className:"text-sm",children:"排除错误"})]}),t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:a.onlyCached||!1,onChange:i=>d({...a,onlyCached:i.target.checked}),className:"mr-1"}),t.jsx("span",{className:"text-sm",children:"仅缓存"})]})]})]})]})]}),s&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"总请求数"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j(s.totalRequests)})]}),t.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-blue-600 text-sm",children:"📊"})})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"成功率"}),t.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[s.successRate.toFixed(1),"%"]})]}),t.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-green-600 text-sm",children:"✅"})})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"平均响应时间"}),t.jsx("p",{className:"text-2xl font-bold text-orange-600",children:M(s.avgResponseTime)})]}),t.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-orange-600 text-sm",children:"⏱️"})})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"错误率"}),t.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[s.errorRate.toFixed(1),"%"]})]}),t.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-red-600 text-sm",children:"❌"})})]})})]}),s&&t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[t.jsx("div",{className:"border-b border-gray-200",children:t.jsx("nav",{className:"flex space-x-8 px-6",children:[{key:"overview",label:"概览",icon:"📊"},{key:"performance",label:"性能",icon:"⚡"},{key:"errors",label:"错误",icon:"🚨"},{key:"users",label:"用户",icon:"👥"}].map(i=>t.jsxs("button",{onClick:()=>g(i.key),className:`py-4 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ${m===i.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t.jsx("span",{children:i.icon}),t.jsx("span",{children:i.label})]},i.key))})}),t.jsxs("div",{className:"p-6",children:[m==="overview"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold mb-4",children:"热门端点"}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"端点"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"请求数"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"平均时间"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.topEndpoints.slice(0,5).map((i,x)=>t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:i.endpoint}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:j(i.count)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:M(i.avgTime)})]},x))})]})})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold mb-4",children:"响应时间分布"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:s.responseTimeDistribution.map((i,x)=>t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:j(i.count)}),t.jsx("div",{className:"text-sm text-gray-600",children:i.range})]},x))})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold mb-4",children:"状态码分布"}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(s.statusCodeDistribution).map(([i,x])=>t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[t.jsx("div",{className:"text-xl font-bold text-gray-900",children:j(x)}),t.jsxs("div",{className:"text-sm text-gray-600",children:["HTTP ",i]})]},i))})]})]}),m==="performance"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("div",{className:"text-sm text-gray-600",children:"平均响应时间"}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:M(s.avgResponseTime)})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("div",{className:"text-sm text-gray-600",children:"P95响应时间"}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:M(s.p95ResponseTime)})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("div",{className:"text-sm text-gray-600",children:"P99响应时间"}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:M(s.p99ResponseTime)})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("div",{className:"text-sm text-gray-600",children:"吞吐量"}),t.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[s.throughput.toFixed(2)," req/s"]})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("div",{className:"text-sm text-gray-600",children:"数据传输总量"}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:k(s.totalDataTransfer)})]})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("div",{className:"text-sm text-gray-600",children:"缓存命中率"}),t.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[s.cacheHitRate.toFixed(1),"%"]})]})]}),m==="errors"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[t.jsx("div",{className:"text-sm text-red-600",children:"错误率"}),t.jsxs("div",{className:"text-2xl font-bold text-red-900",children:[s.errorRate.toFixed(1),"%"]})]}),t.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[t.jsx("div",{className:"text-sm text-red-600",children:"错误总数"}),t.jsx("div",{className:"text-2xl font-bold text-red-900",children:j(Object.values(s.errorsByType).reduce((i,x)=>i+x,0))})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold mb-4",children:"错误类型分布"}),t.jsx("div",{className:"space-y-2",children:Object.entries(s.errorsByType).map(([i,x])=>t.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[t.jsx("span",{className:"text-sm font-medium text-gray-900",children:i}),t.jsx("span",{className:"text-sm text-gray-600",children:j(x)})]},i))})]})]}),m==="users"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsx("div",{className:"text-sm text-blue-600",children:"独立用户数"}),t.jsx("div",{className:"text-2xl font-bold text-blue-900",children:j(s.uniqueUsers)})]})}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold mb-4",children:"地理分布"}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(s.geographicDistribution).map(([i,x])=>t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[t.jsx("div",{className:"text-xl font-bold text-gray-900",children:j(x)}),t.jsx("div",{className:"text-sm text-gray-600",children:i})]},i))})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold mb-4",children:"设备分布"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(s.deviceDistribution).map(([i,x])=>t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[t.jsx("div",{className:"text-xl font-bold text-gray-900",children:j(x)}),t.jsx("div",{className:"text-sm text-gray-600",children:i})]},i))})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold mb-4",children:"浏览器分布"}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(s.browserDistribution).map(([i,x])=>t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[t.jsx("div",{className:"text-xl font-bold text-gray-900",children:j(x)}),t.jsx("div",{className:"text-sm text-gray-600",children:i})]},i))})]})]})]})]}),!s||s.totalRequests===0?t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-12 text-center",children:[t.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"📊"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"暂无分析数据"}),t.jsx("p",{className:"text-gray-600 mb-6",children:'点击"生成数据"按钮创建一些模拟请求数据，或开启"自动生成"来持续生成数据。'}),t.jsx("button",{onClick:()=>u(100),className:"px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"生成示例数据"})]}):null]})},K=()=>{const N=[{title:"核心概念",items:["请求分析：收集和分析HTTP请求的性能数据","实时监控：持续跟踪请求状态和性能指标","数据聚合：将原始数据转换为有意义的统计信息","多维分析：从时间、地理、设备等多个维度分析数据"]},{title:"主要优势",items:["实时数据收集和聚合处理","多维度性能指标计算（P95、P99等）","智能错误分析和分类统计","用户行为和地理分布分析"]},{title:"适用场景",items:["性能分析和瓶颈定位","错误监控和异常追踪","用户行为分析和优化","地理分布和设备统计"]},{title:"注意事项",items:["合理设置采样率和数据保留期，避免性能问题","定期清理过期数据，防止内存泄漏","监控实时聚合频率，避免主线程阻塞","注意数据隐私和安全合规性"]}],e=[{title:"基础请求分析",component:t.jsx(H,{}),description:"展示完整的请求分析功能，包括数据生成、实时监控和多维度分析。",observationPoints:["点击'生成数据'按钮观察请求数据的实时统计","查看总请求数、成功率、平均响应时间等核心指标","切换不同标签页查看性能、错误、用户等详细分析","使用时间范围过滤器观察数据变化","开启'自动生成'观察实时数据更新效果"],keyPoints:["实时数据收集和聚合处理","多维度性能指标计算（P95、P99等）","智能错误分析和分类统计","用户行为和地理分布分析","灵活的数据过滤和导出功能"],commonTraps:["数据采样率设置不当导致性能问题","未正确处理大量数据的内存占用","实时聚合频率过高影响性能","缺少数据清理机制导致内存泄漏","过度复杂的过滤条件影响查询效率"],solutions:["合理设置采样率和数据保留期","实现数据分页和虚拟滚动","使用防抖和节流优化实时更新","定期清理过期数据","优化过滤算法和索引策略"],importantTips:["左侧控制面板可以生成模拟数据和配置过滤条件","统计概览显示核心性能指标的实时数据","详细分析标签页提供深入的多维度分析","支持JSON和CSV格式的数据导出功能","自动生成模式可以模拟真实的数据流场景"]}],s={concepts:["请求分析：收集和分析HTTP请求的性能数据","实时监控：持续跟踪请求状态和性能指标","数据聚合：将原始数据转换为有意义的统计信息","多维分析：从时间、地理、设备等多个维度分析数据","性能指标：响应时间、吞吐量、错误率等关键指标","用户分析：基于用户行为的访问模式分析"],steps:["创建RequestAnalytics类实例并配置参数","实现track方法收集单个请求数据","使用trackBatch方法批量处理请求数据","调用getMetrics方法获取分析指标","实现数据过滤和时间范围选择","添加实时监听器处理数据更新","实现数据导出和报告生成功能","集成可视化组件展示分析结果"],tips:["合理设置采样率平衡性能和数据完整性","使用异步处理避免阻塞主线程","实现数据缓存减少重复计算","添加错误处理确保系统稳定性","定期清理过期数据防止内存泄漏","使用Web Workers处理大量数据计算"]},r={questions:[{question:"如何设计一个高性能的请求分析系统？",answer:"需要考虑数据收集、存储、处理和展示四个层面。数据收集使用采样和批处理减少开销；存储采用时间序列数据库优化查询；处理使用流式计算和预聚合提高效率；展示采用分页和虚拟化技术处理大量数据。"},{question:"请求分析中的关键性能指标有哪些？",answer:"主要包括：响应时间指标（平均值、P95、P99）、吞吐量（QPS/TPS）、错误率、成功率、缓存命中率、数据传输量等。这些指标从不同角度反映系统性能状况。"},{question:"如何处理大量请求数据的实时分析？",answer:"采用流式处理架构，使用滑动窗口和增量计算；实现数据分层存储，热数据在内存，冷数据在磁盘；使用预聚合减少实时计算量；采用异步处理和消息队列解耦数据收集和分析。"},{question:"如何实现多维度的数据分析和过滤？",answer:"建立多维数据模型，支持按时间、地理、设备、用户等维度切片；实现灵活的过滤器系统，支持组合条件查询；使用索引优化查询性能；提供预定义的分析模板和自定义查询能力。"}],keyPoints:["数据收集的采样策略和性能优化","实时分析的架构设计和技术选型","多维度数据模型和查询优化","可视化展示的用户体验设计","系统扩展性和容错性考虑"]},a={dos:["设计合理的数据采样策略","实现增量式数据处理","使用缓存优化查询性能","提供灵活的过滤和聚合功能","实现数据的自动清理机制","添加完善的错误处理和监控","支持数据导出和报告生成","优化大数据量的展示性能"],donts:["不要收集过多不必要的数据","不要在主线程进行大量计算","不要忽略数据隐私和安全","不要使用同步操作阻塞界面","不要缺少数据验证和清洗","不要忽略系统的扩展性设计","不要过度复杂化分析逻辑","不要缺少性能监控和告警"],patterns:["观察者模式：实现数据变化的实时通知","策略模式：支持不同的分析算法","工厂模式：创建不同类型的分析器","装饰器模式：扩展分析功能","命令模式：封装分析操作","责任链模式：处理数据过滤流程"]};return t.jsx(L,{title:"请求分析 Request Analytics",description:"实现完整的HTTP请求分析系统，提供实时监控、性能分析、错误追踪和用户行为分析功能",overview:N,examples:e,tutorial:s,interview:r,bestPractices:a})};export{K as default};
