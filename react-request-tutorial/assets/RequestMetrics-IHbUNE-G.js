var D=Object.defineProperty;var k=(g,r,o)=>r in g?D(g,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):g[r]=o;var j=(g,r,o)=>k(g,typeof r!="symbol"?r+"":r,o);import{r as x,j as e}from"./index-C7SuDyTR.js";import{C as _}from"./ComponentTemplate-BzrYXZsv.js";class N{constructor(r={}){j(this,"metrics",new Map);j(this,"collectors",new Map);j(this,"aggregators",new Map);j(this,"config");j(this,"observers",new Set);j(this,"isCollecting",!1);j(this,"collectionInterval");this.config={collectionInterval:1e3,retentionPeriod:36e5,maxDataPoints:1e3,enableAutoCollection:!1,aggregationWindow:6e4,...r}}registerCollector(r,o){this.collectors.set(r,o),this.metrics.has(r)||this.metrics.set(r,{name:r,type:o.type,values:[],aggregatedValues:new Map,metadata:o.metadata||{}})}registerAggregator(r,o){this.aggregators.set(r,o)}startCollection(){this.isCollecting||(this.isCollecting=!0,this.collectionInterval=setInterval(()=>{this.collectMetrics()},this.config.collectionInterval),this.config.enableAutoCollection&&this.collectMetrics())}stopCollection(){this.isCollecting&&(this.isCollecting=!1,this.collectionInterval&&(clearInterval(this.collectionInterval),this.collectionInterval=void 0))}async collectMetrics(){const r=Date.now();for(const[o,m]of this.collectors)try{const n=await m.collect();this.recordMetric(o,n,r)}catch(n){console.error(`Failed to collect metric ${o}:`,n)}this.performAggregation(),this.cleanupExpiredData(),this.notifyObservers("metrics_collected",{timestamp:r})}recordMetric(r,o,m){const n=this.metrics.get(r);if(!n){console.warn(`Metric ${r} not found. Please register collector first.`);return}const i={value:o,timestamp:m||Date.now()};n.values.push(i),n.values.length>this.config.maxDataPoints&&n.values.shift()}performAggregation(){const r=Date.now(),o=this.config.aggregationWindow;for(const[m,n]of this.metrics){const i=this.aggregators.get(m);if(!i)continue;const p=Math.floor(r/o)*o,s=n.values.filter(l=>l.timestamp>=p&&l.timestamp<p+o);if(s.length>0){const d={value:i.aggregate(s),timestamp:p+o/2,count:s.length};n.aggregatedValues.set(p,d)}}}cleanupExpiredData(){const r=Date.now(),o=this.config.retentionPeriod,m=r-o;for(const n of this.metrics.values()){n.values=n.values.filter(i=>i.timestamp>m);for(const[i]of n.aggregatedValues)i<m&&n.aggregatedValues.delete(i)}}getMetric(r,o={}){const m=this.metrics.get(r);if(!m)return null;const{startTime:n,endTime:i,useAggregated:p=!1,limit:s}=o;let l;return p?l=Array.from(m.aggregatedValues.values()):l=m.values,(n||i)&&(l=l.filter(d=>!(n&&d.timestamp<n||i&&d.timestamp>i))),s&&l.length>s&&(l=l.slice(-s)),{name:m.name,type:m.type,values:l,metadata:m.metadata}}getAllMetrics(r={}){return Array.from(this.metrics.keys()).map(o=>this.getMetric(o,r)).filter(o=>o!==null)}calculateStats(r,o={}){const m=this.getMetric(r,o);if(!m||m.values.length===0)return null;const n=m.values.map(u=>u.value).sort((u,h)=>u-h),i=n.length,p=n.reduce((u,h)=>u+h,0),s=p/i,l=i%2===0?(n[i/2-1]+n[i/2])/2:n[Math.floor(i/2)],d=n.reduce((u,h)=>u+Math.pow(h-s,2),0)/i,a=Math.sqrt(d),t=Math.ceil(i*.95)-1,c=Math.ceil(i*.99)-1;return{name:r,count:i,sum:p,mean:s,median:l,min:n[0],max:n[i-1],stdDev:a,variance:d,p95:n[t]||n[i-1],p99:n[c]||n[i-1]}}query(r){const{metrics:o,startTime:m,endTime:n,aggregation:i,filters:p}=r,s={metrics:{},timestamp:Date.now()};for(const l of o){const d=this.getMetric(l,{startTime:m,endTime:n,useAggregated:!!i});if(!d)continue;let a=d.values;p&&p.length>0&&(a=a.filter(t=>p.every(c=>{switch(c.operator){case"gt":return t.value>c.value;case"gte":return t.value>=c.value;case"lt":return t.value<c.value;case"lte":return t.value<=c.value;case"eq":return t.value===c.value;default:return!0}}))),i&&a.length>0&&(a=[{value:this.performQueryAggregation(a,i),timestamp:a[a.length-1].timestamp}]),s.metrics[l]=a}return s}performQueryAggregation(r,o){const m=r.map(n=>n.value);switch(o){case"avg":return m.reduce((n,i)=>n+i,0)/m.length;case"sum":return m.reduce((n,i)=>n+i,0);case"min":return Math.min(...m);case"max":return Math.max(...m);case"count":return m.length;default:return m[m.length-1]||0}}addObserver(r){this.observers.add(r)}removeObserver(r){this.observers.delete(r)}notifyObservers(r,o){for(const m of this.observers){const n=m[r];if(typeof n=="function")try{n(o)}catch(i){console.error(`Error in observer handler for ${r}:`,i)}}}exportMetrics(r="json"){const o=this.getAllMetrics();if(r==="json")return JSON.stringify(o,null,2);{const n=[["name","type","timestamp","value"].join(",")];for(const i of o)for(const p of i.values)n.push([i.name,i.type,p.timestamp,p.value].join(","));return n.join(`
`)}}cleanup(){this.stopCollection(),this.metrics.clear(),this.collectors.clear(),this.aggregators.clear(),this.observers.clear()}}const T=()=>{const[g]=x.useState(()=>{const t=new N({collectionInterval:1e3,maxDataPoints:100});return t.registerCollector("response_time",{type:"gauge",metadata:{unit:"ms",description:"API响应时间"},collect:()=>100+Math.random()*500}),t.registerCollector("request_count",{type:"counter",metadata:{unit:"count",description:"请求总数"},collect:()=>Math.floor(Math.random()*10)+1}),t.registerCollector("error_rate",{type:"gauge",metadata:{unit:"percent",description:"错误率"},collect:()=>Math.random()*5}),t.registerCollector("cpu_usage",{type:"gauge",metadata:{unit:"percent",description:"CPU使用率"},collect:()=>20+Math.random()*60}),t.registerAggregator("response_time",{aggregate:c=>c.reduce((u,h)=>u+h.value,0)/c.length}),t.registerAggregator("request_count",{aggregate:c=>c.reduce((u,h)=>u+h.value,0)}),t}),[r,o]=x.useState([]),[m,n]=x.useState({}),[i,p]=x.useState(!1),s=x.useCallback(()=>{const t=g.getAllMetrics({limit:50});o(t);const c={};t.forEach(u=>{const h=g.calculateStats(u.name);h&&(c[u.name]=h)}),n(c)},[g]);x.useEffect(()=>{const t={metrics_collected:()=>{s()}};return g.addObserver(t),()=>{g.removeObserver(t),g.cleanup()}},[g,s]);const l=x.useCallback(()=>{i?g.stopCollection():g.startCollection(),p(!i)},[g,i]),d=x.useCallback(()=>{const t=Math.random()*1e3;g.recordMetric("response_time",t),s()},[g,s]),a=x.useCallback(()=>{const t=g.exportMetrics("json"),c=new Blob([t],{type:"application/json"}),u=URL.createObjectURL(c),h=document.createElement("a");h.href=u,h.download="metrics.json",h.click(),URL.revokeObjectURL(u)},[g]);return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"基础指标监控"}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("button",{onClick:l,className:`px-4 py-2 rounded transition-colors ${i?"bg-red-500 text-white hover:bg-red-600":"bg-green-500 text-white hover:bg-green-600"}`,children:i?"停止收集":"开始收集"}),e.jsx("button",{onClick:d,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"记录自定义指标"}),e.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"导出数据"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"实时指标"}),e.jsx("div",{className:"space-y-4",children:r.map(t=>{const c=t.values[t.values.length-1],u=m[t.name];return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h5",{className:"font-medium",children:t.metadata.description||t.name}),e.jsx("span",{className:"text-sm text-gray-500",children:t.type})]}),c&&e.jsxs("div",{className:"text-2xl font-bold text-blue-600 mb-2",children:[c.value.toFixed(2)," ",t.metadata.unit]}),u&&e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm text-gray-600",children:[e.jsxs("div",{children:["平均: ",u.mean.toFixed(2)]}),e.jsxs("div",{children:["最小: ",u.min.toFixed(2)]}),e.jsxs("div",{children:["最大: ",u.max.toFixed(2)]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["数据点: ",t.values.length]})]},t.name)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"统计信息"}),e.jsx("div",{className:"space-y-4",children:Object.entries(m).map(([t,c])=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h5",{className:"font-medium mb-3",children:t}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"计数:"}),e.jsx("span",{className:"font-medium",children:c.count})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"总和:"}),e.jsx("span",{className:"font-medium",children:c.sum.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"平均值:"}),e.jsx("span",{className:"font-medium",children:c.mean.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"中位数:"}),e.jsx("span",{className:"font-medium",children:c.median.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"标准差:"}),e.jsx("span",{className:"font-medium",children:c.stdDev.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"P95:"}),e.jsx("span",{className:"font-medium",children:c.p95.toFixed(2)})]})]})]},t))})]})]})]})})},A=()=>{const[g]=x.useState(()=>{const a=new N({collectionInterval:500,maxDataPoints:200});return["api_latency","throughput","memory_usage","disk_io"].forEach(t=>{a.registerCollector(t,{type:"gauge",metadata:{unit:t.includes("latency")?"ms":"count"},collect:()=>{const c={api_latency:200,throughput:100,memory_usage:50,disk_io:10}[t]||50;return c+Math.random()*c}})}),a.startCollection(),a}),[r,o]=x.useState(null),[m,n]=x.useState(null),[i,p]=x.useState(!1),[s,l]=x.useState({metrics:["api_latency","throughput"],aggregation:"avg",timeRange:6e4,filterValue:0,filterOperator:"gt",timeSegments:10,showTimeSeries:!0}),d=x.useCallback(()=>{console.log("执行查询被调用",{queryConfig:s}),p(!0);try{const a=Date.now(),t=a-s.timeRange;console.log("查询时间范围:",{startTime:new Date(t),endTime:new Date(a)});const c=g.query({metrics:s.metrics,startTime:t,endTime:a,aggregation:s.aggregation,filters:s.filterValue>0?[{operator:s.filterOperator,value:s.filterValue}]:void 0});if(console.log("查询结果:",c),o(c),s.showTimeSeries){const u=s.timeSegments,h=s.timeRange/u,f={metrics:{},timeSegments:[],timestamp:a};s.metrics.forEach(v=>{f.metrics[v]=[]});for(let v=0;v<u;v++){const b=t+v*h,w=b+h,M=g.query({metrics:s.metrics,startTime:b,endTime:w,aggregation:s.aggregation,filters:s.filterValue>0?[{operator:s.filterOperator,value:s.filterValue}]:void 0});f.timeSegments.push({startTime:b,endTime:w,data:M}),s.metrics.forEach(C=>{const y=M.metrics[C];if(y&&y.length>0){const S=y[0];f.metrics[C].push({value:S.value,timestamp:S.timestamp,startTime:b,endTime:w,count:y.length})}})}console.log("分时段查询结果:",f),n(f)}}catch(a){console.error("查询执行出错:",a),alert(`查询执行出错: ${a instanceof Error?a.message:"未知错误"}`)}finally{p(!1)}},[g,s]);return x.useEffect(()=>()=>{g.cleanup()},[g]),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"高级查询功能"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"选择指标"}),e.jsx("div",{className:"space-y-2",children:["api_latency","throughput","memory_usage","disk_io"].map(a=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:s.metrics.includes(a),onChange:t=>{t.target.checked?l(c=>({...c,metrics:[...c.metrics,a]})):l(c=>({...c,metrics:c.metrics.filter(u=>u!==a)}))},className:"rounded"}),e.jsx("span",{className:"text-sm",children:a})]},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"聚合方式"}),e.jsxs("select",{value:s.aggregation,onChange:a=>l(t=>({...t,aggregation:a.target.value})),className:"w-full px-3 py-2 border rounded-md",children:[e.jsx("option",{value:"avg",children:"平均值"}),e.jsx("option",{value:"sum",children:"总和"}),e.jsx("option",{value:"min",children:"最小值"}),e.jsx("option",{value:"max",children:"最大值"}),e.jsx("option",{value:"count",children:"计数"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"时间范围"}),e.jsxs("select",{value:s.timeRange,onChange:a=>l(t=>({...t,timeRange:parseInt(a.target.value)})),className:"w-full px-3 py-2 border rounded-md",children:[e.jsx("option",{value:3e4,children:"30秒"}),e.jsx("option",{value:6e4,children:"1分钟"}),e.jsx("option",{value:3e5,children:"5分钟"}),e.jsx("option",{value:6e5,children:"10分钟"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"分时段数量"}),e.jsxs("select",{value:s.timeSegments,onChange:a=>l(t=>({...t,timeSegments:parseInt(a.target.value)})),className:"w-full px-3 py-2 border rounded-md",children:[e.jsx("option",{value:5,children:"5个时段"}),e.jsx("option",{value:10,children:"10个时段"}),e.jsx("option",{value:20,children:"20个时段"}),e.jsx("option",{value:30,children:"30个时段"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"showTimeSeries",checked:s.showTimeSeries,onChange:a=>l(t=>({...t,showTimeSeries:a.target.checked})),className:"rounded mr-2"}),e.jsx("label",{htmlFor:"showTimeSeries",className:"text-sm",children:"显示分时段结果"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"过滤条件"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:s.filterOperator,onChange:a=>l(t=>({...t,filterOperator:a.target.value})),className:"px-3 py-2 border rounded-md",children:[e.jsx("option",{value:"gt",children:"大于"}),e.jsx("option",{value:"gte",children:"大于等于"}),e.jsx("option",{value:"lt",children:"小于"}),e.jsx("option",{value:"lte",children:"小于等于"}),e.jsx("option",{value:"eq",children:"等于"})]}),e.jsx("input",{type:"number",value:s.filterValue,onChange:a=>l(t=>({...t,filterValue:parseFloat(a.target.value)||0})),className:"flex-1 px-3 py-2 border rounded-md",placeholder:"过滤值 (0表示不过滤)"})]})]}),e.jsx("button",{onClick:d,disabled:i||s.metrics.length===0,className:"w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors disabled:bg-gray-400",children:i?"查询中...":"执行查询"})]})]}),r&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-medium mb-3",children:"查询结果"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:["查询时间: ",new Date(r.timestamp).toLocaleString()]}),e.jsx("div",{className:"space-y-2",children:Object.entries(r.metrics).map(([a,t])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"font-medium",children:[a,":"]}),e.jsx("span",{children:t.length>0?`${t[0].value.toFixed(2)} (${t.length}个数据点)`:"无数据"})]},a))})]})]}),m&&s.showTimeSeries&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-medium mb-3",children:"分时段分析"}),e.jsx("div",{className:"space-y-4",children:Object.entries(m.metrics).map(([a,t])=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h5",{className:"font-medium mb-3",children:a}),e.jsx("div",{className:"grid grid-cols-5 gap-2 text-sm",children:t.map((c,u)=>e.jsxs("div",{className:"bg-white p-2 rounded text-center",children:[e.jsx("div",{className:"font-medium",children:c.value.toFixed(1)}),e.jsxs("div",{className:"text-xs text-gray-500",children:["时段 ",u+1]})]},u))})]},a))})]})]})})},P=()=>{const[g]=x.useState(()=>{const s=new N({collectionInterval:200,maxDataPoints:500,aggregationWindow:5e3});return[{name:"page_load_time",base:1e3,variance:500,unit:"ms"},{name:"api_response_time",base:200,variance:100,unit:"ms"},{name:"memory_usage",base:60,variance:20,unit:"MB"},{name:"cpu_usage",base:40,variance:30,unit:"%"},{name:"network_latency",base:50,variance:25,unit:"ms"}].forEach(({name:d,base:a,variance:t,unit:c})=>{s.registerCollector(d,{type:"gauge",metadata:{unit:c,description:d.replace(/_/g," ").toUpperCase()},collect:()=>{const u=Math.sin(Date.now()/1e4)*.3,h=(Math.random()-.5)*2;return Math.max(0,a+t*(u+h*.5))}}),s.registerAggregator(d,{aggregate:u=>{const h=u.map(v=>v.value).sort((v,b)=>v-b),f=Math.floor(h.length*.95);return h[f]||h[h.length-1]||0}})}),s.startCollection(),s}),[r,o]=x.useState({current:{},history:{},alerts:[]}),[m]=x.useState({page_load_time:{warning:2e3,critical:3e3},api_response_time:{warning:500,critical:1e3},memory_usage:{warning:80,critical:90},cpu_usage:{warning:70,critical:85},network_latency:{warning:100,critical:200}}),n=x.useCallback(()=>{const s=g.getAllMetrics({limit:100}),l={current:{},history:{},alerts:[...r.alerts]};s.forEach(d=>{if(d.values.length===0)return;const a=d.values[d.values.length-1],t=d.values.length>1?d.values[d.values.length-2]:a,c=a.value-t.value,u=c>0?"上升":c<0?"下降":"稳定",h=m[d.name];let f="正常";h&&(a.value>=h.critical?(f="严重",l.alerts.push({metric:d.name,message:`${d.metadata.description} 达到严重阈值: ${a.value.toFixed(2)}${d.metadata.unit}`,severity:"critical",timestamp:a.timestamp})):a.value>=h.warning&&(f="警告",l.alerts.push({metric:d.name,message:`${d.metadata.description} 达到警告阈值: ${a.value.toFixed(2)}${d.metadata.unit}`,severity:"warning",timestamp:a.timestamp}))),l.current[d.name]={value:a.value,trend:u,status:f},l.history[d.name]=d.values.slice(-50).map(v=>({timestamp:v.timestamp,value:v.value}))}),l.alerts=l.alerts.slice(-20),o(l)},[g,m]);x.useEffect(()=>{const s={metrics_collected:n};return g.addObserver(s),n(),()=>{g.removeObserver(s),g.cleanup()}},[g,n]);const i=x.useCallback(()=>{o(s=>({...s,alerts:[]}))},[]),p=x.useCallback(()=>{const s={timestamp:new Date().toISOString(),current:r.current,alerts:r.alerts,thresholds:m},l=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),d=URL.createObjectURL(l),a=document.createElement("a");a.href=d,a.download=`performance-report-${Date.now()}.json`,a.click(),URL.revokeObjectURL(d)},[r,m]);return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"性能监控分析"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:i,className:"px-3 py-1 text-sm bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"清除告警"}),e.jsx("button",{onClick:p,className:"px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"导出报告"})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4 mb-6",children:Object.entries(r.current).map(([s,l])=>{const d={正常:"text-green-600",警告:"text-yellow-600",严重:"text-red-600"}[l.status]||"text-gray-600",a={上升:"↗",下降:"↘",稳定:"→"}[l.trend]||"→";return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:s.replace(/_/g," ").toUpperCase()}),e.jsx("span",{className:`text-sm font-medium ${d}`,children:l.status})]}),e.jsx("div",{className:"text-2xl font-bold mb-1",children:l.value.toFixed(1)}),e.jsx("div",{className:"flex justify-between text-sm text-gray-600",children:e.jsxs("span",{children:["趋势: ",a," ",l.trend]})})]},s)})}),r.alerts.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium mb-3",children:"最近告警"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:r.alerts.slice(-10).reverse().map((s,l)=>e.jsx("div",{className:`p-3 rounded-lg text-sm ${s.severity==="critical"?"bg-red-50 border border-red-200 text-red-800":"bg-yellow-50 border border-yellow-200 text-yellow-800"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{children:s.message}),e.jsx("span",{className:"text-xs opacity-75",children:new Date(s.timestamp).toLocaleTimeString()})]})},l))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"性能趋势"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(r.history).map(([s,l])=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h5",{className:"font-medium mb-2",children:s.replace(/_/g," ").toUpperCase()}),e.jsx("div",{className:"h-20 flex items-end space-x-1",children:l.slice(-20).map((d,a)=>{const t=Math.max(...l.map(u=>u.value)),c=d.value/t*100;return e.jsx("div",{className:"flex-1 bg-blue-500 rounded-t",style:{height:`${c}%`},title:`${d.value.toFixed(1)} at ${new Date(d.timestamp).toLocaleTimeString()}`},a)})}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["最近 ",l.length," 个数据点"]})]},s))})]})]})})},V=()=>{const g=[{title:"核心概念",items:["指标收集：自动或手动收集各种性能和业务指标","数据聚合：对原始指标数据进行时间窗口聚合","统计分析：计算均值、中位数、百分位数等统计信息","查询过滤：支持时间范围、条件过滤的灵活查询","实时监控：提供实时指标监控和告警功能"]},{title:"主要优势",items:["灵活的指标定义和收集机制","高效的数据存储和查询性能","丰富的统计分析功能","支持实时监控和历史分析","可扩展的聚合和过滤能力"]},{title:"适用场景",items:["API性能监控和分析","系统资源使用情况跟踪","业务指标统计和报告","性能瓶颈识别和优化","SLA监控和告警"]},{title:"注意事项",items:["合理设置数据保留期限，避免内存溢出","选择合适的聚合窗口大小","注意指标收集的性能开销","及时清理过期数据"]}],r=[{title:"基础指标监控",component:e.jsx(T,{}),description:"演示基础的指标收集、统计和展示功能",observationPoints:["点击'开始收集'按钮开始自动收集指标数据","观察实时指标的数值变化和统计信息更新","点击'记录自定义指标'手动添加数据点","查看不同指标的平均值、最小值、最大值等统计信息"],keyPoints:["支持多种类型的指标收集器注册","提供实时的统计信息计算","可以手动记录自定义指标数据","支持数据导出功能"],commonTraps:["收集间隔设置过短导致性能问题","未设置数据点上限导致内存泄漏","忘记在组件卸载时清理资源"],solutions:["根据实际需求设置合理的收集间隔","使用maxDataPoints限制数据点数量","在useEffect的cleanup函数中调用manager.cleanup()"],importantTips:["指标收集器支持异步数据获取","统计信息会随着新数据自动更新","可以为不同指标设置不同的元数据"]},{title:"高级查询功能",component:e.jsx(A,{}),description:"展示复杂的指标查询、过滤和分时段分析功能",observationPoints:["选择不同的指标组合进行查询","尝试不同的聚合方式（平均值、最大值等）","设置过滤条件筛选特定范围的数据","观察分时段分析的结果展示"],keyPoints:["支持多指标联合查询","提供多种聚合算法","支持灵活的过滤条件","可以进行分时段趋势分析"],commonTraps:["查询时间范围过大导致性能问题","过滤条件设置不当返回空结果","分时段数量过多影响展示效果"],solutions:["合理设置查询时间范围","验证过滤条件的合理性","根据时间范围调整分时段数量"],importantTips:["查询结果包含原始数据和聚合数据","分时段分析有助于发现趋势变化","过滤条件支持多种比较操作符"]},{title:"性能监控分析",component:e.jsx(P,{}),description:"演示完整的性能监控系统，包括告警和趋势分析",observationPoints:["观察各项性能指标的实时状态和趋势","注意当指标超过阈值时的告警信息","查看性能趋势图表的变化模式","尝试导出性能报告功能"],keyPoints:["集成了完整的监控告警机制","提供可视化的趋势分析","支持多级告警阈值设置","可以生成性能分析报告"],commonTraps:["告警阈值设置不合理导致误报","历史数据过多影响图表性能","未及时处理告警信息"],solutions:["根据历史数据调整告警阈值","限制历史数据的展示数量","实现告警处理和确认机制"],importantTips:["性能监控需要持续的数据收集","趋势分析有助于预测性能问题","告警信息应该包含足够的上下文"]}],o={concepts:["指标收集器（MetricCollector）：定义如何收集特定指标的数据","指标聚合器（MetricAggregator）：定义如何对时间窗口内的数据进行聚合","指标管理器（MetricsManager）：负责协调收集、存储、查询等操作","查询引擎：支持复杂的时间范围、过滤条件和聚合操作","观察者模式：用于实时通知指标数据的变化"],steps:["创建RequestMetricsManager实例并配置参数","注册指标收集器，定义数据收集逻辑","注册聚合器，定义数据聚合算法","启动指标收集，开始自动数据采集","使用查询API获取和分析指标数据","实现观察者监听数据变化事件","在组件卸载时清理资源"],tips:["合理设置收集间隔，平衡数据精度和性能开销","使用聚合数据进行长期趋势分析","为关键指标设置合适的告警阈值","定期清理过期数据，避免内存泄漏","使用统计信息识别异常值和趋势"]},m={questions:[{question:"如何设计一个高效的指标收集系统？",answer:"需要考虑：1）异步收集避免阻塞主线程；2）批量处理提高效率；3）内存管理防止泄漏；4）可配置的收集策略；5）错误处理和恢复机制。"},{question:"指标数据的聚合策略有哪些？",answer:"常见策略包括：1）时间窗口聚合（固定窗口、滑动窗口）；2）统计聚合（平均值、最大值、百分位数）；3）采样聚合（降采样、上采样）；4）自定义聚合算法。"},{question:"如何处理大量指标数据的存储和查询？",answer:"可以采用：1）时序数据库存储；2）数据分层存储（热数据、冷数据）；3）索引优化；4）数据压缩；5）分布式存储；6）缓存机制。"},{question:"监控系统的告警机制如何设计？",answer:"包括：1）多级阈值设置；2）告警抑制和去重；3）告警路由和通知；4）告警确认和处理；5）告警统计和分析；6）自动恢复检测。"}],keyPoints:["指标系统的核心是数据的收集、存储、查询和分析","性能和准确性需要在设计时进行权衡","聚合策略直接影响数据的精度和存储效率","告警机制需要避免误报和漏报","可扩展性设计对于大规模系统至关重要"]},n={dos:["为不同类型的指标选择合适的收集策略","实现指标数据的分层存储和管理","使用观察者模式实现松耦合的事件通知","提供丰富的查询和分析API","实现完善的错误处理和恢复机制","定期进行性能优化和资源清理"],donts:["不要在收集过程中执行耗时操作","不要忽略内存使用和数据清理","不要设置过于频繁的收集间隔","不要在生产环境中收集过多详细数据","不要忽略指标数据的安全性"],patterns:["收集器模式：将数据收集逻辑封装成可插拔的组件","聚合器模式：提供灵活的数据聚合策略","观察者模式：实现事件驱动的数据处理","策略模式：支持多种查询和分析算法","工厂模式：动态创建不同类型的指标处理器"]};return e.jsx(_,{title:"请求指标系统",description:"全面的指标收集、聚合、查询和分析系统，支持实时监控和历史数据分析",overview:g,examples:r,tutorial:o,interview:m,bestPractices:n})};export{V as default};
