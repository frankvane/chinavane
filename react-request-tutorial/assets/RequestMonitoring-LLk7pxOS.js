var U=Object.defineProperty;var _=(l,t,s)=>t in l?U(l,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[t]=s;var y=(l,t,s)=>_(l,typeof t!="symbol"?t+"":t,s);import{j as e,r as u}from"./index-Bi_r7QuH.js";import{C as H}from"./ComponentTemplate-C5EWLtXX.js";class O{constructor(t={}){y(this,"config");y(this,"events",[]);y(this,"metrics",[]);y(this,"alertRules",new Map);y(this,"alerts",[]);y(this,"listeners",new Set);y(this,"metricsInterval");y(this,"cleanupInterval");y(this,"responseTimes",[]);y(this,"requestCounts",{});y(this,"errorCounts",{});this.config={enabled:!0,sampleRate:1,maxEvents:1e3,maxMetrics:100,alertEnabled:!0,reportInterval:5e3,retentionPeriod:24*60*60*1e3,...t},this.config.enabled&&(this.startMetricsCollection(),this.startCleanup())}recordRequestStart(t,s,n){if(!this.config.enabled||Math.random()>this.config.sampleRate)return"";const i={id:this.generateId(),type:"request",url:t,method:s,timestamp:Date.now(),metadata:n};return this.addEvent(i),this.updateRequestCounts(t,s),i.id}recordRequestSuccess(t,s,n,i,m,c){if(!this.config.enabled)return;const v={id:this.generateId(),type:"response",url:s,method:n,status:i,duration:m,timestamp:Date.now(),metadata:c};this.addEvent(v),this.responseTimes.push(m),this.responseTimes.length>1e3&&(this.responseTimes=this.responseTimes.slice(-500))}recordRequestError(t,s,n,i,m,c){if(!this.config.enabled)return;const v={id:this.generateId(),type:"error",url:s,method:n,error:i,duration:m,timestamp:Date.now(),metadata:c};this.addEvent(v),this.updateErrorCounts(s,n,i)}recordRequestTimeout(t,s,n,i,m){if(!this.config.enabled)return;const c={id:this.generateId(),type:"timeout",url:s,method:n,duration:i,timestamp:Date.now(),metadata:m};this.addEvent(c),this.updateErrorCounts(s,n,"timeout")}recordRequestRetry(t,s,n,i,m){if(!this.config.enabled)return;const c={id:this.generateId(),type:"retry",url:s,method:n,timestamp:Date.now(),metadata:{...m,retryCount:i}};this.addEvent(c)}recordCacheHit(t,s,n,i){if(!this.config.enabled)return;const m={id:this.generateId(),type:"cache",url:t,method:s,timestamp:Date.now(),metadata:{...i,cacheType:n,hit:!0}};this.addEvent(m)}addAlertRule(t){const s={...t,id:this.generateId()};return this.alertRules.set(s.id,s),s.id}removeAlertRule(t){return this.alertRules.delete(t)}updateAlertRule(t,s){const n=this.alertRules.get(t);return n?(this.alertRules.set(t,{...n,...s}),!0):!1}getAlertRules(){return Array.from(this.alertRules.values())}acknowledgeAlert(t){const s=this.alerts.find(n=>n.id===t);return s?(s.acknowledged=!0,this.notifyListeners({type:"alert_acknowledged",alert:s}),!0):!1}resolveAlert(t){const s=this.alerts.find(n=>n.id===t);return s?(s.resolved=!0,this.notifyListeners({type:"alert_resolved",alert:s}),!0):!1}getCurrentMetrics(){return this.calculateMetrics()}getHistoricalMetrics(t=50){return this.metrics.slice(-t)}getEvents(t=100,s){let n=this.events;return s&&(n=n.filter(i=>i.type===s)),n.slice(-t)}getAlerts(t=!1){return this.alerts.filter(s=>s.resolved===t)}getReport(t=60*60*1e3){const n=Date.now()-t,i=this.events.filter(a=>a.timestamp>=n),m=this.metrics.filter(a=>a.timestamp>=n),c=this.calculateMetrics(i),v={};i.filter(a=>a.type==="error").forEach(a=>{a.error&&(v[a.error]=(v[a.error]||0)+1)});const w=Object.entries(v).sort(([,a],[,d])=>d-a).slice(0,10).map(([a,d])=>({error:a,count:d})),p={};i.forEach(a=>{if(a.type==="response"&&a.duration){const d=`${a.method} ${a.url}`;p[d]||(p[d]={count:0,totalTime:0}),p[d].count++,p[d].totalTime+=a.duration}});const R=Object.entries(p).sort(([,a],[,d])=>d.count-a.count).slice(0,10).map(([a,d])=>({url:a,count:d.count,avgTime:Math.round(d.totalTime/d.count)})),f=m.map(a=>({timestamp:a.timestamp,metrics:a}));return{summary:c,topErrors:w,topEndpoints:R,timeline:f}}clear(){this.events=[],this.metrics=[],this.alerts=[],this.responseTimes=[],this.requestCounts={},this.errorCounts={},this.notifyListeners({type:"cleared"})}destroy(){this.config.enabled=!1,this.metricsInterval&&clearInterval(this.metricsInterval),this.cleanupInterval&&clearInterval(this.cleanupInterval),this.clear(),this.listeners.clear()}addListener(t){this.listeners.add(t)}removeListener(t){this.listeners.delete(t)}addEvent(t){this.events.push(t),this.events.length>this.config.maxEvents&&(this.events=this.events.slice(-Math.floor(this.config.maxEvents*.8))),this.notifyListeners({type:"event",event:t})}updateRequestCounts(t,s){const n=`${s} ${t}`;this.requestCounts[n]=(this.requestCounts[n]||0)+1}updateErrorCounts(t,s,n){const i=`${s} ${t}`;this.errorCounts[i]=(this.errorCounts[i]||0)+1}calculateMetrics(t){const s=t||this.events,n=Date.now(),i=n-60*1e3,m=n-1e3,c=s.filter(o=>o.timestamp>=i),v=s.filter(o=>o.timestamp>=m),w=c.filter(o=>o.type==="request"),p=c.filter(o=>o.type==="response"),R=c.filter(o=>o.type==="error"||o.type==="timeout"),f=c.filter(o=>o.type==="retry"),a=w.length,d=p.length,x=R.length,E=Math.max(0,a-d-x),g=p.map(o=>o.duration).filter(o=>o!==void 0).sort((o,P)=>o-P),I=g.length>0?Math.round(g.reduce((o,P)=>o+P,0)/g.length):0,A=g.length>0?g[0]:0,S=g.length>0?g[g.length-1]:0,$=Math.floor(g.length*.95),k=Math.floor(g.length*.99),D=g.length>0&&g[$]||0,r=g.length>0&&g[k]||0,h=a>0?x/a*100:0,b=c.filter(o=>o.type==="timeout"),N=a>0?b.length/a*100:0,q=a>0?f.length/a*100:0,M=v.filter(o=>o.type==="request").length,T=w.length,j=Math.round(this.events.length/this.config.maxEvents*100),C=Math.round(Math.random()*20+h/2),L=Math.round(I/10);return{totalRequests:a,successRequests:d,failedRequests:x,pendingRequests:E,avgResponseTime:I,minResponseTime:A,maxResponseTime:S,p95ResponseTime:D,p99ResponseTime:r,errorRate:Math.round(h*100)/100,timeoutRate:Math.round(N*100)/100,retryRate:Math.round(q*100)/100,requestsPerSecond:M,requestsPerMinute:T,memoryUsage:j,cpuUsage:C,networkUsage:L,timestamp:n}}checkAlerts(t){if(this.config.alertEnabled)for(const s of this.alertRules.values()){if(!s.enabled)continue;const n=t[s.metric];let i=!1;switch(s.operator){case">":i=n>s.threshold;break;case"<":i=n<s.threshold;break;case">=":i=n>=s.threshold;break;case"<=":i=n<=s.threshold;break;case"==":i=n===s.threshold;break;case"!=":i=n!==s.threshold;break}if(i&&!this.alerts.find(c=>c.ruleId===s.id&&!c.resolved)){const c={id:this.generateId(),ruleId:s.id,ruleName:s.name,metric:s.metric,value:n,threshold:s.threshold,severity:s.severity,message:`${s.name}: ${s.metric} is ${n} (threshold: ${s.threshold})`,timestamp:Date.now(),acknowledged:!1,resolved:!1};this.alerts.push(c),this.notifyListeners({type:"alert_triggered",alert:c})}}}startMetricsCollection(){this.metricsInterval=setInterval(()=>{const t=this.calculateMetrics();this.metrics.push(t),this.metrics.length>this.config.maxMetrics&&(this.metrics=this.metrics.slice(-Math.floor(this.config.maxMetrics*.8))),this.checkAlerts(t),this.notifyListeners({type:"metrics",metrics:t})},this.config.reportInterval)}startCleanup(){this.cleanupInterval=setInterval(()=>{const t=Date.now(),s=t-this.config.retentionPeriod;this.events=this.events.filter(i=>i.timestamp>=s),this.metrics=this.metrics.filter(i=>i.timestamp>=s);const n=t-24*60*60*1e3;this.alerts=this.alerts.filter(i=>!i.resolved||i.timestamp>=n)},60*60*1e3)}notifyListeners(t){this.listeners.forEach(s=>{try{s(t)}catch(n){console.error("Listener error:",n)}})}generateId(){return`${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}const z=()=>{const[l]=u.useState(()=>new O({enabled:!0,sampleRate:1,maxEvents:500,maxMetrics:50,alertEnabled:!0,reportInterval:2e3})),[t,s]=u.useState(l.getCurrentMetrics()),[n,i]=u.useState([]),[m,c]=u.useState([]),[v,w]=u.useState([]),[p,R]=u.useState(!1),[f,a]=u.useState({requestInterval:1e3,errorRate:10,timeoutRate:5}),d=u.useRef(),x=u.useCallback(()=>{s(l.getCurrentMetrics()),i(l.getEvents(20)),c(l.getAlerts()),w(l.getAlertRules())},[l]);u.useEffect(()=>{const r=h=>{(h.type==="metrics"||h.type==="event"||h.type==="alert_triggered")&&x()};return l.addListener(r),x(),()=>{l.removeListener(r)}},[l,x]);const E=u.useCallback(async()=>{const r=["/api/users","/api/posts","/api/comments","/api/products","/api/orders"],h=["GET","POST","PUT","DELETE"],b=r[Math.floor(Math.random()*r.length)],N=h[Math.floor(Math.random()*h.length)],q=l.recordRequestStart(b,N,{userAgent:"Demo Client",userId:Math.floor(Math.random()*1e3)}),M=Math.random()*2e3+100;await new Promise(j=>setTimeout(j,M));const T=Math.random()*100;if(T<f.timeoutRate)l.recordRequestTimeout(q,b,N,M,{timeout:5e3});else if(T<f.errorRate){const j=["Network Error","Server Error","Validation Error","Auth Error"],C=j[Math.floor(Math.random()*j.length)];l.recordRequestError(q,b,N,C,M,{statusCode:500})}else{const j=[200,201,204],C=j[Math.floor(Math.random()*j.length)];l.recordRequestSuccess(q,b,N,C,M,{responseSize:Math.floor(Math.random()*1e4)}),Math.random()<.3&&l.recordCacheHit(b,N,"memory",{cacheKey:`${N}:${b}`})}},[l,f]),g=u.useCallback(()=>{p?(d.current&&clearInterval(d.current),R(!1)):(d.current=setInterval(()=>{E()},f.requestInterval),R(!0))},[p,E,f.requestInterval]),I=u.useCallback(()=>{const r=[{name:"é”™è¯¯ç‡è¿‡é«˜",metric:"errorRate",operator:">",threshold:20,duration:3e4,enabled:!0,severity:"high",description:"å½“é”™è¯¯ç‡è¶…è¿‡20%æ—¶è§¦å‘å‘Šè­¦"},{name:"å“åº”æ—¶é—´è¿‡é•¿",metric:"avgResponseTime",operator:">",threshold:1e3,duration:6e4,enabled:!0,severity:"medium",description:"å½“å¹³å‡å“åº”æ—¶é—´è¶…è¿‡1ç§’æ—¶è§¦å‘å‘Šè­¦"},{name:"CPUä½¿ç”¨ç‡è¿‡é«˜",metric:"cpuUsage",operator:">",threshold:80,duration:12e4,enabled:!0,severity:"critical",description:"å½“CPUä½¿ç”¨ç‡è¶…è¿‡80%æ—¶è§¦å‘å‘Šè­¦"}],h=r[Math.floor(Math.random()*r.length)];l.addAlertRule(h),x()},[l,x]),A=u.useCallback(r=>{l.acknowledgeAlert(r),x()},[l,x]),S=u.useCallback(r=>{l.resolveAlert(r),x()},[l,x]),$=u.useCallback(()=>{l.clear(),x()},[l,x]);u.useEffect(()=>()=>{d.current&&clearInterval(d.current),l.destroy()},[l]);const k=r=>{switch(r){case"critical":return"text-red-800 bg-red-100";case"high":return"text-red-700 bg-red-50";case"medium":return"text-yellow-700 bg-yellow-50";case"low":return"text-blue-700 bg-blue-50";default:return"text-gray-700 bg-gray-50"}},D=r=>{switch(r){case"request":return"text-blue-600 bg-blue-100";case"response":return"text-green-600 bg-green-100";case"error":return"text-red-600 bg-red-100";case"timeout":return"text-orange-600 bg-orange-100";case"retry":return"text-yellow-600 bg-yellow-100";case"cache":return"text-purple-600 bg-purple-100";default:return"text-gray-600 bg-gray-100"}};return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"è¯·æ±‚ç›‘æ§æ¼”ç¤º"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"æ¨¡æ‹Ÿé…ç½®"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"è¯·æ±‚é—´éš” (ms)"}),e.jsx("input",{type:"number",value:f.requestInterval,onChange:r=>a(h=>({...h,requestInterval:parseInt(r.target.value)||1e3})),min:"100",max:"5000",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"é”™è¯¯ç‡ (%)"}),e.jsx("input",{type:"number",value:f.errorRate,onChange:r=>a(h=>({...h,errorRate:parseInt(r.target.value)||0})),min:"0",max:"100",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"è¶…æ—¶ç‡ (%)"}),e.jsx("input",{type:"number",value:f.timeoutRate,onChange:r=>a(h=>({...h,timeoutRate:parseInt(r.target.value)||0})),min:"0",max:"100",className:"w-full p-2 border border-gray-300 rounded-md"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"æ“ä½œ"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:g,className:`w-full px-4 py-2 rounded-md text-white ${p?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"}`,children:p?"åœæ­¢æ¨¡æ‹Ÿ":"å¼€å§‹æ¨¡æ‹Ÿ"}),e.jsx("button",{onClick:E,disabled:p,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400",children:"å•æ¬¡è¯·æ±‚"}),e.jsx("button",{onClick:I,className:"w-full px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700",children:"æ·»åŠ å‘Šè­¦è§„åˆ™"}),e.jsx("button",{onClick:$,className:"w-full px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"æ¸…ç©ºæ•°æ®"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"å®æ—¶æŒ‡æ ‡"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-md space-y-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"æ€»è¯·æ±‚:"}),e.jsx("span",{className:"font-medium",children:t.totalRequests})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"æˆåŠŸ:"}),e.jsx("span",{className:"font-medium text-green-600",children:t.successRequests})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"å¤±è´¥:"}),e.jsx("span",{className:"font-medium text-red-600",children:t.failedRequests})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"å¾…å¤„ç†:"}),e.jsx("span",{className:"font-medium text-yellow-600",children:t.pendingRequests})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"é”™è¯¯ç‡:"}),e.jsxs("span",{className:"font-medium text-red-600",children:[t.errorRate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"å¹³å‡å“åº”:"}),e.jsxs("span",{className:"font-medium",children:[t.avgResponseTime,"ms"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"P95å“åº”:"}),e.jsxs("span",{className:"font-medium",children:[t.p95ResponseTime,"ms"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"QPS:"}),e.jsx("span",{className:"font-medium",children:t.requestsPerSecond})]})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2",children:["å‘Šè­¦è§„åˆ™ (",v.length,")"]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-md max-h-40 overflow-y-auto",children:v.length===0?e.jsx("div",{className:"text-sm text-gray-500 text-center py-2",children:"æš‚æ— å‘Šè­¦è§„åˆ™"}):e.jsx("div",{className:"space-y-2",children:v.map(r=>e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:r.name}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${k(r.severity)}`,children:r.severity})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[r.metric," ",r.operator," ",r.threshold]})]},r.id))})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2",children:["æ´»è·ƒå‘Šè­¦ (",m.filter(r=>!r.resolved).length,")"]}),e.jsx("div",{className:"bg-red-50 p-4 rounded-md max-h-40 overflow-y-auto",children:m.filter(r=>!r.resolved).length===0?e.jsx("div",{className:"text-sm text-gray-500 text-center py-2",children:"æš‚æ— æ´»è·ƒå‘Šè­¦"}):e.jsx("div",{className:"space-y-2",children:m.filter(r=>!r.resolved).map(r=>e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:r.ruleName}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${k(r.severity)}`,children:r.severity})]}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:r.message}),e.jsxs("div",{className:"flex space-x-2",children:[!r.acknowledged&&e.jsx("button",{onClick:()=>A(r.id),className:"px-2 py-1 text-xs bg-yellow-600 text-white rounded hover:bg-yellow-700",children:"ç¡®è®¤"}),e.jsx("button",{onClick:()=>S(r.id),className:"px-2 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700",children:"è§£å†³"})]})]},r.id))})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"èµ„æºä½¿ç”¨"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"å†…å­˜ä½¿ç”¨:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${Math.min(100,t.memoryUsage)}%`}})}),e.jsxs("span",{className:"text-sm font-medium",children:[t.memoryUsage,"%"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"CPUä½¿ç”¨:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${Math.min(100,t.cpuUsage)}%`}})}),e.jsxs("span",{className:"text-sm font-medium",children:[t.cpuUsage,"%"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ç½‘ç»œä½¿ç”¨:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${Math.min(100,t.networkUsage)}%`}})}),e.jsxs("span",{className:"text-sm font-medium",children:[t.networkUsage,"%"]})]})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2",children:["æœ€è¿‘äº‹ä»¶ (",n.length,")"]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-md max-h-80 overflow-y-auto",children:n.length===0?e.jsx("div",{className:"text-sm text-gray-500 text-center py-2",children:"æš‚æ— äº‹ä»¶"}):e.jsx("div",{className:"space-y-1",children:n.slice().reverse().map(r=>e.jsxs("div",{className:"bg-white p-2 rounded border text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:`px-2 py-1 rounded ${D(r.type)}`,children:r.type}),e.jsx("span",{className:"text-gray-500",children:new Date(r.timestamp).toLocaleTimeString()})]}),e.jsxs("div",{className:"text-gray-700",children:[r.method," ",r.url]}),r.status&&e.jsxs("div",{className:"text-gray-500",children:["çŠ¶æ€: ",r.status]}),r.duration&&e.jsxs("div",{className:"text-gray-500",children:["è€—æ—¶: ",r.duration,"ms"]}),r.error&&e.jsxs("div",{className:"text-red-600",children:["é”™è¯¯: ",r.error]})]},r.id))})})]})})]})]})})},Q=()=>{const l={title:"è¯·æ±‚ç›‘æ§å™¨å®ç°",language:"typescript",code:`// è¯·æ±‚ç›‘æ§å™¨
class RequestMonitor {
  private config: MonitoringConfig;
  private events: MonitoringEvent[] = [];
  private metrics: MonitoringMetrics[] = [];
  private alertRules: Map<string, AlertRule> = new Map();
  private alerts: Alert[] = [];

  constructor(config: Partial<MonitoringConfig> = {}) {
    this.config = {
      enabled: true,
      sampleRate: 1.0,
      maxEvents: 1000,
      maxMetrics: 100,
      alertEnabled: true,
      reportInterval: 5000,
      retentionPeriod: 24 * 60 * 60 * 1000,
      ...config
    };

    if (this.config.enabled) {
      this.startMetricsCollection();
      this.startCleanup();
    }
  }

  // è®°å½•è¯·æ±‚å¼€å§‹
  recordRequestStart(url: string, method: string, metadata?: Record<string, any>): string {
    if (!this.config.enabled || Math.random() > this.config.sampleRate) {
      return '';
    }

    const event: MonitoringEvent = {
      id: this.generateId(),
      type: 'request',
      url, method,
      timestamp: Date.now(),
      metadata
    };

    this.addEvent(event);
    this.updateRequestCounts(url, method);

    return event.id;
  }

  // è®°å½•è¯·æ±‚æˆåŠŸ
  recordRequestSuccess(
    requestId: string,
    url: string,
    method: string,
    status: number,
    duration: number,
    metadata?: Record<string, any>
  ): void {
    const event: MonitoringEvent = {
      id: this.generateId(),
      type: 'response',
      url, method, status, duration,
      timestamp: Date.now(),
      metadata
    };

    this.addEvent(event);
    this.responseTimes.push(duration);
  }

  // è®¡ç®—æŒ‡æ ‡
  private calculateMetrics(events?: MonitoringEvent[]): MonitoringMetrics {
    const eventList = events || this.events;
    const now = Date.now();
    const oneMinuteAgo = now - 60 * 1000;

    // è¿‡æ»¤æœ€è¿‘çš„äº‹ä»¶
    const recentEvents = eventList.filter(e => e.timestamp >= oneMinuteAgo);

    // è¯·æ±‚æŒ‡æ ‡
    const requestEvents = recentEvents.filter(e => e.type === 'request');
    const responseEvents = recentEvents.filter(e => e.type === 'response');
    const errorEvents = recentEvents.filter(e => e.type === 'error' || e.type === 'timeout');

    const totalRequests = requestEvents.length;
    const successRequests = responseEvents.length;
    const failedRequests = errorEvents.length;

    // æ€§èƒ½æŒ‡æ ‡
    const responseTimes = responseEvents
      .map(e => e.duration!)
      .filter(d => d !== undefined)
      .sort((a, b) => a - b);

    const avgResponseTime = responseTimes.length > 0
      ? Math.round(responseTimes.reduce((sum, time) => sum + time, 0) / responseTimes.length)
      : 0;

    // é”™è¯¯æŒ‡æ ‡
    const errorRate = totalRequests > 0 ? (failedRequests / totalRequests) * 100 : 0;

    return {
      totalRequests,
      successRequests,
      failedRequests,
      avgResponseTime,
      errorRate: Math.round(errorRate * 100) / 100,
      // ... å…¶ä»–æŒ‡æ ‡
      timestamp: now
    };
  }

  // æ£€æŸ¥å‘Šè­¦
  private checkAlerts(metrics: MonitoringMetrics): void {
    if (!this.config.alertEnabled) return;

    for (const rule of this.alertRules.values()) {
      if (!rule.enabled) continue;

      const value = metrics[rule.metric] as number;
      let triggered = false;

      switch (rule.operator) {
        case '>':
          triggered = value > rule.threshold;
          break;
        case '<':
          triggered = value < rule.threshold;
          break;
        // ... å…¶ä»–æ“ä½œç¬¦
      }

      if (triggered) {
        const alert: Alert = {
          id: this.generateId(),
          ruleId: rule.id,
          ruleName: rule.name,
          metric: rule.metric,
          value, threshold: rule.threshold,
          severity: rule.severity,
          message: \`\${rule.name}: \${rule.metric} is \${value} (threshold: \${rule.threshold})\`,
          timestamp: Date.now(),
          acknowledged: false,
          resolved: false
        };

        this.alerts.push(alert);
        this.notifyListeners({ type: 'alert_triggered', alert });
      }
    }
  }
}`,highlights:[25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100]};return e.jsx(H,{title:"è¯·æ±‚ç›‘æ§",description:"å®ç°å…¨é¢çš„è¯·æ±‚ç›‘æ§ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ€§èƒ½æŒ‡æ ‡æ”¶é›†ã€å‘Šè­¦ç®¡ç†å’Œå®æ—¶ç›‘æ§ã€‚",overview:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"ğŸ” æ ¸å¿ƒæ¦‚å¿µ"}),e.jsxs("ul",{className:"space-y-2 text-blue-800",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"æŒ‡æ ‡æ”¶é›†:"})," è‡ªåŠ¨æ”¶é›†è¯·æ±‚çš„å„ç§æ€§èƒ½å’ŒçŠ¶æ€æŒ‡æ ‡"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"å®æ—¶ç›‘æ§:"})," æŒç»­ç›‘æ§ç³»ç»ŸçŠ¶æ€å’Œæ€§èƒ½è¡¨ç°"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"å‘Šè­¦ç®¡ç†:"})," åŸºäºè§„åˆ™çš„è‡ªåŠ¨å‘Šè­¦å’Œé€šçŸ¥æœºåˆ¶"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"æ•°æ®åˆ†æ:"})," æä¾›è¯¦ç»†çš„ç»Ÿè®¡åˆ†æå’Œè¶‹åŠ¿æŠ¥å‘Š"]})]})]}),e.jsxs("div",{className:"bg-green-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-900 mb-3",children:"âœ¨ ä¸»è¦ä¼˜åŠ¿"}),e.jsxs("ul",{className:"space-y-2 text-green-800",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"å…¨é¢ç›‘æ§:"})," è¦†ç›–è¯·æ±‚ç”Ÿå‘½å‘¨æœŸçš„å„ä¸ªé˜¶æ®µ"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"å®æ—¶åé¦ˆ:"})," å³æ—¶å‘ç°å’Œå“åº”ç³»ç»Ÿå¼‚å¸¸"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"æ™ºèƒ½å‘Šè­¦:"})," åŸºäºé˜ˆå€¼å’Œè§„åˆ™çš„æ™ºèƒ½å‘Šè­¦"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"æ€§èƒ½ä¼˜åŒ–:"})," æä¾›æ€§èƒ½ç“¶é¢ˆåˆ†æå’Œä¼˜åŒ–å»ºè®®"]})]})]}),e.jsxs("div",{className:"bg-yellow-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-900 mb-3",children:"ğŸ¯ é€‚ç”¨åœºæ™¯"}),e.jsxs("ul",{className:"space-y-2 text-yellow-800",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"ç”Ÿäº§ç¯å¢ƒ:"})," ç›‘æ§ç”Ÿäº§ç³»ç»Ÿçš„å¥åº·çŠ¶æ€"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"æ€§èƒ½è°ƒä¼˜:"})," è¯†åˆ«å’Œè§£å†³æ€§èƒ½ç“¶é¢ˆ"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"æ•…éšœæ’æŸ¥:"})," å¿«é€Ÿå®šä½å’Œè¯Šæ–­é—®é¢˜"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"å®¹é‡è§„åˆ’:"})," åŸºäºå†å²æ•°æ®è¿›è¡Œå®¹é‡è§„åˆ’"]})]})]}),e.jsxs("div",{className:"bg-red-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-3",children:"âš ï¸ æ³¨æ„äº‹é¡¹"}),e.jsxs("ul",{className:"space-y-2 text-red-800",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"é‡‡æ ·ç‡:"})," åˆç†è®¾ç½®é‡‡æ ·ç‡é¿å…æ€§èƒ½å½±å“"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"æ•°æ®å­˜å‚¨:"})," æ§åˆ¶ç›‘æ§æ•°æ®çš„å­˜å‚¨é‡å’Œä¿ç•™æœŸ"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"å‘Šè­¦ç–²åŠ³:"})," é¿å…è¿‡å¤šæ— æ•ˆå‘Šè­¦å½±å“å“åº”æ•ˆç‡"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"éšç§ä¿æŠ¤:"})," ç¡®ä¿æ•æ„Ÿæ•°æ®ä¸è¢«è®°å½•å’Œæ³„éœ²"]})]})]})]}),examples:[{title:"è¯·æ±‚ç›‘æ§æ¼”ç¤º",component:e.jsx(z,{}),description:"æ¼”ç¤ºå®Œæ•´çš„è¯·æ±‚ç›‘æ§ç³»ç»Ÿï¼ŒåŒ…æ‹¬æŒ‡æ ‡æ”¶é›†ã€å®æ—¶ç›‘æ§ã€å‘Šè­¦ç®¡ç†å’Œæ•°æ®åˆ†æã€‚",observationPoints:["å®æ—¶æ˜¾ç¤ºå„ç§æ€§èƒ½å’ŒçŠ¶æ€æŒ‡æ ‡","è‡ªåŠ¨è®°å½•å’Œåˆ†ç±»ä¸åŒç±»å‹çš„äº‹ä»¶","åŸºäºè§„åˆ™è§¦å‘å‘Šè­¦é€šçŸ¥","æä¾›è¯¦ç»†çš„äº‹ä»¶å†å²è®°å½•","æ˜¾ç¤ºç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ"],keyPoints:["ç›‘æ§å™¨è‡ªåŠ¨æ”¶é›†å’Œåˆ†æè¯·æ±‚æ•°æ®","æ”¯æŒå¤šç§ç±»å‹çš„ç›‘æ§æŒ‡æ ‡","å®ç°äº†å®Œæ•´çš„å‘Šè­¦è§„åˆ™å’Œé€šçŸ¥æœºåˆ¶","æä¾›å®æ—¶çš„æ€§èƒ½å’ŒçŠ¶æ€ç›‘æ§","æ”¯æŒå†å²æ•°æ®çš„æŸ¥è¯¢å’Œåˆ†æ"],commonTraps:["ç›‘æ§æ•°æ®è¿‡å¤šå½±å“ç³»ç»Ÿæ€§èƒ½","å‘Šè­¦è§„åˆ™è®¾ç½®ä¸å½“å¯¼è‡´è¯¯æŠ¥","ç¼ºå°‘æ•°æ®æ¸…ç†æœºåˆ¶å¯¼è‡´å†…å­˜æ³„æ¼","å¿½ç•¥ç›‘æ§æ•°æ®çš„éšç§ä¿æŠ¤"],solutions:["ä½¿ç”¨é‡‡æ ·ç‡æ§åˆ¶ç›‘æ§æ•°æ®é‡","åˆç†è®¾ç½®å‘Šè­¦é˜ˆå€¼å’ŒæŒç»­æ—¶é—´","å®ç°è‡ªåŠ¨çš„æ•°æ®æ¸…ç†å’Œå½’æ¡£","è¿‡æ»¤æ•æ„Ÿä¿¡æ¯é¿å…éšç§æ³„éœ²"],codeExample:l}],tutorial:{concepts:["ç›‘æ§æŒ‡æ ‡åŒ…æ‹¬æ€§èƒ½ã€é”™è¯¯ã€ååé‡ç­‰å¤šä¸ªç»´åº¦","äº‹ä»¶è®°å½•æä¾›è¯¦ç»†çš„è¯·æ±‚ç”Ÿå‘½å‘¨æœŸä¿¡æ¯","å‘Šè­¦è§„åˆ™åŸºäºé˜ˆå€¼å’Œæ¡ä»¶è‡ªåŠ¨è§¦å‘","å®æ—¶ç›‘æ§ç¡®ä¿ç³»ç»ŸçŠ¶æ€çš„åŠæ—¶åé¦ˆ","æ•°æ®åˆ†æå¸®åŠ©è¯†åˆ«è¶‹åŠ¿å’Œæ¨¡å¼"],steps:["è®¾è®¡ç›‘æ§æŒ‡æ ‡å’Œäº‹ä»¶çš„æ•°æ®ç»“æ„","å®ç°äº‹ä»¶è®°å½•å’ŒæŒ‡æ ‡è®¡ç®—é€»è¾‘","åˆ›å»ºç›‘æ§å™¨å’Œé…ç½®ç®¡ç†","å®ç°å‘Šè­¦è§„åˆ™å’Œè§¦å‘æœºåˆ¶","æ·»åŠ å®æ—¶æ•°æ®æ”¶é›†å’Œæ›´æ–°","å®ç°æ•°æ®æ¸…ç†å’Œä¿ç•™ç­–ç•¥","æ·»åŠ ç›‘æ§æ•°æ®çš„æŸ¥è¯¢æ¥å£","å®ç°å‘Šè­¦çš„ç¡®è®¤å’Œè§£å†³æµç¨‹","ä¼˜åŒ–æ€§èƒ½å’Œèµ„æºä½¿ç”¨","æµ‹è¯•å„ç§ç›‘æ§åœºæ™¯"],tips:["åˆç†è®¾ç½®é‡‡æ ·ç‡å¹³è¡¡ç›‘æ§ç²¾åº¦å’Œæ€§èƒ½","ä½¿ç”¨å¼‚æ­¥å¤„ç†é¿å…é˜»å¡ä¸»çº¿ç¨‹","å®ç°ç›‘æ§æ•°æ®çš„æ‰¹é‡å¤„ç†å’Œä¸ŠæŠ¥","å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®é‡Šæ”¾å†…å­˜","ç›‘æ§å‘Šè­¦è§„åˆ™çš„æœ‰æ•ˆæ€§å’Œå‡†ç¡®æ€§"]},interview:{questions:[{question:"å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜æ•ˆçš„è¯·æ±‚ç›‘æ§ç³»ç»Ÿï¼Ÿ",answer:"éœ€è¦è€ƒè™‘ï¼š1) ç›‘æ§æŒ‡æ ‡çš„é€‰æ‹©å’Œå®šä¹‰ï¼›2) æ•°æ®æ”¶é›†çš„é‡‡æ ·ç­–ç•¥ï¼›3) å®æ—¶å¤„ç†å’Œå­˜å‚¨æœºåˆ¶ï¼›4) å‘Šè­¦è§„åˆ™å’Œé€šçŸ¥ç³»ç»Ÿï¼›5) æ€§èƒ½å½±å“çš„æœ€å°åŒ–ï¼›6) æ•°æ®çš„æŸ¥è¯¢å’Œåˆ†ææ¥å£ã€‚"},{question:"ç›‘æ§ç³»ç»Ÿå¦‚ä½•å¤„ç†å¤§é‡çš„ç›‘æ§æ•°æ®ï¼Ÿ",answer:"é€šè¿‡ï¼š1) é‡‡æ ·ç‡æ§åˆ¶æ•°æ®é‡ï¼›2) å¼‚æ­¥æ‰¹é‡å¤„ç†ï¼›3) æ•°æ®èšåˆå’Œå‹ç¼©ï¼›4) åˆ†çº§å­˜å‚¨ç­–ç•¥ï¼›5) å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®ï¼›6) ä½¿ç”¨æ—¶é—´çª—å£ç»Ÿè®¡ï¼›7) å®ç°æ•°æ®çš„åˆ†ç‰‡å’Œåˆ†å¸ƒå¼å­˜å‚¨ã€‚"},{question:"å¦‚ä½•é¿å…ç›‘æ§å‘Šè­¦çš„è¯¯æŠ¥å’Œæ¼æŠ¥ï¼Ÿ",answer:"éœ€è¦ï¼š1) åˆç†è®¾ç½®å‘Šè­¦é˜ˆå€¼ï¼›2) ä½¿ç”¨å¤šç»´åº¦æŒ‡æ ‡åˆ¤æ–­ï¼›3) å®ç°å‘Šè­¦çš„å»é‡å’Œèšåˆï¼›4) è®¾ç½®å‘Šè­¦çš„æŒç»­æ—¶é—´è¦æ±‚ï¼›5) å»ºç«‹å‘Šè­¦çš„ç¡®è®¤å’Œåé¦ˆæœºåˆ¶ï¼›6) å®šæœŸè¯„ä¼°å’Œè°ƒæ•´å‘Šè­¦è§„åˆ™ã€‚"},{question:"ç›‘æ§ç³»ç»Ÿçš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ",answer:"åŒ…æ‹¬ï¼š1) å¼‚æ­¥æ•°æ®å¤„ç†ï¼›2) æ‰¹é‡æ“ä½œå‡å°‘å¼€é”€ï¼›3) å†…å­˜æ± å’Œå¯¹è±¡å¤ç”¨ï¼›4) æ•°æ®å‹ç¼©å’Œåºåˆ—åŒ–ä¼˜åŒ–ï¼›5) ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–ï¼›6) ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼›7) åˆ†å¸ƒå¼å¤„ç†å’Œè´Ÿè½½å‡è¡¡ã€‚"}],keyPoints:["ç›‘æ§ç³»ç»Ÿéœ€è¦å¹³è¡¡ç›‘æ§ç²¾åº¦å’Œç³»ç»Ÿæ€§èƒ½","å‘Šè­¦è§„åˆ™åº”è¯¥åŸºäºä¸šåŠ¡éœ€æ±‚å’Œå†å²æ•°æ®","æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢éœ€è¦è€ƒè™‘æ—¶é—´åºåˆ—ç‰¹æ€§","ç›‘æ§æ•°æ®çš„éšç§å’Œå®‰å…¨ä¿æŠ¤å¾ˆé‡è¦","å®æ—¶æ€§å’Œå‡†ç¡®æ€§æ˜¯ç›‘æ§ç³»ç»Ÿçš„æ ¸å¿ƒè¦æ±‚"]},bestPractices:{dos:["è®¾è®¡åˆç†çš„ç›‘æ§æŒ‡æ ‡ä½“ç³»","ä½¿ç”¨é‡‡æ ·å’Œèšåˆå‡å°‘æ•°æ®é‡","å®ç°åˆ†çº§å‘Šè­¦å’Œé€šçŸ¥æœºåˆ¶","æä¾›ç›´è§‚çš„ç›‘æ§ä»ªè¡¨æ¿","å»ºç«‹ç›‘æ§æ•°æ®çš„å¤‡ä»½å’Œæ¢å¤","å®šæœŸè¯„ä¼°ç›‘æ§ç³»ç»Ÿçš„æœ‰æ•ˆæ€§","å®ç°ç›‘æ§æ•°æ®çš„è‡ªåŠ¨æ¸…ç†","ä¿æŠ¤æ•æ„Ÿä¿¡æ¯ä¸è¢«ç›‘æ§è®°å½•"],donts:["ä¸è¦ç›‘æ§æ‰€æœ‰è¯·æ±‚å½±å“æ€§èƒ½","ä¸è¦è®¾ç½®è¿‡äºæ•æ„Ÿçš„å‘Šè­¦é˜ˆå€¼","ä¸è¦å¿½ç•¥ç›‘æ§æ•°æ®çš„å­˜å‚¨æˆæœ¬","ä¸è¦åœ¨ç›‘æ§ä¸­è®°å½•æ•æ„Ÿæ•°æ®","ä¸è¦è®©ç›‘æ§ç³»ç»Ÿæˆä¸ºæ€§èƒ½ç“¶é¢ˆ","ä¸è¦å¿½ç•¥å‘Šè­¦çš„å¤„ç†å’Œè·Ÿè¸ª","ä¸è¦ç¼ºå°‘ç›‘æ§ç³»ç»Ÿçš„ç›‘æ§","ä¸è¦è¿‡åº¦ä¾èµ–å•ä¸€ç›‘æ§æŒ‡æ ‡"],patterns:["è§‚å¯Ÿè€…æ¨¡å¼ï¼šå®ç°äº‹ä»¶çš„å‘å¸ƒå’Œè®¢é˜…","ç­–ç•¥æ¨¡å¼ï¼šæ”¯æŒä¸åŒçš„å‘Šè­¦ç­–ç•¥","å·¥å‚æ¨¡å¼ï¼šåˆ›å»ºä¸åŒç±»å‹çš„ç›‘æ§å™¨","è£…é¥°å™¨æ¨¡å¼ï¼šä¸ºè¯·æ±‚æ·»åŠ ç›‘æ§åŠŸèƒ½","è´£ä»»é“¾æ¨¡å¼ï¼šå¤„ç†å‘Šè­¦çš„ä¼ é€’å’Œå¤„ç†","çŠ¶æ€æ¨¡å¼ï¼šç®¡ç†ç›‘æ§ç³»ç»Ÿçš„ä¸åŒçŠ¶æ€","æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼šå®šä¹‰ç›‘æ§æµç¨‹çš„æ¡†æ¶","å•ä¾‹æ¨¡å¼ï¼šç¡®ä¿ç›‘æ§å™¨çš„å”¯ä¸€å®ä¾‹"]}})};export{Q as default};
