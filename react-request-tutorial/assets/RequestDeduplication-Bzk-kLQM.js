var S=Object.defineProperty;var K=(i,r,t)=>r in i?S(i,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[r]=t;var R=(i,r,t)=>K(i,typeof r!="symbol"?r+"":r,t);import{R as v,r as h,j as e}from"./index-C7SuDyTR.js";import{a as T}from"./index-NIGUFBhG.js";import{C as k}from"./ComponentTemplate-BzrYXZsv.js";class D{constructor(){R(this,"pendingRequests",new Map);R(this,"requestHistory",new Map);R(this,"cacheTimeout",5e3)}generateRequestKey(r,t,u,l){return`${r}:${t}:${JSON.stringify(u||{})}:${JSON.stringify(l||{})}`}isDuplicateRequest(r){return this.pendingRequests.has(r)}getCachedResult(r){const t=this.requestHistory.get(r);return t&&Date.now()-t.timestamp<this.cacheTimeout?t.result:(t&&this.requestHistory.delete(r),null)}async deduplicatedRequest(r,t,u={}){const l=this.generateRequestKey(r,t,u.params,u.data);if(u.useCache!==!1){const n=this.getCachedResult(l);if(n!==null)return n}if(this.pendingRequests.has(l))return this.pendingRequests.get(l);const m=this.executeRequest(r,t,u);this.pendingRequests.set(l,m);try{const n=await m;return this.requestHistory.set(l,{timestamp:Date.now(),result:n}),n}finally{this.pendingRequests.delete(l)}}async executeRequest(r,t,u){return(await T({method:r,url:t,params:u.params,data:u.data})).data}getStats(){return{pendingCount:this.pendingRequests.size,cachedCount:this.requestHistory.size,pendingKeys:Array.from(this.pendingRequests.keys()),cachedKeys:Array.from(this.requestHistory.keys())}}clearCache(){this.requestHistory.clear()}clear(){this.pendingRequests.clear(),this.requestHistory.clear()}}const x=new D,L=(i=300)=>{const r=v.useRef(null),t=v.useRef({triggered:0,executed:0}),[u,l]=v.useState({triggered:0,executed:0}),m=v.useCallback(async(d,g,p={})=>(t.current.triggered++,l({...t.current}),new Promise((N,f)=>{r.current&&clearTimeout(r.current),r.current=setTimeout(async()=>{try{t.current.executed++,l({...t.current});const b=await x.deduplicatedRequest(d,g,p);N(b)}catch(b){f(b)}},i)})),[i]),n=v.useCallback(()=>{t.current={triggered:0,executed:0},l({triggered:0,executed:0})},[]);return v.useEffect(()=>()=>{r.current&&clearTimeout(r.current)},[]),{debouncedRequest:m,stats:u,clearStats:n}},$=()=>{const[i,r]=h.useState([]),[t,u]=h.useState({pendingCount:0,cachedCount:0}),[l,m]=h.useState(!0),n=()=>{const c=x.getStats();u({pendingCount:c.pendingCount,cachedCount:c.cachedCount})},d=c=>{const s={...c,id:Date.now().toString(),timestamp:Date.now()};r(o=>[s,...o].slice(0,10))},g=async(c,s)=>{const o=x.generateRequestKey("GET",c,s);if(x.isDuplicateRequest(o)){d({type:"duplicate",requestKey:o}),n();return}if(l){const a=x.getCachedResult(o);if(a!==null)return d({type:"cached",requestKey:o,result:a}),n(),a}try{d({type:"new",requestKey:o}),n();const a=await x.deduplicatedRequest("GET",c,{params:s,useCache:l});return n(),a}catch(a){console.error("Request failed:",a),n()}},p=()=>{r([])},N=()=>{x.clearCache(),n()},f=c=>{switch(c){case"new":return"🆕";case"duplicate":return"🔄";case"cached":return"💾";default:return"❓"}},b=c=>{switch(c){case"new":return"text-blue-600";case"duplicate":return"text-orange-600";case"cached":return"text-green-600";default:return"text-gray-600"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center mb-4",children:[e.jsx("button",{onClick:()=>g("/api/users"),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"请求用户列表"}),e.jsx("button",{onClick:()=>g("/api/users",{page:1}),className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors",children:"请求用户列表 (page=1)"}),e.jsx("button",{onClick:()=>g("/api/users",{page:2}),className:"px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors",children:"请求用户列表 (page=2)"}),e.jsx("button",{onClick:()=>g("/api/posts"),className:"px-4 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600 transition-colors",children:"请求文章列表"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:c=>m(c.target.checked),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"启用缓存"})]}),e.jsx("button",{onClick:p,className:"px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 transition-colors",children:"清除日志"}),e.jsx("button",{onClick:N,className:"px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600 transition-colors",children:"清除缓存"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"正在进行的请求"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.pendingCount})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"已缓存的请求"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.cachedCount})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"请求日志"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"显示最近 10 次请求的处理情况"})]}),e.jsx("div",{className:"p-4",children:i.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"暂无请求日志"}):e.jsx("div",{className:"space-y-2",children:i.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded border",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-lg",children:f(c.type)}),e.jsxs("div",{children:[e.jsxs("div",{className:`font-medium ${b(c.type)}`,children:[c.type==="new"&&"新请求",c.type==="duplicate"&&"重复请求",c.type==="cached"&&"缓存命中"]}),e.jsx("div",{className:"text-sm text-gray-600 font-mono",children:c.requestKey})]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(c.timestamp).toLocaleTimeString()})]},c.id))})})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[e.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"💡 功能说明"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"• 快速点击相同按钮，观察重复请求被标记为 duplicate"}),e.jsx("li",{children:"• 缓存的结果会立即返回，无需等待网络请求"}),e.jsx("li",{children:"• 不同的请求参数会生成不同的 requestKey"}),e.jsx("li",{children:"• 可以通过开关控制是否启用缓存功能"})]})]})]})},P=()=>{const[i,r]=h.useState(""),[t,u]=h.useState([]),[l,m]=h.useState(!1),[n,d]=h.useState(null),{debouncedRequest:g,stats:p,clearStats:N}=L(500),f=async a=>(await new Promise(j=>setTimeout(j,800)),a.trim()?[{id:1,title:"React 教程",description:"学习 React 基础知识"},{id:2,title:"React Hooks",description:"深入理解 React Hooks"},{id:3,title:"React 性能优化",description:"提升 React 应用性能"},{id:4,title:"React Router",description:"React 路由管理"},{id:5,title:"React 状态管理",description:"Redux 和 Context API"}].filter(j=>j.title.toLowerCase().includes(a.toLowerCase())||j.description.toLowerCase().includes(a.toLowerCase())):[]),b=async a=>{if(!a.trim()){u([]),m(!1);return}m(!0),d(null);try{await g("GET","/api/search",{params:{q:a},useCache:!0});const y=await f(a);u(y)}catch{d("搜索失败，请重试"),u([])}finally{m(!1)}};h.useEffect(()=>{b(i)},[i]);const c=a=>{r(a.target.value)},s=()=>{r(""),u([]),d(null)},o=p.triggered>0?((p.triggered-p.executed)/p.triggered*100).toFixed(1):"0";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:i,onChange:c,placeholder:"输入搜索关键词...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),i&&e.jsx("button",{onClick:s,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:"✕"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[l&&e.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm",children:"搜索中..."})]}),n&&e.jsxs("div",{className:"text-red-600 text-sm",children:["❌ ",n]})]}),e.jsx("button",{onClick:N,className:"px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 transition-colors",children:"重置统计"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"触发次数"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:p.triggered}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"用户输入触发的总次数"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"实际执行"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:p.executed}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"实际发送的请求次数"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h4",{className:"font-semibold text-purple-800 mb-2",children:"去重效率"}),e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[o,"%"]}),e.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"减少的请求百分比"})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"搜索结果"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:i?`搜索 "${i}" 的结果`:"请输入搜索关键词"})]}),e.jsx("div",{className:"p-4",children:i?t.length===0&&!l?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"没有找到相关结果"}):e.jsx("div",{className:"space-y-3",children:t.map(a=>e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("h5",{className:"font-semibold text-gray-800 mb-1",children:a.title}),e.jsx("p",{className:"text-gray-600 text-sm",children:a.description})]},a.id))}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"请输入搜索关键词开始搜索"})})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[e.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"💡 功能说明"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"• 快速输入搜索关键词，观察实际请求次数远少于触发次数"}),e.jsx("li",{children:"• 500ms 内的重复输入会被防抖处理"}),e.jsx("li",{children:"• 去重效率统计显示优化效果"}),e.jsx("li",{children:"• 相同搜索词的结果会被缓存，提升响应速度"})]})]})]})},E=()=>{const[i,r]=h.useState([]),[t,u]=h.useState({pendingCount:0,cachedCount:0,pendingKeys:[],cachedKeys:[]}),[l,m]=h.useState(!1),n=()=>{const s=x.getStats();u(s)},d=s=>{const o={...s,id:Date.now().toString()+Math.random().toString(36).substr(2,9),timestamp:Date.now()};r(a=>[o,...a].slice(0,20))},g=async()=>{m(!0),d({type:"request",message:"开始模拟 5 个相同的请求"});const s="/api/data",o={timestamp:Date.now()},a=x.generateRequestKey("GET",s,o),y=Array.from({length:5},async(j,C)=>{const w=`Request-${C+1}`;x.isDuplicateRequest(a)?d({type:"duplicate",message:`${w}: 检测到重复请求`,requestKey:a}):d({type:"request",message:`${w}: 发起新请求`,requestKey:a}),n();try{const q=await x.deduplicatedRequest("GET",s,{params:o});return d({type:"completed",message:`${w}: 请求完成`,requestKey:a}),q}catch(q){throw d({type:"request",message:`${w}: 请求失败 - ${q}`,requestKey:a}),q}});try{await Promise.all(y),d({type:"completed",message:"所有请求处理完成"})}catch(j){d({type:"request",message:`批量请求失败: ${j}`})}finally{m(!1),n()}},p=async()=>{m(!0),d({type:"request",message:"开始模拟不同的请求"});const s=[{endpoint:"/api/users",params:{page:1}},{endpoint:"/api/posts",params:{category:"tech"}},{endpoint:"/api/comments",params:{postId:123}}];for(const{endpoint:o,params:a}of s){const y=x.generateRequestKey("GET",o,a);d({type:"request",message:`发起请求: ${o}`,requestKey:y}),n();try{await x.deduplicatedRequest("GET",o,{params:a}),d({type:"completed",message:`请求完成: ${o}`,requestKey:y})}catch(j){d({type:"request",message:`请求失败: ${o} - ${j}`,requestKey:y})}n()}m(!1),d({type:"completed",message:"不同请求模拟完成"})},N=()=>{x.clear(),r([]),n(),d({type:"request",message:"已清除所有数据和缓存"})},f=()=>{x.clearCache(),n(),d({type:"request",message:"已清除缓存数据"})};h.useEffect(()=>{n();const s=setInterval(n,1e3);return()=>clearInterval(s)},[]);const b=s=>{switch(s){case"request":return"🚀";case"duplicate":return"🔄";case"cached":return"💾";case"completed":return"✅";default:return"ℹ️"}},c=s=>{switch(s){case"request":return"text-blue-600";case"duplicate":return"text-orange-600";case"cached":return"text-green-600";case"completed":return"text-green-700";default:return"text-gray-600"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center mb-4",children:[e.jsx("button",{onClick:g,disabled:l,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-400 transition-colors",children:l?"模拟中...":"模拟重复请求"}),e.jsx("button",{onClick:p,disabled:l,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-400 transition-colors",children:"模拟不同请求"}),e.jsx("button",{onClick:f,className:"px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition-colors",children:"清除缓存"}),e.jsx("button",{onClick:N,className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors",children:"清除所有数据"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-3",children:"活跃请求"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-2",children:t.pendingCount}),t.pendingKeys.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"活跃请求键:"}),t.pendingKeys.map((s,o)=>e.jsx("div",{className:"text-xs text-blue-600 font-mono bg-blue-100 p-1 rounded truncate",title:s,children:s},o))]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-3",children:"缓存请求"}),e.jsx("div",{className:"text-2xl font-bold text-green-600 mb-2",children:t.cachedCount}),t.cachedKeys.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-green-700 font-medium",children:"缓存请求键:"}),e.jsx("div",{className:"max-h-20 overflow-y-auto space-y-1",children:t.cachedKeys.map((s,o)=>e.jsx("div",{className:"text-xs text-green-600 font-mono bg-green-100 p-1 rounded truncate",title:s,children:s},o))})]})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"操作日志"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"显示最近 20 条去重相关的操作记录"})]}),e.jsx("div",{className:"p-4",children:i.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"暂无操作日志"}):e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:i.map(s=>e.jsxs("div",{className:"flex items-start justify-between p-3 bg-gray-50 rounded border",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx("span",{className:"text-lg mt-0.5",children:b(s.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`font-medium ${c(s.type)}`,children:s.message}),s.requestKey&&e.jsx("div",{className:"text-xs text-gray-500 font-mono mt-1 break-all",children:s.requestKey})]})]}),e.jsx("div",{className:"text-xs text-gray-500 ml-4 whitespace-nowrap",children:new Date(s.timestamp).toLocaleTimeString()})]},s.id))})})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[e.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"💡 功能说明"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:'• 点击"模拟重复请求"观察 5 个相同请求只执行一次'}),e.jsx("li",{children:"• 全局统计显示所有组件的请求状态"}),e.jsx("li",{children:"• 活跃请求键实时显示正在进行的请求"}),e.jsx("li",{children:"• 操作日志记录所有去重相关的操作"})]})]})]})},M=()=>{const i=[{title:"核心概念",items:["requestKey = method + url + params + data","请求去重和结果缓存机制","防抖去重和全局去重管理","请求状态跟踪和生命周期管理"]},{title:"主要优势",items:["减少不必要的网络请求","避免重复数据处理和渲染","提升应用响应速度","降低服务器负载压力"]},{title:"适用场景",items:["搜索框实时查询去重","按钮防重复点击","数据列表刷新去重","表单提交防重复"]},{title:"注意事项",items:["合理设置缓存过期时间","区分需要去重的请求类型","注意内存使用和清理","考虑并发安全和竞态条件"]}];return e.jsx(k,{title:"请求去重",description:"学习如何实现请求去重机制，通过 requestKey 识别重复请求，避免不必要的网络开销，提升应用性能和用户体验。",overview:i,examples:[{title:"基础请求去重",component:e.jsx($,{}),description:"演示基于 requestKey 的请求去重机制，包括重复检测、结果缓存和统计信息。",observationPoints:["快速点击相同按钮，观察重复请求被标记为 duplicate","缓存的结果会立即返回，无需等待网络请求","统计信息实时显示正在进行和已缓存的请求数量","不同的请求参数会生成不同的 requestKey"],keyPoints:["requestKey 由 method、url、params、data 组成","相同 requestKey 的请求会被去重处理","缓存机制避免重复的网络请求","支持可选的缓存开关控制"],commonTraps:["requestKey 生成不准确导致误判","缓存时间过长导致数据过期","没有清理机制导致内存泄漏","忽略请求参数的顺序影响"],solutions:["标准化参数序列化方式","设置合理的缓存过期时间","实现定期清理和手动清理","对参数进行排序后序列化"],importantTips:["去重只针对相同的请求，不同参数不会去重","缓存结果可以显著提升用户体验","注意区分需要去重和不需要去重的场景"]},{title:"防抖去重搜索",component:e.jsx(P,{}),description:"结合防抖技术的搜索去重，避免用户快速输入时的频繁请求。",observationPoints:["快速输入搜索关键词，观察实际请求次数远少于触发次数","500ms 内的重复输入会被防抖处理","去重效率统计显示优化效果","搜索结果实时更新，用户体验良好"],keyPoints:["防抖延迟避免频繁触发请求","requestKey 确保相同搜索词不重复请求","统计信息展示去重优化效果","异步清理避免内存泄漏"],commonTraps:["防抖延迟设置过长影响用户体验","没有清理定时器导致内存泄漏","搜索关键词变化时没有取消之前的请求","防抖和去重逻辑冲突"],solutions:["根据用户习惯设置合理的防抖延迟","在组件卸载时清理所有定时器","使用 AbortController 取消过期请求","先防抖再去重的处理顺序"],importantTips:["防抖减少触发频率，去重避免重复请求","统计数据有助于评估优化效果","注意处理组件卸载时的清理工作"]},{title:"全局去重管理",component:e.jsx(E,{}),description:"全局去重管理器统一处理应用中所有的请求去重，提供统一的缓存和统计。",observationPoints:["点击模拟重复请求，观察5个相同请求只执行一次","全局统计显示所有组件的请求状态","活跃请求键实时显示正在进行的请求","操作日志记录所有去重相关的操作"],keyPoints:["全局管理器统一处理所有请求去重","跨组件共享缓存和去重逻辑","提供统一的统计和监控接口","支持全局清理和状态重置"],commonTraps:["全局状态管理复杂度增加","不同组件间的缓存冲突","内存使用量持续增长","缓存键命名冲突"],solutions:["设计清晰的状态管理架构","使用命名空间避免冲突","实现自动和手动清理机制","建立标准的键命名规范"],importantTips:["全局管理适用于大型应用的统一优化","注意平衡功能复杂度和维护成本","监控和日志有助于问题诊断"]}],tutorial:{concepts:["**请求标识 (requestKey)**：由请求方法、URL、参数和数据组成的唯一标识","**去重检测**：通过比较 requestKey 识别重复请求","**结果缓存**：存储请求结果避免重复网络调用","**防抖去重**：结合防抖技术减少高频操作的请求","**全局管理**：统一管理应用中所有的去重逻辑","**生命周期管理**：跟踪请求从发起到完成的整个过程"],steps:["设计 requestKey 生成算法，确保唯一性和一致性","实现去重检测逻辑，识别重复请求","建立结果缓存机制，设置合理的过期时间","集成防抖技术，优化高频操作场景","创建全局管理器，统一处理去重逻辑","添加统计和监控功能，评估优化效果"],tips:["requestKey 生成要考虑参数顺序和数据类型","缓存时间根据数据更新频率合理设置","防抖延迟要平衡用户体验和性能优化","定期清理缓存避免内存泄漏","为不同类型的请求设置不同的去重策略","使用统计数据评估和调整去重效果"]},interview:{questions:[{question:"什么是请求去重？为什么需要请求去重？",answer:"请求去重是指识别和避免发送重复的网络请求的技术。需要的原因：1) **性能优化**：减少不必要的网络开销；2) **用户体验**：避免重复加载和状态混乱；3) **服务器保护**：降低服务器负载；4) **数据一致性**：防止重复操作导致的数据问题。常见场景包括按钮防重复点击、搜索防抖、表单重复提交等。"},{question:"如何生成 requestKey？需要考虑哪些因素？",answer:"requestKey 生成需要考虑：1) **请求方法**：GET、POST 等；2) **URL 路径**：完整的请求地址；3) **查询参数**：URL 参数和请求参数；4) **请求体数据**：POST 请求的 body 内容。实现时要注意：参数排序保证一致性、数据序列化标准化、特殊字符处理、嵌套对象的深度比较。通常格式为：`${method}:${url}:${JSON.stringify(sortedParams)}:${JSON.stringify(sortedData)}`。"},{question:"请求去重和防抖有什么区别？如何结合使用？",answer:"主要区别：1) **触发机制**：去重基于请求内容，防抖基于时间间隔；2) **适用场景**：去重适用于相同请求，防抖适用于高频操作；3) **实现方式**：去重比较 requestKey，防抖使用定时器延迟。结合使用：先防抖减少触发频率，再去重避免重复请求。例如搜索场景：防抖避免每次输入都触发，去重确保相同搜索词不重复请求。"},{question:"如何处理请求去重的缓存管理？",answer:"缓存管理策略：1) **过期时间**：根据数据更新频率设置 TTL；2) **存储限制**：设置最大缓存数量，使用 LRU 淘汰；3) **清理机制**：定期清理过期缓存，手动清理接口；4) **内存监控**：监控缓存使用情况，防止内存泄漏。实现要点：缓存键标准化、异步清理避免阻塞、错误处理和降级策略、跨组件缓存共享机制。"}],keyPoints:["requestKey 的生成算法是去重机制的核心","缓存策略要平衡性能优化和内存使用","防抖去重结合使用效果更佳","全局管理有助于统一优化和监控","不同类型请求需要不同的去重策略","统计和监控是评估优化效果的重要手段"]},bestPractices:{dos:["为 requestKey 设计标准化的生成算法","根据业务场景设置合理的缓存时间","实现自动和手动的缓存清理机制","结合防抖技术优化高频操作","添加统计功能评估去重效果","为不同请求类型制定去重策略","实现错误处理和降级方案","监控内存使用避免泄漏"],donts:["不要对所有请求都进行去重处理","不要设置过长的缓存时间","不要忽略参数顺序对 requestKey 的影响","不要在去重逻辑中忽略错误处理","不要让缓存无限制增长","不要对实时性要求高的请求去重","不要忽略跨组件的缓存冲突","不要在生产环境中忽略性能监控"],patterns:["**单例管理器模式**：全局统一的去重管理器","**策略模式**：不同类型请求的去重策略","**装饰器模式**：为现有请求函数添加去重能力","**观察者模式**：请求状态变化的事件通知","**工厂模式**：统一创建带去重功能的请求","**缓存模式**：LRU 缓存和 TTL 过期机制","**防抖模式**：时间窗口内的请求合并"]}})};export{M as default};
