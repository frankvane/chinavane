var k=Object.defineProperty;var S=(t,s,n)=>s in t?k(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var h=(t,s,n)=>S(t,typeof s!="symbol"?s+"":s,n);import{r,j as e}from"./index-C7SuDyTR.js";import{C as I}from"./ComponentTemplate-BzrYXZsv.js";class R{constructor(s,n){h(this,"capacity");h(this,"tokens");h(this,"refillRate");h(this,"lastRefill");this.capacity=s,this.tokens=s,this.refillRate=n,this.lastRefill=Date.now()}consume(s=1){return this.refill(),this.tokens>=s?(this.tokens-=s,!0):!1}refill(){const s=Date.now(),u=(s-this.lastRefill)/1e3*this.refillRate;this.tokens=Math.min(this.capacity,this.tokens+u),this.lastRefill=s}getTokens(){return this.refill(),Math.floor(this.tokens)}getCapacity(){return this.capacity}reset(){this.tokens=this.capacity,this.lastRefill=Date.now()}}class q{constructor(s,n){h(this,"windowSize");h(this,"maxRequests");h(this,"requests");this.windowSize=s*1e3,this.maxRequests=n,this.requests=[]}isAllowed(){const s=Date.now();return this.requests=this.requests.filter(n=>s-n<this.windowSize),this.requests.length<this.maxRequests?(this.requests.push(s),!0):!1}getCurrentCount(){const s=Date.now();return this.requests=this.requests.filter(n=>s-n<this.windowSize),this.requests.length}getMaxRequests(){return this.maxRequests}reset(){this.requests=[]}}class C{constructor(s,n){h(this,"windowSize");h(this,"maxRequests");h(this,"currentWindow");h(this,"requestCount");this.windowSize=s*1e3,this.maxRequests=n,this.currentWindow=Math.floor(Date.now()/this.windowSize),this.requestCount=0}isAllowed(){const s=Date.now(),n=Math.floor(s/this.windowSize);return n>this.currentWindow&&(this.currentWindow=n,this.requestCount=0),this.requestCount<this.maxRequests?(this.requestCount++,!0):!1}getCurrentCount(){const s=Date.now();return Math.floor(s/this.windowSize)>this.currentWindow?0:this.requestCount}getMaxRequests(){return this.maxRequests}reset(){this.currentWindow=Math.floor(Date.now()/this.windowSize),this.requestCount=0}}const W=()=>{const[t]=r.useState(()=>new C(5,3)),[s,n]=r.useState([]),[u,g]=r.useState(0),[a,v]=r.useState(!1),[m,N]=r.useState(0),[p,d]=r.useState(5);r.useEffect(()=>{const i=setInterval(()=>{g(t.getCurrentCount());const l=Date.now(),x=Math.floor(l/5e3),w=l%5e3,b=Math.ceil((5e3-w)/1e3);N(x),d(b)},100);return()=>clearInterval(i)},[t]),r.useEffect(()=>{if(!a)return;const i=setInterval(()=>{c()},1e3);return()=>clearInterval(i)},[a]);const c=()=>{const i=t.isAllowed(),l={id:Date.now(),timestamp:new Date().toLocaleTimeString(),status:i?"success":"rejected",message:i?"请求成功":"请求被限流",windowId:m};n(x=>[l,...x.slice(0,14)])},j=()=>{t.reset(),g(t.getCurrentCount()),n([])},f=()=>{v(!a)},o=s.reduce((i,l)=>{const x=l.windowId;return i[x]||(i[x]=[]),i[x].push(l),i},{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"固定窗口状态"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"当前请求数"}),e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:u})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"最大请求数"}),e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:t.getMaxRequests()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"窗口剩余时间"}),e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[p,"s"]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"当前窗口请求数"}),e.jsx("div",{className:"flex space-x-1",children:Array.from({length:t.getMaxRequests()},(i,l)=>e.jsx("div",{className:`flex-1 h-8 rounded border-2 flex items-center justify-center text-sm font-medium ${l<u?"bg-purple-500 border-purple-600 text-white":"bg-gray-200 border-gray-300 text-gray-500"}`,children:l+1},l))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"窗口时间进度"}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4",children:e.jsx("div",{className:"h-4 bg-orange-500 rounded-full transition-all duration-100",style:{width:`${(5-p+1)/5*100}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"0s"}),e.jsxs("span",{children:["窗口 #",m]}),e.jsx("span",{children:"5s"})]})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:c,className:"px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors",children:"发送请求"}),e.jsx("button",{onClick:f,className:`px-4 py-2 rounded transition-colors ${a?"bg-red-500 text-white hover:bg-red-600":"bg-blue-500 text-white hover:bg-blue-600"}`,children:a?"停止自动请求":"开始自动请求"}),e.jsx("button",{onClick:j,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"重置窗口"})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"请求日志（按窗口分组）"}),Object.keys(o).length===0?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"暂无请求记录"}):e.jsx("div",{className:"space-y-4 max-h-64 overflow-y-auto",children:Object.entries(o).sort(([i],[l])=>Number(l)-Number(i)).map(([i,l])=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"font-medium text-gray-700 mb-2",children:["窗口 #",i," (",l.length,"/",t.getMaxRequests()," 请求)",Number(i)===m&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded",children:"当前窗口"})]}),e.jsx("div",{className:"space-y-1",children:l.map(x=>e.jsx("div",{className:`p-2 rounded text-sm ${x.status==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:x.message}),e.jsx("span",{className:"text-xs opacity-75",children:x.timestamp})]})},x.id))})]},i))})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"固定窗口算法说明"}),e.jsxs("ul",{className:"text-sm text-gray-700 space-y-1",children:[e.jsx("li",{children:"• 窗口大小：5秒"}),e.jsx("li",{children:"• 最大请求数：3个"}),e.jsx("li",{children:"• 每个窗口独立计数，窗口结束时计数重置"}),e.jsx("li",{children:"• 实现简单，但可能出现突发流量问题"}),e.jsx("li",{children:"• 在窗口边界可能出现2倍于限制的请求量"})]})]})]})},T=()=>{const[t]=r.useState(()=>new R(5,1)),[s]=r.useState(()=>new q(10,5)),[n]=r.useState(()=>new C(10,5)),[u,g]=r.useState([]),[a,v]=r.useState(!1),[m,N]=r.useState(500),[p,d]=r.useState({TokenBucket:{total:0,success:0,rejected:0,successRate:0},SlidingWindow:{total:0,success:0,rejected:0,successRate:0},FixedWindow:{total:0,success:0,rejected:0,successRate:0}});r.useEffect(()=>{if(!a)return;const o=setInterval(()=>{const i=Date.now(),l=[],x=t.consume();l.push({algorithm:"TokenBucket",success:x,timestamp:i});const w=s.isAllowed();l.push({algorithm:"SlidingWindow",success:w,timestamp:i});const b=n.isAllowed();l.push({algorithm:"FixedWindow",success:b,timestamp:i}),g(y=>[...l,...y.slice(0,297)])},m);return()=>clearInterval(o)},[a,m,t,s,n]),r.useEffect(()=>{const o={TokenBucket:{total:0,success:0,rejected:0,successRate:0},SlidingWindow:{total:0,success:0,rejected:0,successRate:0},FixedWindow:{total:0,success:0,rejected:0,successRate:0}};u.forEach(i=>{const l=o[i.algorithm];l.total++,i.success?l.success++:l.rejected++,l.successRate=l.total>0?l.success/l.total*100:0}),d(o)},[u]);const c=()=>{t.reset(),s.reset(),n.reset(),g([])},j=()=>{v(!a)},f=(o,i=10)=>u.filter(l=>l.algorithm===o).slice(0,i);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"测试控制"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:j,className:`px-4 py-2 rounded transition-colors ${a?"bg-red-500 text-white hover:bg-red-600":"bg-green-500 text-white hover:bg-green-600"}`,children:a?"停止测试":"开始测试"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"请求间隔:"}),e.jsxs("select",{value:m,onChange:o=>N(Number(o.target.value)),className:"px-3 py-1 border rounded",disabled:a,children:[e.jsx("option",{value:200,children:"200ms (高频)"}),e.jsx("option",{value:500,children:"500ms (中频)"}),e.jsx("option",{value:1e3,children:"1000ms (低频)"}),e.jsx("option",{value:2e3,children:"2000ms (很低频)"})]})]}),e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"重置所有"})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:Object.entries(p).map(([o,i])=>{const l={TokenBucket:"令牌桶",SlidingWindow:"滑动窗口",FixedWindow:"固定窗口"},w={TokenBucket:"blue",SlidingWindow:"green",FixedWindow:"purple"}[o];return e.jsxs("div",{className:`bg-${w}-50 p-4 rounded-lg border border-${w}-200`,children:[e.jsx("h4",{className:"font-semibold text-lg mb-3",children:l[o]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"总请求:"}),e.jsx("span",{className:"font-medium",children:i.total})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"成功:"}),e.jsx("span",{className:"font-medium text-green-600",children:i.success})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"拒绝:"}),e.jsx("span",{className:"font-medium text-red-600",children:i.rejected})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"成功率:"}),e.jsxs("span",{className:"font-medium",children:[i.successRate.toFixed(1),"%"]})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 bg-${w}-500 rounded-full transition-all duration-300`,style:{width:`${i.successRate}%`}})})}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"最近10次请求:"}),e.jsxs("div",{className:"flex space-x-1",children:[f(o,10).map((b,y)=>e.jsx("div",{className:`w-3 h-3 rounded-full ${b.success?"bg-green-400":"bg-red-400"}`,title:`${b.success?"成功":"拒绝"} - ${new Date(b.timestamp).toLocaleTimeString()}`},`${b.timestamp}-${y}`)),Array.from({length:Math.max(0,10-f(o,10).length)},(b,y)=>e.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-200"},`empty-${y}`))]})]})]},o)})}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"实时状态"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-blue-600 mb-2",children:"令牌桶"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["令牌数: ",t.getTokens(),"/",t.getCapacity()]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-green-600 mb-2",children:"滑动窗口"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["请求数: ",s.getCurrentCount(),"/",s.getMaxRequests()]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-purple-600 mb-2",children:"固定窗口"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["请求数: ",n.getCurrentCount(),"/",n.getMaxRequests()]})]})]})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"算法对比说明"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-600 mb-1",children:"令牌桶"}),e.jsxs("ul",{className:"text-gray-700 space-y-1",children:[e.jsx("li",{children:"• 允许突发流量"}),e.jsx("li",{children:"• 平滑限流"}),e.jsx("li",{children:"• 适合API限流"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-600 mb-1",children:"滑动窗口"}),e.jsxs("ul",{className:"text-gray-700 space-y-1",children:[e.jsx("li",{children:"• 精确控制"}),e.jsx("li",{children:"• 内存消耗较高"}),e.jsx("li",{children:"• 适合精确限流"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-purple-600 mb-1",children:"固定窗口"}),e.jsxs("ul",{className:"text-gray-700 space-y-1",children:[e.jsx("li",{children:"• 实现简单"}),e.jsx("li",{children:"• 可能有突发问题"}),e.jsx("li",{children:"• 适合简单场景"})]})]})]})]})]})},A=()=>{const[t]=r.useState(()=>new q(10,5)),[s,n]=r.useState([]),[u,g]=r.useState(0),[a,v]=r.useState(!1);r.useEffect(()=>{const c=setInterval(()=>{g(t.getCurrentCount())},100);return()=>clearInterval(c)},[t]),r.useEffect(()=>{if(!a)return;const c=setInterval(()=>{m()},800);return()=>clearInterval(c)},[a]);const m=()=>{const c=t.isAllowed(),j={id:Date.now(),timestamp:new Date().toLocaleTimeString(),status:c?"success":"rejected",message:c?"请求成功":"请求被限流"};n(f=>[j,...f.slice(0,9)])},N=()=>{t.reset(),g(t.getCurrentCount()),n([])},p=()=>{v(!a)},d=()=>u/t.getMaxRequests()*100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"滑动窗口状态"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"当前请求数"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"最大请求数"}),e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:t.getMaxRequests()})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"请求数可视化"}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4",children:e.jsx("div",{className:`h-4 rounded-full transition-all duration-300 ${d()>=100?"bg-red-500":d()>=80?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(d(),100)}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:t.getMaxRequests()})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"10秒滑动窗口"}),e.jsx("div",{className:"flex space-x-1",children:Array.from({length:10},(c,j)=>e.jsxs("div",{className:"flex-1 h-6 bg-blue-100 border border-blue-200 rounded flex items-center justify-center text-xs",children:[10-j,"s"]},j))})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:m,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors",children:"发送请求"}),e.jsx("button",{onClick:p,className:`px-4 py-2 rounded transition-colors ${a?"bg-red-500 text-white hover:bg-red-600":"bg-blue-500 text-white hover:bg-blue-600"}`,children:a?"停止自动请求":"开始自动请求"}),e.jsx("button",{onClick:N,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"重置窗口"})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"请求日志"}),s.length===0?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"暂无请求记录"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:s.map(c=>e.jsx("div",{className:`p-3 rounded border-l-4 ${c.status==="success"?"bg-green-50 border-green-400":"bg-red-50 border-red-400"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:c.message}),e.jsx("span",{className:"text-sm text-gray-500",children:c.timestamp})]})},c.id))})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"滑动窗口算法说明"}),e.jsxs("ul",{className:"text-sm text-gray-700 space-y-1",children:[e.jsx("li",{children:"• 窗口大小：10秒"}),e.jsx("li",{children:"• 最大请求数：5个"}),e.jsx("li",{children:"• 窗口会随时间滑动，过期请求自动移除"}),e.jsx("li",{children:"• 在任意10秒内，最多允许5个请求"}),e.jsx("li",{children:"• 相比固定窗口，能更平滑地控制请求速率"})]})]})]})},P=()=>{const[t]=r.useState(()=>new R(5,1)),[s,n]=r.useState([]),[u,g]=r.useState(5),[a,v]=r.useState(!1);r.useEffect(()=>{const d=setInterval(()=>{g(t.getTokens())},100);return()=>clearInterval(d)},[t]),r.useEffect(()=>{if(!a)return;const d=setInterval(()=>{m()},500);return()=>clearInterval(d)},[a]);const m=()=>{const d=t.consume(),c={id:Date.now(),timestamp:new Date().toLocaleTimeString(),status:d?"success":"rejected",message:d?"请求成功":"请求被限流"};n(j=>[c,...j.slice(0,9)])},N=()=>{t.reset(),g(t.getTokens()),n([])},p=()=>{v(!a)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"令牌桶状态"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"当前令牌数"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"桶容量"}),e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:t.getCapacity()})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"令牌可视化"}),e.jsx("div",{className:"flex space-x-1",children:Array.from({length:t.getCapacity()},(d,c)=>e.jsx("div",{className:`w-8 h-8 rounded-full border-2 ${c<u?"bg-blue-500 border-blue-600":"bg-gray-200 border-gray-300"}`},c))})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:m,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"发送请求"}),e.jsx("button",{onClick:p,className:`px-4 py-2 rounded transition-colors ${a?"bg-red-500 text-white hover:bg-red-600":"bg-green-500 text-white hover:bg-green-600"}`,children:a?"停止自动请求":"开始自动请求"}),e.jsx("button",{onClick:N,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"重置令牌桶"})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"请求日志"}),s.length===0?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"暂无请求记录"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:s.map(d=>e.jsx("div",{className:`p-3 rounded border-l-4 ${d.status==="success"?"bg-green-50 border-green-400":"bg-red-50 border-red-400"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:d.message}),e.jsx("span",{className:"text-sm text-gray-500",children:d.timestamp})]})},d.id))})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"令牌桶算法说明"}),e.jsxs("ul",{className:"text-sm text-gray-700 space-y-1",children:[e.jsx("li",{children:"• 桶容量：5个令牌"}),e.jsx("li",{children:"• 补充速率：每秒1个令牌"}),e.jsx("li",{children:"• 每次请求消耗1个令牌"}),e.jsx("li",{children:"• 当令牌不足时，请求被拒绝"}),e.jsx("li",{children:"• 令牌会持续补充，直到达到桶容量上限"})]})]})]})},E=()=>e.jsx(I,{title:"请求限流",description:"学习如何实现请求限流机制，防止系统过载，包括令牌桶、滑动窗口、固定窗口等算法的实现和应用场景。",overview:[{title:"核心概念",items:["令牌桶算法：允许突发流量，通过令牌生成速率控制平均请求速率。","滑动窗口算法：精确控制时间窗口内的请求数量，避免固定窗口的边界问题。","固定窗口算法：实现简单，按固定时间段重置计数器，适合简单限流场景。","多层限流：支持全局、用户、IP、接口等多维度限流。"]},{title:"主要优势",items:["防止系统过载，提升服务稳定性","支持突发流量和高并发场景","灵活适配不同业务需求和精度要求","便于监控和动态调整限流策略"]},{title:"适用场景",items:["API 网关、微服务接口限流","防止恶意刷接口和爬虫攻击","高并发秒杀、抢购等活动","分布式系统的全局流量控制"]},{title:"注意事项",items:["合理设置限流阈值，避免误伤正常用户","关注算法的内存和性能开销","分布式环境下需保证状态一致性和时钟同步","限流触发时要有友好的用户提示和降级方案"]}],examples:[{title:"令牌桶算法",component:e.jsx(P,{}),description:"演示令牌桶算法的工作原理，展示令牌生成、消费和突发流量处理机制。",observationPoints:["观察令牌的实时生成和消费过程","测试突发请求时的处理能力","查看令牌不足时的请求拒绝情况"],keyPoints:["令牌桶允许一定程度的突发流量","令牌生成速率控制平均请求速率","桶容量决定最大突发请求数量"],commonTraps:["桶容量设置过小无法处理正常突发流量","令牌生成速率设置不当影响用户体验","忽略令牌补充的时间精度问题"],solutions:["根据业务特点合理设置桶容量","通过监控数据调优令牌生成速率","使用高精度时间戳计算令牌补充"],importantTips:["适合需要允许突发流量的API限流场景","可通过调整参数平衡性能和保护效果"]},{title:"滑动窗口算法",component:e.jsx(A,{}),description:"演示滑动窗口算法的精确限流能力，展示时间窗口滑动和请求计数机制。",observationPoints:["观察时间窗口的连续滑动过程","测试连续请求的精确限流效果","查看过期请求记录的自动清理"],keyPoints:["滑动窗口提供精确的流量控制","窗口随时间自动滑动避免边界问题","过期请求记录会被自动清理"],commonTraps:["窗口大小设置不合理影响限流效果","高频请求导致内存使用过多","时间精度不够影响窗口滑动准确性"],solutions:["根据业务需求选择合适的窗口大小","定期清理过期请求记录控制内存","使用毫秒级时间戳提高精度"],importantTips:["适合需要精确控制的高要求场景","内存使用量需要重点关注和优化"]},{title:"固定窗口算法",component:e.jsx(W,{}),description:"演示固定窗口算法的简单限流机制，展示窗口重置和边界效应问题。",observationPoints:["观察固定时间窗口的重置过程","测试窗口边界处的请求处理","查看不同窗口的请求分组情况"],keyPoints:["固定窗口实现简单内存占用小","窗口结束时计数器自动重置","存在窗口边界的突发流量问题"],commonTraps:["窗口边界可能出现2倍限制的请求量","窗口大小设置不当影响限流精度","没有考虑窗口切换时的并发问题"],solutions:["结合其他算法缓解边界效应","根据业务特点选择合适窗口大小","使用原子操作保证窗口切换安全"],importantTips:["适合对精度要求不高的简单限流场景","可作为其他算法的补充使用"]},{title:"算法对比分析",component:e.jsx(T,{}),description:"对比三种限流算法的特点和性能差异，帮助选择最适合的算法。",observationPoints:["对比不同算法的实时限流效果","观察算法在压力测试下的表现","分析各算法的成功率和响应特征"],keyPoints:["不同算法适用于不同业务场景","算法选择需要考虑性能和精度平衡","参数配置对算法效果影响显著"],commonTraps:["盲目选择算法不考虑业务特点","参数配置不当影响限流效果","忽略算法的资源消耗差异"],solutions:["深入理解各算法特点和适用场景","通过测试和监控优化参数配置","综合考虑性能、精度和资源消耗"],importantTips:["可根据不同场景组合使用多种算法","需要持续监控和调整限流策略"]}],tutorial:{concepts:["令牌桶算法：通过令牌生成速率和桶容量控制请求速率，允许突发流量。","滑动窗口算法：精确统计任意时间窗口内的请求数，避免固定窗口边界效应。","固定窗口算法：按固定时间段计数，简单高效但有边界问题。","多层限流：全局、用户、IP、接口等多维度限流策略。","分布式限流：通过 Redis 等中间件实现多节点状态同步。"],steps:["分析业务需求确定限流目标和QPS指标","选择合适的限流算法考虑精度和性能平衡","实现限流器核心逻辑和参数配置接口","集成限流器到请求处理中间件或拦截器","配置限流参数如速率、窗口大小、桶容量等","添加监控指标观察限流效果和系统性能","根据监控数据调优参数提升用户体验"],tips:["令牌桶适合API网关等需要处理突发流量的场景","滑动窗口适合对限流精度要求较高的核心接口","固定窗口适合简单场景但要注意边界效应问题","分布式环境建议使用Redis实现共享限流状态"]},interview:{questions:[{question:"请解释令牌桶算法的工作原理和适用场景？",answer:"令牌桶算法维护一个固定容量的令牌桶，令牌以固定速率生成并放入桶中。请求到达时需要消费令牌，有令牌则通过，无令牌则拒绝。令牌桶允许一定程度的突发流量（桶中积累的令牌），适合API网关、CDN等需要处理突发请求的场景。"},{question:"滑动窗口算法相比固定窗口有什么优势？",answer:"滑动窗口避免了固定窗口的边界效应问题。固定窗口在窗口切换时可能出现瞬时2倍流量，而滑动窗口通过连续滑动提供平滑限流。滑动窗口能精确控制任意时间段内的请求数量，但需要存储更多请求时间戳，内存开销较大。"},{question:"在分布式系统中如何实现限流？",answer:"分布式限流通常使用Redis等共享存储维护限流状态。可以使用Redis的INCR、EXPIRE等原子操作实现计数器限流，或使用Lua脚本实现复杂限流逻辑保证原子性。也可以采用分片限流将总限流量分配给各节点，但需要考虑负载不均衡问题。"},{question:"如何选择合适的限流算法？",answer:"选择限流算法需要考虑：1）业务特点：突发流量用令牌桶，精确控制用滑动窗口，简单场景用固定窗口；2）性能要求：固定窗口>令牌桶>滑动窗口；3）内存占用：滑动窗口最大，需要存储请求历史；4）精度要求：滑动窗口>令牌桶>固定窗口。"},{question:"限流触发后如何处理用户请求？",answer:"限流触发后可以：1）直接拒绝并返回429状态码和重试建议；2）将请求放入队列延迟处理；3）降级处理返回缓存数据或默认响应；4）引导用户到其他可用服务；5）提供友好的错误页面说明限流原因和解决方案。"}],keyPoints:["掌握三种主要限流算法的原理和特点","理解分布式环境下的限流实现方案","能够根据业务场景选择合适的限流策略","了解限流参数调优和监控方法"]},bestPractices:{dos:["根据系统实际容量设置合理的限流阈值","建立多层限流机制：全局、用户、IP、接口等维度","实现优雅的限流响应，提供重试建议和等待时间","建立完善的监控和告警机制，及时发现异常流量","使用分布式锁或原子操作保证限流计数的准确性","考虑限流的公平性，避免某些用户占用过多资源","定期评估和调整限流策略，适应业务发展","结合熔断、降级等机制构建完整的保护体系"],donts:["不要设置过于严格的限流阈值影响正常用户体验","不要忽略限流算法的内存和CPU开销","不要在高并发场景下使用非原子操作进行计数","不要忽略分布式环境下的时钟同步问题","不要缺乏对限流效果的监控和分析","不要忽略限流触发时的用户体验设计","不要使用单一维度的限流策略","不要忽略限流规则的动态调整能力"],patterns:["多层限流模式：在不同层次实施限流策略","自适应限流模式：根据系统负载动态调整限流参数","分级限流模式：对不同优先级的请求采用不同的限流策略","熔断限流模式：结合熔断器实现故障隔离","令牌分发模式：在分布式环境中集中管理和分发令牌","预热限流模式：系统启动时逐步提高限流阈值","白名单模式：对特定用户或IP不进行限流","降级限流模式：限流触发时提供降级服务"]}});export{E as default};
