import{I as w}from"./index-BgL7gFsr.js";import{M as s}from"./index-B5UHMOeD.js";const m=new Map,i=new Set,l=new Set;async function f(e,n,o){if(i.has(e)||l.has(e)){if(o)try{console.debug("[CachePrewarm] skipped (already in progress or cached)",e)}catch{}return}i.add(e);try{const t=new AbortController,c=setTimeout(()=>t.abort(),1e4),r=await fetch(e,{cache:"force-cache",signal:t.signal});if(clearTimeout(c),!r.ok)return;const a=await r.blob();if(n){const h=URL.createObjectURL(a);s.set(e,h,200),m.set(e,h)}if(await w.set(e,a,{dbName:"LLI-Cache",storeName:"images",debug:o}),l.add(e),o)try{console.debug("[CachePrewarm] prewarmed",{src:e,size:a.size})}catch{}}catch(t){if(o&&(t==null?void 0:t.name)!=="AbortError")try{console.warn("[CachePrewarm] failed",t)}catch{}}finally{i.delete(e)}}function p(e={}){const{enabled:n=!0,trigger:o="enter",preferMemory:t=!0,debug:c=!1}=e;return{name:"cache-prewarm",version:"1.0.0",config:e,hooks:{onMount:r=>{if(!n||o!=="mount")return;s.get(r.src)||void 0||f(r.src,t,c)},onEnterViewport:r=>{if(!n||o!=="enter")return;s.get(r.src)||void 0||f(r.src,t,c)},onUnmount:r=>{const a=m.get(r.src);if(a){try{URL.revokeObjectURL(a)}catch{}m.delete(r.src)}}}}}export{p as c};
