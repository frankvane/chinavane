import{j as l,R as f}from"./index-D8F4DWO3.js";import{D as y}from"./DemoPage-Cm4QH0wv.js";import{w as b}from"./index-B42FZQrT.js";import{L as v}from"./LazyLoadImageCore-CJJrIobl.js";import"./tomorrow-CQx5l04T.js";import"./GlobalContext-DYUf_pwM.js";function w(o,d=4){try{const s=document.createElement("canvas"),h=Math.min(o.naturalWidth||o.width,256),r=Math.min(o.naturalHeight||o.height,256);s.width=h,s.height=r;const e=s.getContext("2d");if(!e)return null;e.drawImage(o,0,0,h,r);const t=e.getImageData(0,0,h,r).data;let a=0,i=0,n=0,c=0;for(let u=0;u<t.length;u+=4*d)a+=t[u],i+=t[u+1],n+=t[u+2],c++;return a=Math.round(a/c),i=Math.round(i/c),n=Math.round(n/c),`rgb(${a}, ${i}, ${n})`}catch{return null}}function C(o={}){const{setContainerBg:d=!0,sampleSize:s=4,showOverlay:h=!0}=o;return{name:"color-extraction",version:"1.0.0",config:o,hooks:{transformProps:r=>({...r,crossOrigin:"anonymous"}),onMount:r=>{var e,t;try{(t=(e=r.imageRef)==null?void 0:e.current)==null||t.setAttribute("crossOrigin","anonymous")}catch{}},onLoadSuccess:r=>{var a,i,n;const e=(a=r.imageRef)==null?void 0:a.current;if(!e)return;const t=w(e,s);if(d&&t)try{const c=(i=r.containerRef)==null?void 0:i.current;c&&(c.style.background=`linear-gradient(90deg, ${t} 0%, rgba(0,0,0,0.06) 100%)`)}catch{}try{(n=r.sharedData)==null||n.set("dominant-color",t)}catch{}try{e.__lliDominantColor=t}catch{}},renderOverlay:r=>{if(!h)return null;const e=()=>{const[t,a]=f.useState(null);f.useEffect(()=>{let n=!0;const u=requestAnimationFrame(()=>{var p,g;if(!n)return;const m=(p=r.imageRef)==null?void 0:p.current,x=(m==null?void 0:m.__lliDominantColor)||((g=r.sharedData)==null?void 0:g.get("dominant-color"))||null;a(x||null)});return()=>{n=!1,cancelAnimationFrame(u)}},[r]);const i={position:"absolute",top:8,right:8,background:"rgba(0,0,0,0.35)",color:"#fff",fontSize:12,padding:"6px 8px",borderRadius:6,zIndex:5,display:"flex",alignItems:"center",gap:8,boxShadow:"0 2px 8px rgba(0,0,0,0.2)"};return l.jsxs("div",{style:i,children:[l.jsx("span",{style:{width:16,height:16,borderRadius:4,background:t||"transparent",border:"1px solid rgba(255,255,255,0.35)"}}),l.jsx("span",{children:t||"未提取"})]})};return l.jsx(e,{})}}}}const j=b(v,[C({setContainerBg:!0,sampleSize:4,showOverlay:!0})]);function k(){const o=["https://picsum.photos/seed/cc-demo-1/800/600","https://picsum.photos/seed/cc-demo-2/800/600","https://picsum.photos/seed/cc-demo-3/800/600"];return l.jsx(y,{title:"ColorExtraction 插件示例",description:"加载后右上角显示主色卡，容器背景使用主色渐变。",children:l.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",gap:12},children:o.map((d,s)=>l.jsx("div",{style:{width:320,height:200},children:l.jsx(j,{src:d,alt:`ColorExtraction ${s+1}`,loading:"lazy",rootMargin:"300px",containerStyle:{width:"100%",height:"100%",position:"relative"},imageStyle:{width:"100%",height:"100%",objectFit:"cover"}})},d+s))})})}export{k as default};
