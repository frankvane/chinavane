import{j as d,R as y}from"./index-C0E0sUJ6.js";import{D as E}from"./DemoPage-DjGyO8DL.js";import{w as T}from"./index-BUsnPGUY.js";import{L as j}from"./LazyLoadImageCore-BPNS9GwS.js";import"./tomorrow-CNZkBZJs.js";import"./GlobalContext-DYUf_pwM.js";function L(_={}){const{enabled:o=!0,onReport:b}=_;return{name:"user-behavior",version:"1.0.0",config:_,hooks:{transformProps:s=>({...s,unobserveOnVisible:!1}),onMount:s=>{var e,a,t,r,i;if(o)try{(e=s.sharedData)==null||e.set("ub:clicks",0),(a=s.sharedData)==null||a.set("ub:dwell",0),(t=s.sharedData)==null||t.set("ub:enters",0),(r=s.sharedData)==null||r.set("ub:leaves",0),(i=s.sharedData)==null||i.set("ub:enterTs",0)}catch{}},onLoadSuccess:s=>{var t;if(!o)return;const e=(t=s.imageRef)==null?void 0:t.current;if(!e)return;e.__lliUBClicks=e.__lliUBClicks||0,e.__lliUBEnterTs=e.__lliUBEnterTs||0,e.__lliUBDwell=e.__lliUBDwell||0,e.__lliUBEnters=e.__lliUBEnters||0,e.__lliUBLeaves=e.__lliUBLeaves||0;const a=()=>{var r,i;e.__lliUBClicks+=1;try{const n=(((r=s.sharedData)==null?void 0:r.get("ub:clicks"))||0)+1;(i=s.sharedData)==null||i.set("ub:clicks",n)}catch{}};e.__lliUBClickHandler=a;try{e.addEventListener("click",a)}catch{}},onEnterViewport:s=>{var a,t,r,i;if(!o)return;const e=(a=s.imageRef)==null?void 0:a.current;e&&(e.__lliUBEnterTs=Date.now(),e.__lliUBEnters=(e.__lliUBEnters||0)+1);try{const n=(((t=s.sharedData)==null?void 0:t.get("ub:enters"))||0)+1;(r=s.sharedData)==null||r.set("ub:enters",n),(i=s.sharedData)==null||i.set("ub:enterTs",Date.now())}catch{}},onLeaveViewport:s=>{var a,t,r,i,n,c,h;if(!o)return;const e=(a=s.imageRef)==null?void 0:a.current;if(e){const l=e.__lliUBEnterTs||0;l&&(e.__lliUBDwell=(e.__lliUBDwell||0)+(Date.now()-l)),e.__lliUBEnterTs=0,e.__lliUBLeaves=(e.__lliUBLeaves||0)+1}try{const l=(((t=s.sharedData)==null?void 0:t.get("ub:leaves"))||0)+1;(r=s.sharedData)==null||r.set("ub:leaves",l);const u=((i=s.sharedData)==null?void 0:i.get("ub:enterTs"))||0;if(u){const D=(((n=s.sharedData)==null?void 0:n.get("ub:dwell"))||0)+(Date.now()-u);(c=s.sharedData)==null||c.set("ub:dwell",D),(h=s.sharedData)==null||h.set("ub:enterTs",0)}}catch{}},onUnmount:s=>{var l,u,D,B,g,m,U,p,v,w,f;if(!o)return;const e=(l=s.imageRef)==null?void 0:l.current;if(e&&e.__lliUBClickHandler)try{e.removeEventListener("click",e.__lliUBClickHandler)}catch{}const a=((u=s.sharedData)==null?void 0:u.get("ub:enterTs"))||0,t=(((D=s.sharedData)==null?void 0:D.get("ub:dwell"))||0)+(a?Date.now()-a:0),r=e?(e.__lliUBDwell||0)+(e.__lliUBEnterTs?Date.now()-e.__lliUBEnterTs:0):0,i=(e==null?void 0:e.__lliUBClicks)??(((B=s.sharedData)==null?void 0:B.get("ub:clicks"))||0),n=(e==null?void 0:e.__lliUBEnters)??(((g=s.sharedData)==null?void 0:g.get("ub:enters"))||0),c=(e==null?void 0:e.__lliUBLeaves)??(((m=s.sharedData)==null?void 0:m.get("ub:leaves"))||0),h={src:s.src,dwellMs:r||t||0,clicks:i,enters:n,leaves:c};try{b?b(h):console.log("[UserBehavior]",h)}catch{}e&&(delete e.__lliUBClickHandler,delete e.__lliUBClicks,delete e.__lliUBEnterTs,delete e.__lliUBDwell,delete e.__lliUBEnters,delete e.__lliUBLeaves);try{(U=s.sharedData)==null||U.delete("ub:clicks"),(p=s.sharedData)==null||p.delete("ub:dwell"),(v=s.sharedData)==null||v.delete("ub:enters"),(w=s.sharedData)==null||w.delete("ub:leaves"),(f=s.sharedData)==null||f.delete("ub:enterTs")}catch{}},renderOverlay:s=>{if(!o)return null;const e=()=>{const[a,t]=y.useState({dwellMs:0,clicks:0,enters:0,leaves:0,inView:!1});y.useEffect(()=>{let n=!0,c=0;const h=()=>{var U,p,v,w,f,k;if(!n)return;const l=(U=s.imageRef)==null?void 0:U.current,u=(l==null?void 0:l.__lliUBEnterTs)||0,D=((l==null?void 0:l.__lliUBDwell)||0)+(u?Date.now()-u:0),B=((p=s.sharedData)==null?void 0:p.get("ub:enterTs"))||0,g=(((v=s.sharedData)==null?void 0:v.get("ub:dwell"))||0)+(B?Date.now()-B:0);t({dwellMs:D||g||0,clicks:(l==null?void 0:l.__lliUBClicks)??(((w=s.sharedData)==null?void 0:w.get("ub:clicks"))||0),enters:(l==null?void 0:l.__lliUBEnters)??(((f=s.sharedData)==null?void 0:f.get("ub:enters"))||0),leaves:(l==null?void 0:l.__lliUBLeaves)??(((k=s.sharedData)==null?void 0:k.get("ub:leaves"))||0),inView:s.isIntersecting}),c=requestAnimationFrame(h)};return c=requestAnimationFrame(h),()=>{n=!1;try{cancelAnimationFrame(c)}catch{}}},[s]);const r={position:"absolute",top:8,right:8,background:"rgba(30,144,255,0.85)",color:"#fff",fontSize:12,padding:"6px 8px",borderRadius:6,zIndex:5,boxShadow:"0 2px 8px rgba(0,0,0,0.2)",lineHeight:1.4},i=n=>d.jsx("span",{style:{display:"inline-block",width:8,height:8,borderRadius:8,background:n?"#4caf50":"#f44336",marginRight:6}});return d.jsxs("div",{style:r,children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:4},children:[i(a.inView),d.jsx("strong",{children:"视口"})]}),d.jsxs("div",{children:["驻留：",Math.round(a.dwellMs/100)/10,"s"]}),d.jsxs("div",{children:["点击：",a.clicks]}),d.jsxs("div",{children:["进入：",a.enters,"，离开：",a.leaves]}),d.jsx("div",{style:{marginTop:4,opacity:.85},children:"提示：点击或慢慢滚动"})]})};return d.jsx(e,{})}}}}const C=T(j,[L({onReport:_=>{console.log("[UserBehaviorDemo] report",_)}})]);function H(){const _=["https://picsum.photos/seed/ub-1/800/600","https://picsum.photos/seed/ub-2/800/600","https://picsum.photos/seed/ub-3/800/600"];return d.jsx(E,{title:"UserBehavior 插件示例",description:"点击图片或滚动进入/离开视口，观察右上角统计实时更新。",children:d.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",gap:12},children:_.map((o,b)=>d.jsx("div",{style:{width:320,height:200},children:d.jsx(C,{src:o,alt:`UserBehavior ${b+1}`,loading:"lazy",rootMargin:"300px",containerStyle:{width:"100%",height:"100%",position:"relative"},imageStyle:{width:"100%",height:"100%",objectFit:"cover"}})},o+b))})})}export{H as default};
