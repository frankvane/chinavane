import{j as i}from"./index-B9PC2ohi.js";import{D as p}from"./DemoPage-DkYR9Y4e.js";import{w as u}from"./index-D07z_aKU.js";import{L as g}from"./LazyLoadImageCore-B-l3-xqi.js";import{c as y}from"./index-IwF6DAOG.js";import{c as f}from"./index-DdHH6tvR.js";import"./tomorrow-BZAIm09o.js";import"./GlobalContext-DYUf_pwM.js";const c=new Map,w=1e3;function b(r,e){const t=e.src||"",o=Date.now(),n=c.get(t)||0;if(!(o-n<w)){c.set(t,o);try{if(r.report&&r.report(e),r.reportEndpoint){const a=new AbortController,s=setTimeout(()=>a.abort(),5e3);fetch(r.reportEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),keepalive:!0,signal:a.signal}).catch(()=>{}).finally(()=>{clearTimeout(s)})}}catch{}setTimeout(()=>{c.delete(t)},5e3)}}function v(r={}){return{name:"error-tracking",version:"1.0.0",config:r,hooks:{onLoadError:(e,t)=>{var d,l,h;const o="error-count",a=Number(((d=e.sharedData)==null?void 0:d.get(o))??0)+1;(l=e.sharedData)==null||l.set(o,a);const s={src:e.src,message:t instanceof Error?t.message:String(t||"unknown"),stack:t instanceof Error?t.stack:void 0,time:Date.now(),network:e.networkInfo,device:e.deviceInfo,count:a};b(r,s);try{(h=e.sharedData)==null||h.set("had-error",!0)}catch{}return!0},renderOverlay:e=>{var n;if(!r.showBadge)return null;const t=Number(((n=e.sharedData)==null?void 0:n.get("error-count"))??0);if(t<=0)return null;const o={position:"absolute",top:6,right:6,zIndex:10,fontSize:12,color:r.badgeColor??"#fff",background:r.badgeBg??"rgba(220,53,69,0.8)",padding:"2px 6px",borderRadius:4};return i.jsxs("div",{style:o,children:[r.badgeText??"Error"," × ",t]})}}}}const m=u(g,[v({showBadge:!0}),y({retryText:"重试"}),f({maxRetries:1,baseDelayMs:600})]);function I(){return i.jsx(p,{title:"ErrorTracking 插件示例",description:"错误发生时计数并显示徽标，提供覆盖层重试与自动重试。",children:i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",gap:12},children:[i.jsx("div",{style:{width:320,height:200},children:i.jsx(m,{src:"https://invalid.example.com/not-found.jpg",containerStyle:{width:"100%",height:"100%"},imageStyle:{width:"100%",height:"100%",objectFit:"cover"}})}),i.jsx("div",{style:{width:320,height:200},children:i.jsx(m,{src:"https://picsum.photos/seed/error-demo/800/600",containerStyle:{width:"100%",height:"100%"},imageStyle:{width:"100%",height:"100%",objectFit:"cover"}})})]})})}export{I as default};
