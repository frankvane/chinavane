import{g as v}from"./GlobalContext-DYUf_pwM.js";function p(t,e){try{const a=Math.max(1,Math.min(100,Math.round(e)));t.searchParams.set("q",String(a))}catch{}}function w(){const t=typeof navigator<"u"?navigator:void 0;return(t==null?void 0:t.connection)||(t==null?void 0:t.mozConnection)||(t==null?void 0:t.webkitConnection)}function g(t){const e=v();if(t.overrideSaveData??(e==null?void 0:e.saveData))return t.saveDataQuality??35;const n=t.overrideEffectiveType??(e==null?void 0:e.effectiveType)??"4g";return n==="slow-2g"||n==="2g"?t.lowQ??40:n==="3g"?t.lowQ??55:t.highQ??80}function D(t={}){return{name:"adaptive-quality",version:"1.0.0",config:t,hooks:{transformProps:e=>{const a={...e};try{const n=new URL(a.src,typeof window<"u"?window.location.origin:"http://localhost"),h=g(t);p(n,h),a.src=n.toString()}catch{}return a},onMount:e=>{var d,u,l,f;const{mode:a="once"}=t;if(a!=="realtime")return;const n=w();if(!n)return;const h=i=>{var o;try{const r=(o=e.imageRef)==null?void 0:o.current,c=(r==null?void 0:r.src)||e.src,s=new URL(c,typeof window<"u"?window.location.origin:"http://localhost"),y=g(t);p(s,y),r?r.src=s.toString():e.src=s.toString()}catch{}};try{if(typeof n.addEventListener=="function")n.addEventListener("change",h),(d=e.sharedData)==null||d.set("aqp-handler",h),(u=e.sharedData)==null||u.set("aqp-conn",n);else if("onchange"in n){const i=n.onchange;n.onchange=o=>{try{typeof i=="function"&&i.call(n,o)}catch{}h(o)},(l=e.sharedData)==null||l.set("aqp-conn",n),(f=e.sharedData)==null||f.set("aqp-onchange-patched",!0)}}catch{}return()=>{var i,o,r;try{const c=(i=e.sharedData)==null?void 0:i.get("aqp-conn"),s=(o=e.sharedData)==null?void 0:o.get("aqp-handler");if(c&&s&&typeof c.removeEventListener=="function")c.removeEventListener("change",s);else if(c&&((r=e.sharedData)!=null&&r.get("aqp-onchange-patched")))try{c.onchange=null}catch{}}catch{}}}}}}export{D as c};
