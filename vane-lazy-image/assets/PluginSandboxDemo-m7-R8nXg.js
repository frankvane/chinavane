import{r as a,j as e}from"./index-CAgh_i44.js";import{D as S}from"./DemoPage-DDy1Lp2W.js";import{w as x}from"./index-BUiUrMm6.js";import{L as f}from"./LazyLoadImageCore-BXC5ZDAL.js";import"./tomorrow-gtxudeWU.js";import"./GlobalContext-DYUf_pwM.js";function v(o,l){const{pluginName:d,hookTimeout:i=5e3,debug:c=!1}=l;return async(...t)=>{try{if(i===0)return await Promise.resolve(o(...t));const s=new Promise((m,g)=>{setTimeout(()=>{g(new Error(`[Sandbox:${d}] Hook execution timeout (${i}ms)`))},i)});return await Promise.race([Promise.resolve(o(...t)),s])}catch(s){c&&console.error(`[Sandbox:${d}] Hook execution error:`,s);return}}}const H=()=>{const[o,l]=a.useState("none"),[d,i]=a.useState([]),[c,t]=a.useState(0),s=(n,r="info")=>{const h=r==="success"?"âœ…":r==="error"?"âŒ":"â„¹ï¸";i(y=>[...y.slice(-9),`[${new Date().toLocaleTimeString()}] ${h} ${n}`])},u=a.useMemo(()=>({name:"UnsafePlugin",version:"1.0.0",hooks:{onLoadSuccess:(n,r)=>{throw s("ä¸å®‰å…¨æ’ä»¶: onLoadSuccess è¢«è°ƒç”¨","error"),new Error("âŒ æ¨¡æ‹Ÿæ’ä»¶é”™è¯¯ï¼šè¿™æ˜¯ä¸€ä¸ªæ•…æ„çš„é”™è¯¯ï¼")}}}),[]),m=a.useMemo(()=>({name:"SafePlugin",version:"1.0.0",hooks:{onLoadSuccess:v((r,h)=>{throw s("å®‰å…¨æ’ä»¶: onLoadSuccess è¢«è°ƒç”¨","success"),new Error("è¿™ä¸ªé”™è¯¯ä¼šè¢«æ²™ç®±æ•è·")},{pluginName:"SafePlugin",hookTimeout:2e3,debug:!0})}}),[]),g=a.useMemo(()=>o==="none"?x(f,[]):o==="unsafe"?x(f,[u]):x(f,[m]),[o,u,m]),p=()=>{l("unsafe"),t(n=>n+1),s("åŠ è½½ä¸å®‰å…¨æ’ä»¶ï¼ˆä¼šæŠ›å‡ºé”™è¯¯ï¼‰","info")},b=()=>{l("safe"),t(n=>n+1),s("åŠ è½½æ²™ç®±ä¿æŠ¤çš„æ’ä»¶ï¼ˆå®‰å…¨ï¼‰","info")},j=()=>{l("none"),t(n=>n+1),i([]),s("é‡ç½®æ¼”ç¤º","info")};return e.jsxs(S,{title:"PluginSandbox - æ’ä»¶æ²™ç®±æœºåˆ¶",description:"éš”ç¦»æ’ä»¶æ‰§è¡Œç¯å¢ƒï¼Œé˜²æ­¢é”™è¯¯æ’ä»¶å½±å“æ•´ä¸ªåº”ç”¨",children:[e.jsx("div",{style:{marginBottom:20},children:e.jsxs("div",{style:{padding:16,background:"#fef2f2",borderRadius:"8px",border:"1px solid #ef4444"},children:[e.jsxs("p",{style:{margin:0,color:"#991b1b",lineHeight:"1.6",marginBottom:8},children:["âš ï¸ ",e.jsx("strong",{children:"æ²™ç®±æœºåˆ¶ä¿æŠ¤ï¼š"})]}),e.jsxs("ul",{style:{margin:0,color:"#991b1b",lineHeight:"1.8"},children:[e.jsx("li",{children:"ğŸ›¡ï¸ æ•è·æ’ä»¶å†…çš„é”™è¯¯å’Œå¼‚å¸¸"}),e.jsx("li",{children:"â±ï¸ è¶…æ—¶æ§åˆ¶ï¼ˆé˜²æ­¢æ­»å¾ªç¯ï¼‰"}),e.jsx("li",{children:"ğŸ§¹ è‡ªåŠ¨æ¸…ç†èµ„æºå’Œç›‘å¬å™¨"}),e.jsx("li",{children:"ğŸ“¦ å‘½åç©ºé—´éš”ç¦»ï¼ˆsharedDataï¼‰"})]})]})}),e.jsxs("div",{style:{marginBottom:30},children:[e.jsx("h3",{style:{fontSize:"1.1em",marginBottom:12},children:"ğŸ® æµ‹è¯•åœºæ™¯"}),e.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[e.jsx("button",{onClick:p,disabled:o==="unsafe",style:{padding:"10px 20px",background:o==="unsafe"?"#9ca3af":"#dc2626",color:"white",border:"none",borderRadius:"6px",cursor:o==="unsafe"?"not-allowed":"pointer",fontSize:"0.95em"},children:"âŒ åœºæ™¯1: ä¸å®‰å…¨æ’ä»¶ï¼ˆä¼šå‡ºé”™ï¼‰"}),e.jsx("button",{onClick:b,disabled:o==="safe",style:{padding:"10px 20px",background:o==="safe"?"#9ca3af":"#16a34a",color:"white",border:"none",borderRadius:"6px",cursor:o==="safe"?"not-allowed":"pointer",fontSize:"0.95em"},children:"âœ… åœºæ™¯2: æ²™ç®±ä¿æŠ¤ï¼ˆå®‰å…¨ï¼‰"}),e.jsx("button",{onClick:j,style:{padding:"10px 20px",background:"#6b7280",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"0.95em"},children:"ğŸ”„ é‡ç½®"})]})]}),o!=="none"&&e.jsx("div",{style:{marginBottom:20},children:e.jsxs("div",{style:{padding:16,background:o==="unsafe"?"#fee2e2":"#dcfce7",borderRadius:"8px",border:`1px solid ${o==="unsafe"?"#dc2626":"#16a34a"}`},children:[e.jsx("strong",{style:{color:o==="unsafe"?"#991b1b":"#166534"},children:o==="unsafe"?"âŒ ä¸å®‰å…¨æ’ä»¶åœºæ™¯":"âœ… æ²™ç®±ä¿æŠ¤åœºæ™¯"}),e.jsx("p",{style:{margin:"8px 0 0",color:o==="unsafe"?"#991b1b":"#166534"},children:o==="unsafe"?"æ­¤æ’ä»¶åœ¨ onLoadSuccess ä¸­æŠ›å‡ºé”™è¯¯ï¼Œä¼šå¯¼è‡´åº”ç”¨å´©æºƒã€‚è§‚å¯Ÿæ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯ã€‚":"ç›¸åŒçš„é”™è¯¯é€»è¾‘ï¼Œä½†è¢«æ²™ç®±åŒ…è£…ã€‚é”™è¯¯è¢«æ•è·ï¼Œåº”ç”¨ç»§ç»­æ­£å¸¸è¿è¡Œã€‚"})]})}),e.jsxs("div",{style:{marginBottom:30},children:[e.jsx("h3",{style:{fontSize:"1.1em",marginBottom:12},children:"ğŸ–¼ï¸ æµ‹è¯•å›¾ç‰‡"}),e.jsx("p",{style:{color:"#666",marginBottom:12},children:o==="none"?"ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®é€‰æ‹©æµ‹è¯•åœºæ™¯":"è§‚å¯Ÿå›¾ç‰‡åŠ è½½æ—¶çš„æ’ä»¶è¡Œä¸ºå’Œé”™è¯¯å¤„ç†"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:16},children:Array.from({length:3},(n,r)=>e.jsxs("div",{children:[e.jsx("div",{style:{width:"100%",height:200},children:e.jsx(g,{src:`https://picsum.photos/seed/sandbox-${o}-${r}/800/600`,alt:`æ²™ç®±æµ‹è¯• ${r+1}`,loading:"lazy",containerStyle:{width:"100%",height:"100%",background:"#f3f4f6",borderRadius:"8px"},imageStyle:{width:"100%",height:"100%",objectFit:"cover"}})}),e.jsxs("p",{style:{textAlign:"center",marginTop:8,fontSize:"0.85em",color:"#666"},children:["å›¾ç‰‡ ",r+1]})]},`${c}-${o}-${r}`))})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h3",{style:{fontSize:"1.1em",marginBottom:12},children:"ğŸ“œ æ“ä½œæ—¥å¿—"}),e.jsx("div",{style:{padding:16,background:"#1f2937",borderRadius:"8px",color:"#d1d5db",fontFamily:"monospace",fontSize:"0.85em",maxHeight:200,overflow:"auto"},children:d.length===0?e.jsx("div",{style:{color:"#6b7280"},children:"ç­‰å¾…æ“ä½œ..."}):d.map((n,r)=>e.jsx("div",{style:{marginBottom:4},children:n},r))})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h3",{style:{fontSize:"1.1em",marginBottom:12},children:"ğŸ“‹ æ²™ç®±é…ç½®é€‰é¡¹"}),e.jsx("div",{style:{padding:16,background:"#f9fafb",borderRadius:"8px",border:"1px solid #e5e7eb"},children:e.jsx("pre",{style:{margin:0,fontSize:"0.85em",overflow:"auto"},children:`import { wrapPluginHook, SandboxConfig } from "vane-lazy-image/advanced";

const sandboxConfig: SandboxConfig = {
  pluginName: "MyPlugin",     // æ’ä»¶åç§°ï¼ˆå‘½åç©ºé—´ï¼‰
  enabled: true,              // æ˜¯å¦å¯ç”¨æ²™ç®±
  hookTimeout: 5000,          // é’©å­è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰
  autoCleanup: true,          // è‡ªåŠ¨æ¸…ç†ç›‘å¬å™¨
  debug: true,                // è°ƒè¯•æ¨¡å¼
};

// åŒ…è£…ä¸å®‰å…¨çš„é’©å­å‡½æ•°
const safeHook = wrapPluginHook(unsafeHook, sandboxConfig);

// ä½¿ç”¨æ²™ç®±ä¿æŠ¤çš„æ’ä»¶
const safePlugin = {
  name: "SafePlugin",
  onLoadSuccess: safeHook,
};`})})]}),e.jsx("div",{children:e.jsxs("div",{style:{padding:16,background:"#eff6ff",borderRadius:"8px",border:"1px solid #3b82f6"},children:[e.jsxs("p",{style:{margin:0,color:"#1e40af",lineHeight:"1.6",marginBottom:8},children:["ğŸ’¡ ",e.jsx("strong",{children:"ä½¿ç”¨å»ºè®®ï¼š"})]}),e.jsxs("ul",{style:{margin:0,color:"#1e40af",lineHeight:"1.8"},children:[e.jsx("li",{children:"å¯¹ç¬¬ä¸‰æ–¹æ’ä»¶ä½¿ç”¨æ²™ç®±åŒ…è£…"}),e.jsx("li",{children:"åœ¨å¼€å‘ç¯å¢ƒå¯ç”¨ debug æ¨¡å¼"}),e.jsx("li",{children:"æ ¹æ®æ’ä»¶å¤æ‚åº¦è°ƒæ•´è¶…æ—¶æ—¶é—´"}),e.jsx("li",{children:"ä½¿ç”¨å‘½åç©ºé—´é¿å…æ•°æ®å†²çª"}),e.jsx("li",{children:"æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°è·å–è¯¦ç»†æ—¥å¿—"})]})]})})]})};export{H as default};
