let d=null;function g(){if(d)return d;const e="data:image/webp;base64,UklGRiIAAABXRUJQVlA4ICAAAADwAQCdASoBAAEALm0AAA/vv///8AA";return d=new Promise(t=>{try{const r=new Image;r.onload=()=>t(!0),r.onerror=()=>t(!1),r.src=e}catch{t(!1)}}),d}function A(e,t){if(!t||t.length===0)return!0;try{const r=new URL(e);return t.some(i=>r.hostname.includes(i))}catch{return!1}}function b(e,t){if(!t)return e;try{const r=new URL(e),[i,p]=t.split("=");return i&&r.searchParams.set(i,p??""),r.toString()}catch{return e.includes("?")?`${e}&${t}`:`${e}?${t}`}}function h(e,t){const r=e.lastIndexOf(".");if(r<0)return e;const i=e.substring(r+1).toLowerCase();return t.includes(i)?`${e.substring(0,r)}.webp`:e}function m(e={}){const{enabled:t=!0,rewrite:r,replaceExtensions:i=["jpg","jpeg","png"],appendQueryParam:p,onDomains:w,testSupport:l=!0}=e;return{name:"webp",version:"1.0.0",config:e,hooks:{onLoad:async s=>{var o,c;if(!t)return;const a=s.src;if(!A(a,w)||l&&!await g())return;let n;if(r)n=r(a,s);else{const u=h(a,i);n=b(u,p)}if(!(!n||n===a)){try{(o=s.sharedData)==null||o.set("webp:original",a),(c=s.sharedData)==null||c.set("webp:rewritten",n)}catch{}return n}},onLoadError:s=>{var c,u,f;const a=(c=s.sharedData)==null?void 0:c.get("webp:original"),n=(u=s.sharedData)==null?void 0:u.get("webp:rewritten"),o=(f=s.imageRef)==null?void 0:f.current;if(o&&a&&n&&o.src===n){try{o.src=a}catch{}return!0}return!1}}}}export{m as c};
