var p=Object.defineProperty;var b=(l,n,t)=>n in l?p(l,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[n]=t;var j=(l,n,t)=>b(l,typeof n!="symbol"?n+"":n,t);import{j as e,r as o,u as N}from"./index-CKwi3pR7.js";import{C as y}from"./ComponentTemplate-CukjZkuC.js";class v extends o.Component{constructor(t){super(t);j(this,"reportError",(t,i)=>{const d={message:t.message,stack:t.stack,componentStack:i.componentStack,timestamp:Date.now(),url:window.location.href,userAgent:navigator.userAgent};console.error("Error Boundary caught an error:",d)});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,i){this.setState({error:t,errorInfo:i}),this.reportError(t,i)}render(){return this.state.hasError?this.props.fallback?this.props.fallback(this.state.error,this.state.errorInfo):e.jsx("div",{className:"min-h-64 flex items-center justify-center bg-red-50",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-2xl font-bold text-red-800 mb-2",children:"出现了错误"}),e.jsx("p",{className:"text-red-600 mb-4",children:"组件渲染时发生了意外错误"}),e.jsx("button",{onClick:()=>this.setState({hasError:!1,error:null,errorInfo:null}),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"重试"})]})}):this.props.children}}const f=()=>{const[l,n]=o.useState(!1),[t,i]=o.useState("render"),[d,h]=o.useState([]),r=({errorType:s})=>{if(o.useEffect(()=>{s==="async"&&setTimeout(()=>{throw new Error("异步错误：定时器中的错误")},1e3)},[s]),s==="render"&&l)throw new Error("渲染错误：组件渲染时发生错误");if(s==="network")throw new Error("网络错误：API请求失败");return e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded",children:[e.jsx("h4",{className:"font-semibold text-green-800",children:"组件正常运行"}),e.jsxs("p",{className:"text-green-600 text-sm mt-1",children:["当前错误类型: ",s]}),e.jsxs("p",{className:"text-green-600 text-sm",children:["错误状态: ",l?"已触发":"未触发"]})]})},c=()=>{n(!0)},a=()=>{n(!1)},u=s=>{h(x=>[s,...x.slice(0,4)])},g=(s,x)=>{const m={code:"RENDER_ERROR",message:s.message,details:x.componentStack,timestamp:Date.now(),route:window.location.pathname,stack:s.stack};return u(m),e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("span",{className:"text-2xl mr-2",children:"🚨"}),e.jsx("h4",{className:"font-semibold text-red-800",children:"组件错误"})]}),e.jsxs("div",{className:"text-sm text-red-600 mb-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"错误信息:"})," ",s.message]}),e.jsxs("div",{children:[e.jsx("strong",{children:"发生时间:"})," ",new Date(m.timestamp).toLocaleString()]}),e.jsxs("div",{children:[e.jsx("strong",{children:"错误代码:"})," ",m.code]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:a,className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm",children:"重置组件"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700 text-sm",children:"刷新页面"})]}),!1]})};return e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"错误边界演示"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"错误类型："}),e.jsx("div",{className:"flex gap-2",children:[{key:"render",label:"渲染错误",description:"会被ErrorBoundary捕获"},{key:"async",label:"异步错误",description:"不会被ErrorBoundary捕获"},{key:"network",label:"网络错误",description:"模拟API请求失败"}].map(s=>e.jsx("button",{onClick:()=>{i(s.key),n(!1)},className:`px-3 py-2 rounded text-sm transition-colors ${t===s.key?"bg-blue-500 text-white":"bg-white border hover:bg-gray-50"}`,title:s.description,children:s.label},s.key))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:c,disabled:l,className:`px-4 py-2 rounded text-sm transition-colors ${l?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-red-500 text-white hover:bg-red-600"}`,children:"触发错误"}),e.jsx("button",{onClick:a,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 text-sm",children:"重置状态"})]})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"受保护的组件："}),e.jsx(v,{fallback:g,children:e.jsx(r,{errorType:t})})]}),d.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-medium mb-2",children:"错误日志："}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:d.map((s,x)=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded border text-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"font-medium text-red-600",children:s.code}),e.jsx("span",{className:"text-gray-500 text-xs",children:new Date(s.timestamp).toLocaleTimeString()})]}),e.jsx("div",{className:"text-gray-700",children:s.message}),s.route&&e.jsxs("div",{className:"text-gray-500 text-xs mt-1",children:["路由: ",s.route]})]},x))})]}),e.jsxs("div",{className:"mt-6 bg-blue-50 p-4 rounded",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"错误处理机制："}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"ErrorBoundary:"})," 捕获组件树中的JavaScript错误"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"渲染错误:"})," 在render方法中抛出的错误会被捕获"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"异步错误:"})," 事件处理器、定时器中的错误不会被捕获"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"错误上报:"})," 捕获的错误应该上报到监控服务"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"用户体验:"})," 提供友好的错误界面和恢复选项"]})]})]})]})]})},E=()=>{const l=N(),[n]=o.useState([{id:"404",title:"404 - 页面未找到",description:"访问不存在的路由",path:"/non-existent-page",color:"yellow"},{id:"loader-error",title:"Loader 错误",description:"数据加载失败",path:"/error-loader",color:"red"},{id:"action-error",title:"Action 错误",description:"表单提交失败",path:"/error-action",color:"orange"},{id:"component-error",title:"组件错误",description:"组件渲染失败",path:"/error-component",color:"purple"}]),[t,i]=o.useState([]),d=r=>{const c={scenario:r.title,timestamp:Date.now(),handled:!0};i(a=>[c,...a.slice(0,9)]);try{l(r.path)}catch(a){console.error("Navigation error:",a)}},h=()=>{i([])};return e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"路由错误处理演示"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:n.map(r=>e.jsxs("div",{className:`p-4 bg-${r.color}-50 border border-${r.color}-200 rounded`,children:[e.jsx("h4",{className:`font-semibold text-${r.color}-800 mb-1`,children:r.title}),e.jsx("p",{className:`text-${r.color}-600 text-sm mb-3`,children:r.description}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("code",{className:"text-xs bg-white px-2 py-1 rounded",children:r.path}),e.jsx("button",{onClick:()=>d(r),className:`px-3 py-1 bg-${r.color}-500 text-white rounded hover:bg-${r.color}-600 text-sm`,children:"模拟错误"})]})]},r.id))}),t.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-medium",children:"错误历史记录："}),e.jsx("button",{onClick:h,className:"px-2 py-1 bg-gray-500 text-white rounded hover:bg-gray-600 text-xs",children:"清除记录"})]}),e.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1",children:t.map((r,c)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-white rounded border text-sm",children:[e.jsx("span",{children:r.scenario}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs ${r.handled?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:r.handled?"已处理":"未处理"}),e.jsx("span",{className:"text-gray-500 text-xs",children:new Date(r.timestamp).toLocaleTimeString()})]})]},c))})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"bg-green-50 p-4 rounded mb-4",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"路由错误处理策略："}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-green-800 mb-1",children:"错误类型识别"}),e.jsxs("ul",{className:"text-green-700 space-y-1",children:[e.jsx("li",{children:"• 404错误：路由不存在"}),e.jsx("li",{children:"• Loader错误：数据加载失败"}),e.jsx("li",{children:"• Action错误：操作执行失败"}),e.jsx("li",{children:"• 组件错误：渲染异常"})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-green-800 mb-1",children:"处理方案"}),e.jsxs("ul",{className:"text-green-700 space-y-1",children:[e.jsx("li",{children:"• 友好的错误页面"}),e.jsx("li",{children:"• 错误信息记录和上报"}),e.jsx("li",{children:"• 用户操作引导"}),e.jsx("li",{children:"• 自动恢复机制"})]})]})]})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded",children:[e.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"错误处理最佳实践："}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"分层处理:"})," 在不同层级设置错误边界"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"用户友好:"})," 提供清晰的错误信息和操作指引"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"错误上报:"})," 收集错误信息用于问题排查"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"优雅降级:"})," 在错误发生时提供备选方案"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"快速恢复:"})," 提供重试和导航选项"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"开发调试:"})," 在开发环境显示详细错误信息"]})]})]})]})]})},B=()=>e.jsx(y,{title:"传统模式 - 错误处理",description:"全面掌握React Router传统模式的错误处理机制：错误边界、路由错误、异常恢复等，构建健壮的路由应用。",overview:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-red-800 mb-2",children:"🚨 错误类型"}),e.jsxs("ul",{className:"space-y-1 text-sm text-red-700",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"路由错误:"})," 404、加载失败、权限错误"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"组件错误:"})," 渲染异常、生命周期错误"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"异步错误:"})," 网络请求、定时器错误"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"数据错误:"})," Loader、Action执行失败"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"导航错误:"})," 路由跳转异常"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"权限错误:"})," 访问控制失败"]})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-800 mb-2",children:"🛡️ 处理机制"}),e.jsxs("ul",{className:"space-y-1 text-sm text-green-700",children:[e.jsx("li",{children:"• ErrorBoundary组件捕获渲染错误"}),e.jsx("li",{children:"• useRouteError Hook处理路由错误"}),e.jsx("li",{children:"• 全局错误监听和上报"}),e.jsx("li",{children:"• 友好的错误页面和提示"}),e.jsx("li",{children:"• 自动重试和恢复机制"}),e.jsx("li",{children:"• 开发环境的详细错误信息"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2",children:"💡 设计原则"}),e.jsxs("ul",{className:"space-y-1 text-sm text-blue-700",children:[e.jsx("li",{children:"• 用户体验优先：提供清晰的错误信息和操作指引"}),e.jsx("li",{children:"• 分层防护：在不同层级设置错误边界和处理逻辑"}),e.jsx("li",{children:"• 优雅降级：在错误发生时提供备选方案和功能"}),e.jsx("li",{children:"• 快速恢复：提供重试、刷新、导航等恢复选项"}),e.jsx("li",{children:"• 问题追踪：收集和上报错误信息用于问题排查"}),e.jsx("li",{children:"• 开发友好：在开发环境提供详细的调试信息"})]})]})]}),examples:[{title:"错误边界处理",component:e.jsx(f,{}),description:"演示ErrorBoundary组件如何捕获和处理组件错误",observationPoints:["渲染错误会被ErrorBoundary捕获并显示自定义错误界面","异步错误（如定时器中的错误）不会被ErrorBoundary捕获","错误信息会被记录到错误日志中","提供重置和刷新选项帮助用户恢复"],keyPoints:["ErrorBoundary只能捕获组件树中的JavaScript错误","异步错误需要使用其他方式处理","错误边界应该提供友好的降级UI","开发环境应显示详细的错误信息"],commonTraps:["认为ErrorBoundary能捕获所有类型的错误","忘记在错误边界中添加错误上报逻辑","错误界面缺乏用户操作选项"],solutions:["为异步错误设置全局错误处理","在componentDidCatch中添加错误上报","提供重试、导航等恢复选项"]},{title:"路由错误处理",component:e.jsx(E,{}),description:"展示不同类型的路由错误及其处理方式",observationPoints:["不同类型的路由错误有不同的处理方式","404错误提供页面未找到的友好提示","错误历史记录帮助追踪问题","每种错误都有相应的恢复选项"],keyPoints:["useRouteError Hook获取路由错误信息","isRouteErrorResponse判断错误类型","不同错误类型需要不同的处理策略","错误页面应提供导航选项"],commonTraps:["没有区分不同类型的路由错误","错误页面缺乏导航功能","忘记处理网络错误和权限错误"],solutions:["使用类型检查区分错误类型","提供多种导航和恢复选项","建立完整的错误处理体系"]}],tutorial:{concepts:["错误边界：使用ErrorBoundary组件捕获组件树中的错误","路由错误：处理404、加载失败、权限等路由相关错误","异步错误：处理事件处理器、定时器等异步操作中的错误","错误上报：收集错误信息并发送到监控服务","用户体验：提供友好的错误界面和恢复选项","开发调试：在开发环境提供详细的错误信息"],steps:["分析应用中可能出现的错误类型","创建ErrorBoundary组件处理渲染错误","实现路由错误处理组件","设置全局错误监听和处理","建立错误上报和监控机制","设计友好的错误界面","添加错误恢复和导航功能","测试各种错误场景"],tips:["在应用的关键位置设置错误边界","为不同类型的错误提供不同的处理方式","错误信息应该对用户友好，对开发者详细","提供多种错误恢复选项","建立错误监控和告警机制","定期分析错误日志优化应用"]},interview:{questions:[{question:"React Router中有哪些类型的错误？如何处理？",answer:"主要错误类型：1) 路由错误：404、权限错误等，使用errorElement和useRouteError处理；2) 组件错误：渲染异常，使用ErrorBoundary捕获；3) 异步错误：网络请求失败等，需要在具体位置处理；4) 数据错误：Loader/Action失败，会自动传递给errorElement；处理方式包括友好的错误页面、错误上报、用户引导等。"},{question:"ErrorBoundary的工作原理是什么？有什么限制？",answer:"工作原理：ErrorBoundary是React类组件，通过componentDidCatch和getDerivedStateFromError生命周期方法捕获子组件树中的JavaScript错误；限制：1) 只能捕获组件树中的错误，不能捕获事件处理器、异步代码、服务端渲染、ErrorBoundary自身的错误；2) 只在生产环境中生效，开发环境会显示错误覆盖层；3) 错误边界无法捕获自身的错误。"},{question:"如何设计一个完整的错误处理体系？",answer:"完整的错误处理体系包括：1) 分层防护：在应用、路由、组件等不同层级设置错误边界；2) 错误分类：区分路由错误、组件错误、网络错误等；3) 用户体验：提供友好的错误页面和操作指引；4) 错误上报：收集错误信息发送到监控服务；5) 恢复机制：提供重试、刷新、导航等选项；6) 开发支持：开发环境显示详细错误信息；7) 监控告警：建立错误监控和告警机制。"},{question:"在React Router中如何处理异步错误？",answer:"异步错误处理方法：1) 全局错误监听：使用window.addEventListener('error')和window.addEventListener('unhandledrejection')；2) Promise错误：在.catch()中处理，或使用async/await的try-catch；3) 网络请求：在请求拦截器中统一处理；4) 定时器错误：在回调函数中添加try-catch；5) 状态管理：在Redux等状态管理中添加错误处理中间件；6) 用户反馈：通过toast、modal等方式提示用户。"},{question:"如何在生产环境中监控和分析错误？",answer:"生产环境错误监控：1) 错误收集：使用Sentry、Bugsnag等服务收集错误信息；2) 关键指标：监控错误率、影响用户数、错误类型分布；3) 错误分析：分析错误堆栈、用户行为、环境信息；4) 告警机制：设置错误阈值和告警规则；5) 性能影响：监控错误对性能的影响；6) 修复跟踪：跟踪错误修复效果和回归情况；7) 用户反馈：结合用户反馈分析错误影响。"}],keyPoints:["掌握React Router中的错误类型和处理方法","理解ErrorBoundary的工作原理和限制","熟悉路由错误处理的最佳实践","了解异步错误的处理方式","掌握错误监控和分析方法","理解错误处理对用户体验的影响"]},bestPractices:{dos:["在应用的关键位置设置错误边界","为不同类型的错误提供相应的处理方式","提供友好的错误界面和操作指引","建立完整的错误上报和监控机制","在开发环境显示详细的错误信息","提供多种错误恢复选项","定期分析错误日志优化应用"],donts:["不要忽略异步错误的处理","不要在错误界面中暴露敏感信息","不要让错误阻塞整个应用","不要忘记在错误边界中添加错误上报","不要过度依赖ErrorBoundary处理所有错误","不要在生产环境显示技术错误详情","不要忽略错误对用户体验的影响"],patterns:["分层防护：应用级 + 路由级 + 组件级错误边界","错误分类：路由错误 + 组件错误 + 异步错误 + 网络错误","用户体验：友好提示 + 操作指引 + 快速恢复","监控体系：错误收集 + 分析告警 + 修复跟踪","开发支持：详细信息 + 调试工具 + 测试覆盖"]}});export{B as default};
