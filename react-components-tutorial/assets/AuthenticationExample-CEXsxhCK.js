import{r as t,j as e}from"./index-CbVlrJMN.js";const b=t.createContext(void 0),j=({children:s})=>{const[r,n]=t.useState(null),[u,o]=t.useState(!1),c=t.useCallback(async(a,h)=>{o(!0),console.log("登录尝试:",a);try{if(await new Promise(d=>setTimeout(d,1e3)),a&&h){const d={id:"1",name:a.split("@")[0],email:a,avatar:`https://api.dicebear.com/7.x/avataaars/svg?seed=${a}`,role:a.includes("admin")?"admin":"user"};n(d),console.log("登录成功:",d)}else throw new Error("邮箱和密码不能为空")}catch(d){throw console.error("登录失败:",d),d}finally{o(!1)}},[]),i=t.useCallback(()=>{console.log("用户登出"),n(null)},[]),x=t.useCallback(a=>{n(h=>{if(!h)return null;const d={...h,...a};return console.log("用户资料更新:",d),d})},[]),m=t.useMemo(()=>r!==null,[r]),l=t.useMemo(()=>({user:r,isLoading:u,isAuthenticated:m,login:c,logout:i,updateProfile:x}),[r,u,m,c,i,x]);return e.jsx(b.Provider,{value:l,children:s})},g=()=>{const s=t.useContext(b);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s},p=()=>{const{login:s,isLoading:r}=g(),[n,u]=t.useState(""),[o,c]=t.useState(""),[i,x]=t.useState(""),m=async l=>{l.preventDefault(),x("");try{await s(n,o)}catch(a){x(a instanceof Error?a.message:"登录失败")}};return e.jsxs("div",{className:"max-w-md mx-auto bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-800",children:"用户登录"}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"邮箱地址"}),e.jsx("input",{type:"email",value:n,onChange:l=>u(l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入邮箱地址",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"密码"}),e.jsx("input",{type:"password",value:o,onChange:l=>c(l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入密码",required:!0})]}),i&&e.jsx("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded-md",children:i}),e.jsx("button",{type:"submit",disabled:r,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:r?"登录中...":"登录"})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:[e.jsx("p",{children:"💡 提示: 输入任意邮箱和密码即可登录"}),e.jsx("p",{children:'🔧 管理员账户: 邮箱包含 "admin" 字样'})]})]})},y=()=>{const{user:s,logout:r,updateProfile:n}=g(),[u,o]=t.useState(!1),[c,i]=t.useState((s==null?void 0:s.name)||"");if(!s)return null;const x=()=>{n({name:c}),o(!1)},m=l=>{switch(l){case"admin":return"bg-red-100 text-red-800";case"user":return"bg-blue-100 text-blue-800";case"guest":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"max-w-md mx-auto bg-white p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("img",{src:s.avatar,alt:s.name,className:"w-20 h-20 rounded-full mx-auto mb-4"}),u?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:c,onChange:l=>i(l.target.value),className:"text-xl font-bold text-center border-b-2 border-blue-500 focus:outline-none"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:x,className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700",children:"保存"}),e.jsx("button",{onClick:()=>o(!1),className:"px-3 py-1 bg-gray-600 text-white rounded text-sm hover:bg-gray-700",children:"取消"})]})]}):e.jsx("div",{children:e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:[s.name,e.jsx("button",{onClick:()=>o(!0),className:"ml-2 text-blue-600 hover:text-blue-800",children:"✏️"})]})}),e.jsx("p",{className:"text-gray-600 mb-2",children:s.email}),e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${m(s.role)}`,children:s.role==="admin"?"管理员":s.role==="user"?"普通用户":"访客"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:"账户信息"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"用户ID:"})," ",s.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"角色:"})," ",s.role]}),e.jsxs("p",{children:[e.jsx("strong",{children:"邮箱:"})," ",s.email]})]})]}),e.jsx("button",{onClick:r,className:"w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 transition-colors",children:"退出登录"})]})]})},f=()=>{const{isAuthenticated:s,isLoading:r,user:n}=g();return e.jsxs("div",{className:"max-w-md mx-auto bg-white p-4 rounded-lg shadow-md mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-gray-800",children:"认证状态"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"登录状态:"}),e.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${s?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s?"已登录":"未登录"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"加载状态:"}),e.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${r?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:r?"加载中":"空闲"})]}),n&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"当前用户:"}),e.jsx("span",{className:"text-blue-600 font-medium",children:n.name})]})]})]})},N=()=>{const{isAuthenticated:s}=g();return e.jsxs("div",{className:"space-y-6",children:[e.jsx(f,{}),s?e.jsx(y,{}):e.jsx(p,{}),e.jsxs("div",{className:"max-w-4xl mx-auto bg-blue-50 p-6 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-blue-800",children:"🔐 认证Provider技术要点"}),e.jsxs("ul",{className:"space-y-2 text-blue-700",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"异步状态管理"}),": 处理登录/登出的异步操作"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"错误处理"}),": 捕获和显示认证过程中的错误"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"加载状态"}),": 提供用户友好的加载反馈"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"用户资料管理"}),": 支持用户信息的查看和更新"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"角色权限"}),": 区分不同用户角色（管理员/普通用户/访客）"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"持久化"}),": 可扩展支持本地存储和会话管理"]})]})]})]})},w=()=>e.jsx(j,{children:e.jsx("div",{className:"min-h-screen bg-gray-100 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-center mb-8 text-gray-800",children:"用户认证系统演示"}),e.jsx(N,{})]})})});export{w as default};
