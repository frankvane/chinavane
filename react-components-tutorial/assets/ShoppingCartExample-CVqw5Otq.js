import{r as d,j as e}from"./index-CbVlrJMN.js";const p=(s,a)=>{switch(a.type){case"ADD_ITEM":{const t=s.items.find(l=>l.id===a.payload.id);let i;t?i=s.items.map(l=>l.id===a.payload.id?{...l,quantity:l.quantity+1}:l):i=[...s.items,{...a.payload,quantity:1}];const c=i.reduce((l,o)=>l+o.price*o.quantity,0),n=i.reduce((l,o)=>l+o.quantity,0);return{...s,items:i,total:c-c*s.discount/100,itemCount:n}}case"REMOVE_ITEM":{const t=s.items.filter(n=>n.id!==a.payload),i=t.reduce((n,l)=>n+l.price*l.quantity,0),c=t.reduce((n,l)=>n+l.quantity,0);return{...s,items:t,total:i-i*s.discount/100,itemCount:c}}case"UPDATE_QUANTITY":{if(a.payload.quantity<=0)return p(s,{type:"REMOVE_ITEM",payload:a.payload.id});const t=s.items.map(n=>n.id===a.payload.id?{...n,quantity:a.payload.quantity}:n),i=t.reduce((n,l)=>n+l.price*l.quantity,0),c=t.reduce((n,l)=>n+l.quantity,0);return{...s,items:t,total:i-i*s.discount/100,itemCount:c}}case"CLEAR_CART":return{...s,items:[],total:0,itemCount:0};case"APPLY_DISCOUNT":{const t=s.items.reduce((i,c)=>i+c.price*c.quantity,0);return{...s,discount:a.payload,total:t-t*a.payload/100}}default:return s}},b={items:[],total:0,itemCount:0,discount:0},g=d.createContext(void 0),y=({children:s})=>{const[a,t]=d.useReducer(p,b),i=d.useCallback(r=>{console.log("添加商品到购物车:",r),t({type:"ADD_ITEM",payload:r})},[]),c=d.useCallback(r=>{console.log("从购物车移除商品:",r),t({type:"REMOVE_ITEM",payload:r})},[]),n=d.useCallback((r,m)=>{console.log("更新商品数量:",r,m),t({type:"UPDATE_QUANTITY",payload:{id:r,quantity:m}})},[]),l=d.useCallback(()=>{console.log("清空购物车"),t({type:"CLEAR_CART"})},[]),o=d.useCallback(r=>{console.log("应用折扣:",r+"%"),t({type:"APPLY_DISCOUNT",payload:r})},[]),x=d.useCallback(r=>a.items.find(m=>m.id===r),[a.items]),h=d.useCallback(r=>a.items.some(m=>m.id===r),[a.items]),j=d.useMemo(()=>({state:a,addItem:i,removeItem:c,updateQuantity:n,clearCart:l,applyDiscount:o,getItemById:x,isItemInCart:h}),[a,i,c,n,l,o,x,h]);return e.jsx(g.Provider,{value:j,children:s})},u=()=>{const s=d.useContext(g);if(s===void 0)throw new Error("useCart must be used within a CartProvider");return s},f=[{id:"1",name:'MacBook Pro 16"',price:2399,image:"https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=200&h=200&fit=crop",category:"笔记本电脑"},{id:"2",name:"iPhone 15 Pro",price:999,image:"https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=200&h=200&fit=crop",category:"智能手机"},{id:"3",name:"AirPods Pro",price:249,image:"https://images.unsplash.com/photo-1606220945770-b5b6c2c55bf1?w=200&h=200&fit=crop",category:"音频设备"},{id:"4",name:"iPad Air",price:599,image:"https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=200&h=200&fit=crop",category:"平板电脑"},{id:"5",name:"Apple Watch",price:399,image:"https://images.unsplash.com/photo-1434493789847-2f02dc6ca35d?w=200&h=200&fit=crop",category:"智能手表"},{id:"6",name:"Magic Keyboard",price:179,image:"https://images.unsplash.com/photo-1587829741301-dc798b83add3?w=200&h=200&fit=crop",category:"配件"}],N=({product:s})=>{const{addItem:a,isItemInCart:t,getItemById:i}=u(),c=i(s.id),n=t(s.id);return e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow",children:[e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-48 object-cover"}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:s.category})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:s.name}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 mb-4",children:["$",s.price]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(s),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:n?"再次添加":"加入购物车"}),n&&e.jsxs("span",{className:"text-sm text-green-600 font-medium",children:["已有 ",c==null?void 0:c.quantity," 件"]})]})]})]})},v=({item:s})=>{const{updateQuantity:a,removeItem:t}=u();return e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-white rounded-lg shadow-sm",children:[e.jsx("img",{src:s.image,alt:s.name,className:"w-16 h-16 object-cover rounded-md"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.category}),e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["$",s.price]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>a(s.id,s.quantity-1),className:"w-8 h-8 bg-gray-200 text-gray-700 rounded-full hover:bg-gray-300 transition-colors",children:"-"}),e.jsx("span",{className:"w-8 text-center font-medium",children:s.quantity}),e.jsx("button",{onClick:()=>a(s.id,s.quantity+1),className:"w-8 h-8 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors",children:"+"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-gray-800",children:["$",(s.price*s.quantity).toFixed(2)]}),e.jsx("button",{onClick:()=>t(s.id),className:"text-red-600 hover:text-red-800 text-sm mt-1",children:"移除"})]})]})},C=({isOpen:s,onClose:a})=>{const{state:t,clearCart:i,applyDiscount:c}=u(),[n,l]=d.useState(""),o=()=>{const h={SAVE10:10,SAVE20:20,WELCOME:15}[n.toUpperCase()]||0;h>0&&(c(h),l(""))};return s?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:a}),e.jsxs("div",{className:"absolute right-0 top-0 h-full w-96 bg-white shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"购物车"}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",style:{height:"calc(100vh - 200px)"},children:t.items.length===0?e.jsxs("div",{className:"text-center text-gray-500 mt-8",children:[e.jsx("p",{children:"购物车为空"}),e.jsx("p",{className:"text-sm mt-2",children:"添加一些商品开始购物吧！"})]}):t.items.map(x=>e.jsx(v,{item:x},x.id))}),t.items.length>0&&e.jsxs("div",{className:"border-t p-4 space-y-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:n,onChange:x=>l(x.target.value),placeholder:"输入折扣码 (SAVE10, SAVE20, WELCOME)",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm"}),e.jsx("button",{onClick:o,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm",children:"应用"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"商品数量:"}),e.jsxs("span",{children:[t.itemCount," 件"]})]}),t.discount>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsxs("span",{children:["折扣 (",t.discount,"%):"]}),e.jsxs("span",{children:["-$",(t.total/(1-t.discount/100)-t.total).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"总计:"}),e.jsxs("span",{children:["$",t.total.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{className:"w-full bg-blue-600 text-white py-3 rounded-md hover:bg-blue-700 font-medium",children:"去结算"}),e.jsx("button",{onClick:i,className:"w-full bg-red-600 text-white py-2 rounded-md hover:bg-red-700",children:"清空购物车"})]})]})]})]}):null},w=()=>{const{state:s}=u();return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-gray-800",children:"购物车状态"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.items.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"商品种类"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.itemCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"商品总数"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[s.discount,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"当前折扣"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["$",s.total.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"总金额"})]})]})]})},E=()=>{const{state:s}=u(),[a,t]=d.useState(!1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between bg-white p-4 rounded-lg shadow-md",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"电子商城"}),e.jsxs("button",{onClick:()=>t(!0),className:"relative bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:["购物车",s.itemCount>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center",children:s.itemCount})]})]}),e.jsx(w,{}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map(i=>e.jsx(N,{product:i},i.id))}),e.jsx(C,{isOpen:a,onClose:()=>t(!1)}),e.jsxs("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-green-800",children:"🛒 购物车Provider技术要点"}),e.jsxs("ul",{className:"space-y-2 text-green-700",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"useReducer状态管理"}),": 处理复杂的购物车状态变更"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Action类型系统"}),": 定义清晰的状态变更操作"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"自动计算"}),": 实时计算总价、商品数量和折扣"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"商品管理"}),": 添加、移除、更新数量等完整CRUD操作"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"折扣系统"}),": 支持折扣码和动态价格计算"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"性能优化"}),": useCallback和useMemo避免不必要的重渲染"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"类型安全"}),": 完整的TypeScript类型定义"]})]})]})]})},A=()=>e.jsx(y,{children:e.jsx("div",{className:"min-h-screen bg-gray-100 py-8",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4",children:e.jsx(E,{})})})});export{A as default};
