import{d as z,A as C,u as G,j as et,b as F,h as q,k as st,l as J,D as H,g as K,m as Y,n as ot,o as nt,p as Q,q as rt}from"./index-CNVOlx-d.js";import{E as W,e as h,o as p,G as t,f as S,J as m,v as b,F as B,k as N,S as U,B as T,U as V,K as r,I as $,g as A,A as I,L as it,C as j,M as X}from"./vue-BPmSeTKS.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const at={key:0},lt=["title"],dt=["title"],ct=["title"],ut={key:2,class:"flex flex-wrap gap-2 mb-2"},gt=["onClick","title"],ht={class:"font-bold text-center truncate w-full text-sm"},pt=["title"],mt=["title"],ft={key:1,class:"text-gray-400 text-center py-4"},vt=W({__name:"WordInfo",props:{word:{},showPhonetic:{type:Boolean,default:!0},showTranslation:{type:Boolean,default:!0},showBreakdown:{type:Boolean,default:!0},slowRate:{default:.7}},emits:["speak"],setup(M,{emit:e}){const f=e,d=(l,v)=>{f("speak",l,v)};return(l,v)=>l.word&&l.word.original?(p(),h("div",at,[t("div",{class:b(["text-2xl font-extrabold mb-2 text-indigo-700 tracking-wide truncate",l.word.original.length>20?"long-word":""]),title:l.word.original},m(l.word.original),11,lt),l.showPhonetic&&l.word.phonetic?(p(),h("div",{key:0,class:"text-indigo-500 italic mb-1 text-lg truncate",title:l.word.phonetic},m(l.word.phonetic),9,dt)):S("",!0),l.showTranslation&&l.word.translation?(p(),h("div",{key:1,class:"text-green-600 mb-1 text-lg truncate",title:l.word.translation},m(l.word.translation),9,ct)):S("",!0),l.showBreakdown&&l.word.breakdown&&l.word.breakdown.length?(p(),h("div",ut,[(p(!0),h(B,null,N(l.word.breakdown,(c,w)=>(p(),h("div",{key:w,class:"bg-indigo-100 text-indigo-700 rounded-lg px-2 py-1 mr-1 mb-1 flex flex-col items-center min-w-[60px] max-w-[100px] cursor-pointer hover:bg-indigo-300 hover:text-white transition",onClick:U(k=>d(c.word,l.slowRate),["stop"]),title:`${c.word}${c.phonetic?" - "+c.phonetic:""}${c.translation?" - "+c.translation:""}`},[t("span",ht,m(c.word),1),l.showPhonetic&&c.phonetic?(p(),h("span",{key:0,class:"text-indigo-400 text-xs text-center truncate w-full",title:c.phonetic},m(c.phonetic),9,pt)):S("",!0),l.showTranslation&&c.translation?(p(),h("span",{key:1,class:"text-green-500 text-xs text-center truncate w-full",title:c.translation},m(c.translation),9,mt)):S("",!0)],8,gt))),128))])):S("",!0)])):(p(),h("div",ft,"加载中..."))}}),yt=L(vt,[["__scopeId","data-v-6c85d33c"]]),wt={class:"flex gap-3 mt-3 items-center"},xt=["title","disabled"],bt=W({__name:"WordActions",props:{word:{},isRecording:{type:Boolean},currentRecordingWord:{},slowRate:{},studyType:{}},emits:["speak","start-pronunciation-check","stop-pronunciation-check","show-word-history","copy","search-word","get-practice-count"],setup(M,{emit:e}){const f=M,d=z(),l=e,v=(n,u)=>{l("speak",n,u)},c=n=>{l("start-pronunciation-check",n)},w=()=>{l("stop-pronunciation-check")},k=n=>{l("show-word-history",n)},y=n=>{l("copy",n)},P=n=>{l("search-word",n)},R=n=>d.getPracticeCount(n,f.studyType||C.STUDY_TYPES.REGULAR);return(n,u)=>(p(),h("div",wt,[t("button",{title:"正常发音",onClick:u[0]||(u[0]=o=>v(n.word.original,1)),class:"card-btn"},u[6]||(u[6]=[t("span",{class:"mdi mdi-volume-high"},null,-1)])),t("button",{title:"慢速发音",onClick:u[1]||(u[1]=o=>v(n.word.original,n.slowRate)),class:"card-btn"},u[7]||(u[7]=[t("span",{class:"mdi mdi-turtle"},null,-1)])),t("button",{title:n.isRecording&&n.currentRecordingWord===n.word.original?"停止录音":"录音练习发音",onClick:u[2]||(u[2]=o=>n.isRecording&&n.currentRecordingWord===n.word.original?w():c(n.word.original)),class:b(["card-btn","microphone-btn",n.isRecording&&n.currentRecordingWord===n.word.original?"recording":""]),disabled:n.isRecording&&n.currentRecordingWord!==n.word.original},[t("span",{class:b(["mdi",n.isRecording&&n.currentRecordingWord===n.word.original?"mdi-microphone-off":"mdi-microphone"])},null,2)],10,xt),R(n.word.original)>0?(p(),h("button",{key:0,title:"查看练习历史",onClick:u[3]||(u[3]=o=>k(n.word.original)),class:"card-btn"},u[8]||(u[8]=[t("span",{class:"mdi mdi-history"},null,-1)]))):S("",!0),t("button",{title:"复制",onClick:u[4]||(u[4]=o=>y(n.word.original)),class:"card-btn"},u[9]||(u[9]=[t("span",{class:"mdi mdi-content-copy"},null,-1)])),t("button",{title:"搜索",onClick:u[5]||(u[5]=o=>P(n.word.original)),class:"card-btn"},u[10]||(u[10]=[t("span",{class:"mdi mdi-magnify"},null,-1)]))]))}}),kt=L(bt,[["__scopeId","data-v-fb2870ba"]]),Rt={class:"pt-1 border-t border-indigo-100 flex items-center gap-1"},St=["title"],_t=W({__name:"WordRating",props:{word:{},stars:{},fileIdx:{},groupName:{}},setup(M){const e=G(),f=(d,l,v)=>et(d,l,v,e);return(d,l)=>(p(),h("div",Rt,[(p(!0),h(B,null,N(d.stars,v=>(p(),h("span",{key:d.word.original+"-star-bottom-"+v,class:"p-0.5",title:`单词评分: ${f(d.fileIdx,d.groupName,d.word.original)} 星`},[t("span",{class:b(["mdi text-xl",f(d.fileIdx,d.groupName,d.word.original)>=v?"mdi-star text-yellow-400":"mdi-star-outline text-gray-400"])},null,2)],8,St))),128))]))}}),Ct={class:"relative w-full h-[400px] bg-white rounded-2xl shadow-lg border border-gray-300 p-6 hover:shadow-2xl transition-all flex flex-col items-start overflow-hidden bg-gradient-to-t from-gray-200 to-white"},$t={class:"absolute top-3 right-6 text-indigo-200 font-bold text-xs bg-indigo-400 rounded-full px-3 py-1"},Pt={key:0,class:"w-full mb-3"},Tt=["title"],Mt={class:"w-full mt-2 mb-1 text-left"},Wt=W({__name:"WordCard",props:{word:{},wordIndex:{},fileIdx:{},groupName:{},studyType:{default:C.STUDY_TYPES.REGULAR}},setup(M){const e=G(),f=z(),d=F(),l=M,v=T(()=>l.studyType===C.STUDY_TYPES.PLAN?q().getWordProgress(l.word.original).totalAttempts:d.getPracticeCount(l.word,l.studyType)),c=T(()=>l.studyType===C.STUDY_TYPES.PLAN?q().getWordProgress(l.word.original).lastAttemptScore||0:d.getAverageScore(l.word,l.studyType)),w=(o,i=1)=>{e.speak(o,i)},k=o=>{f.startPronunciationCheck(o,!0,l.studyType)},y=()=>{f.stopPronunciationCheck()},P=o=>{d.showWordHistory(o,l.studyType)},R=async o=>{try{await st(o)}catch{}},n=o=>{e.searchWord(o)},u=o=>d.getPracticeCount({original:o},l.studyType);return(o,i)=>(p(),h("div",Ct,[t("div",$t,m(o.wordIndex+1),1),V([o.word.original,o.word.phonetic,o.word.translation,o.word.breakdown,r(e).showPhonetic,r(e).showTranslation,r(e).showBreakdown,r(e).slowRate],()=>A(yt,{word:o.word,showPhonetic:r(e).showPhonetic,showTranslation:r(e).showTranslation,showBreakdown:r(e).showBreakdown,slowRate:r(e).slowRate,onSpeak:w},null,8,["word","showPhonetic","showTranslation","showBreakdown","slowRate"]),i,0),o.word.__originalGroup?(p(),h("div",Pt,[t("div",{class:"inline-block text-xs bg-gray-100 text-gray-600 rounded-full px-2 py-1 border border-gray-200",title:`来自分组: ${o.word.__originalGroup}`},[i[3]||(i[3]=t("span",{class:"mdi mdi-folder-outline mr-1"},null,-1)),$(m(o.word.__originalGroup),1)],8,Tt)])):S("",!0),V([o.word.original,r(f).isRecording,r(f).currentRecordingWord,r(e).slowRate,l.studyType],()=>A(kt,{word:o.word,isRecording:r(f).isRecording,currentRecordingWord:r(f).currentRecordingWord,slowRate:r(e).slowRate,studyType:l.studyType,onSpeak:w,onStartPronunciationCheck:k,onStopPronunciationCheck:y,onShowWordHistory:P,onCopy:R,onSearchWord:n,onGetPracticeCount:u},null,8,["word","isRecording","currentRecordingWord","slowRate","studyType"]),i,1),t("div",Mt,[t("div",{class:b(v.value>0?"text-black text-sm":"text-gray-400 text-sm")}," 练习次数: "+m(v.value),3),t("div",{class:b(v.value>0?"text-black text-sm":"text-gray-400 text-sm")}," 平均分数: "+m(v.value>0?c.value+"%":"暂无"),3)]),i[4]||(i[4]=t("div",{class:"w-full h-px bg-gray-300 my-2"},null,-1)),V([o.word.original,l.fileIdx,l.groupName,c.value],()=>A(_t,{word:o.word,stars:[1,2,3,4,5],fileIdx:l.fileIdx||0,groupName:l.groupName||""},null,8,["word","fileIdx","groupName"]),i,2)]))}}),Ps=L(Wt,[["__scopeId","data-v-cd00d0d7"]]),Ts=W({__name:"BackToTop",setup(M){const e=G();return(f,d)=>r(e).showBackToTop?(p(),h("button",{key:0,onClick:d[0]||(d[0]=(...l)=>r(J)&&r(J)(...l)),class:"fixed bottom-8 right-8 text-black hover:text-gray-600 transition-all duration-300 z-50 p-2 bg-purple-400 rounded-2xl shadow-lg",title:"返回顶部"},d[1]||(d[1]=[t("span",{class:"mdi mdi-chevron-up text-2xl"},null,-1)]))):S("",!0)}}),Dt={class:"bg-gray-50 p-3 rounded-lg mb-4"},Ot={class:"flex items-center justify-between mb-2"},Et={class:"flex items-center gap-3"},It={class:"flex items-center gap-2"},Lt=["value","min","max"],At=["value","min","max"],Bt={class:"flex gap-1"},Nt={class:"flex items-center justify-between"},zt={class:"flex items-center gap-3"},Ht={class:"flex gap-1"},jt={class:"text-xs text-gray-600"},Ft={key:0},Ut={key:1},Vt=W({__name:"HistoryFilters",setup(M){const e=F(),f=T(()=>e.historyDateRange),d=T(()=>e.sortBy),l=T(()=>e.sortOrder),v=T(()=>e.dateRangeOptions),c=i=>{const a=i.target.value,g=f.value.end,x=g?H.formatDateToISO(g):"";e.setHistoryDateRange({start:a,end:x})},w=i=>{const a=i.target.value,g=f.value.start,x=g?H.formatDateToISO(g):"";e.setHistoryDateRange({start:x,end:a})},k=i=>{e.setSort(i)},y=i=>{e.quickSetHistoryDateRange(i)},P=()=>{e.clearHistoryDateRange()},R=i=>{if(d.value===i){const s=l.value===C.SORT_ORDERS.ASC?C.SORT_ORDERS.DESC:C.SORT_ORDERS.ASC;k({sortBy:i,sortOrder:s})}else k({sortBy:i,sortOrder:C.SORT_ORDERS.DESC})},n=i=>d.value!==i?"mdi-sort":l.value===C.SORT_ORDERS.ASC?"mdi-sort-ascending":"mdi-sort-descending",u=i=>i?H.formatDateToISO(i):"",o=i=>i?H.formatDateShort(i):"";return(i,s)=>(p(),h("div",Dt,[t("div",Ot,[t("div",Et,[s[6]||(s[6]=t("span",{class:"font-bold text-gray-700 text-sm"},"时间范围:",-1)),t("div",It,[t("input",{type:"date",value:u(f.value.start),min:v.value.firstDate,max:v.value.lastDate,class:"px-2 py-1 border border-gray-300 rounded-md text-xs",placeholder:"开始日期",onChange:c},null,40,Lt),s[5]||(s[5]=t("span",{class:"text-gray-500 text-xs"},"至",-1)),t("input",{type:"date",value:u(f.value.end),min:v.value.firstDate,max:v.value.lastDate,class:"px-2 py-1 border border-gray-300 rounded-md text-xs",placeholder:"结束日期",onChange:w},null,40,At)])]),t("div",Bt,[t("button",{onClick:s[0]||(s[0]=a=>y("today")),class:"px-2 py-1 bg-blue-500 text-white rounded-md text-xs hover:bg-blue-600 transition"}," 今日 "),t("button",{onClick:s[1]||(s[1]=a=>y("week")),class:"px-2 py-1 bg-green-500 text-white rounded-md text-xs hover:bg-green-600 transition"}," 本周 "),t("button",{onClick:s[2]||(s[2]=a=>y("all")),class:"px-2 py-1 bg-gray-500 text-white rounded-md text-xs hover:bg-gray-600 transition"}," 全部 "),t("button",{onClick:P,class:"px-2 py-1 bg-red-500 text-white rounded-md text-xs hover:bg-red-600 transition"}," 清空 ")])]),t("div",Nt,[t("div",zt,[s[9]||(s[9]=t("span",{class:"font-bold text-gray-700 text-sm"},"排序:",-1)),t("div",Ht,[t("button",{onClick:s[3]||(s[3]=a=>R(r(C).SORT_OPTIONS.TIME)),class:b(["px-2 py-1 text-xs rounded-md transition",d.value===r(C).SORT_OPTIONS.TIME?"bg-indigo-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"])},[s[7]||(s[7]=$(" 时间 ",-1)),t("span",{class:b(["mdi ml-1",n(r(C).SORT_OPTIONS.TIME)])},null,2)],2),t("button",{onClick:s[4]||(s[4]=a=>R(r(C).SORT_OPTIONS.SCORE)),class:b(["px-2 py-1 text-xs rounded-md transition",d.value===r(C).SORT_OPTIONS.SCORE?"bg-indigo-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"])},[s[8]||(s[8]=$(" 分数 ",-1)),t("span",{class:b(["mdi ml-1",n(r(C).SORT_OPTIONS.SCORE)])},null,2)],2)])]),t("div",jt,[f.value.start||f.value.end?(p(),h("span",Ft," 当前选择: "+m(o(f.value.start)||"开始")+" 至 "+m(o(f.value.end)||"结束"),1)):(p(),h("span",Ut," 显示全部数据 "))])])]))}}),Gt={key:0,class:"flex-1 overflow-auto"},Yt={class:"space-y-3"},qt={class:"flex justify-between items-start"},Jt={class:"flex-1"},Kt={class:"flex items-center gap-2 mb-2"},Qt={class:"font-bold text-lg text-indigo-700"},Xt={class:"text-sm text-gray-400"},Zt={class:"text-sm text-gray-500 mb-2"},te={key:0,class:"text-sm text-gray-600 mb-2"},ee={class:"flex flex-wrap gap-1 mt-1"},se={key:1,class:"text-sm text-gray-600"},oe={class:"ml-1"},ne={class:"flex flex-col items-end ml-4 min-w-[80px]"},re={class:"text-xs text-gray-500 mb-2 text-right"},ie={key:1,class:"flex-1 flex items-center justify-center"},ae={class:"text-center text-gray-500"},le={class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-3 mx-auto"},de={class:"text-lg"},ce={class:"text-sm mt-2"},ue=W({__name:"WordHistoryList",setup(M){const e=F(),f=T(()=>e.filteredHistory),d=e.formatDate,l=T(()=>e.historyDateRange.start||e.historyDateRange.end?"mdi-calendar-search":"mdi-history"),v=T(()=>e.historyDateRange.start||e.historyDateRange.end?"该时间段内暂无练习记录":"暂无练习记录"),c=T(()=>e.historyDateRange.start||e.historyDateRange.end?"尝试调整时间范围或开始练习这个单词":"开始练习这个单词吧！");return(w,k)=>f.value.length>0?(p(),h("div",Gt,[t("div",Yt,[(p(!0),h(B,null,N(f.value,(y,P)=>(p(),h("div",{key:P,class:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition"},[t("div",qt,[t("div",Jt,[t("div",Kt,[t("div",Qt,m(y.userInput),1),t("div",Xt," #"+m(f.value.length-P),1)]),t("div",Zt,[k[0]||(k[0]=t("span",{class:"mdi mdi-clock-outline mr-1"},null,-1)),$(" "+m(r(d)(y.timestamp)),1)]),y.feedback&&y.feedback.length>0?(p(),h("div",te,[k[1]||(k[1]=t("span",{class:"font-medium text-gray-700"},"反馈:",-1)),t("div",ee,[(p(!0),h(B,null,N(y.feedback,(R,n)=>(p(),h("span",{key:n,class:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs"},m(R),1))),128))])])):S("",!0),y.targetWord?(p(),h("div",se,[k[2]||(k[2]=t("span",{class:"font-medium text-gray-700"},"目标单词:",-1)),t("span",oe,m(y.targetWord),1)])):S("",!0)]),t("div",ne,[t("div",{class:b(["text-3xl font-bold mb-1 text-right",r(K)(y.score)])},m(y.score)+"% ",3),t("div",re,m(r(Y)(y.score)),1),t("div",{class:b(["w-12 h-12 rounded-full flex items-center justify-center ml-auto",r(ot)(y.score)])},[t("span",{class:b(["mdi text-xl text-white",r(nt)(y.score)])},null,2)],2)])])]))),128))])])):(p(),h("div",ie,[t("div",ae,[t("div",le,[t("span",{class:b(["mdi text-2xl text-gray-400",l.value])},null,2)]),t("div",de,m(v.value),1),t("div",ce,m(c.value),1)])]))}}),ge={class:"flex-shrink-0"},he={class:"flex justify-between items-center mb-4"},pe={class:"flex items-center gap-3"},me={class:"text-2xl font-bold text-indigo-700"},fe={class:"flex gap-4 text-sm text-gray-600 mt-1"},ve={class:"text-indigo-600"},ye={class:"text-indigo-600"},we={class:"text-green-600"},xe={class:"flex-1 overflow-hidden flex flex-col"},be={class:"flex-shrink-0 pt-4 border-t border-gray-200"},ke={class:"flex justify-between items-center"},Re={class:"flex items-center gap-4"},Se={class:"text-sm text-gray-600"},_e=W({__name:"HistoryModal",setup(M){const e=F(),f=T(()=>e.currentWord?e.getPracticeCount({original:e.currentWord},e.currentStudyType):0),d=T(()=>e.currentWord?e.getAverageScore({original:e.currentWord},e.currentStudyType):0),l=T(()=>e.currentWord?e.getBestScoreForWord({original:e.currentWord},e.currentStudyType):0);return(v,c)=>r(e).showWordHistoryModal?(p(),h("div",{key:0,class:"pronunciation-modal",onClick:c[3]||(c[3]=w=>r(e).closeWordHistoryModal())},[t("div",{class:"modal-content w-[80vw] h-[70vh] max-w-4xl flex flex-col",onClick:c[2]||(c[2]=U(()=>{},["stop"]))},[t("div",ge,[t("div",he,[t("div",pe,[c[7]||(c[7]=t("div",{class:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center"},[t("span",{class:"mdi mdi-history text-indigo-600 text-xl"})],-1)),t("div",null,[t("h3",me,m(r(e).currentWord)+" 的练习历史 ",1),t("div",fe,[t("span",null,[c[4]||(c[4]=$("练习次数: ",-1)),t("strong",ve,m(f.value),1)]),t("span",null,[c[5]||(c[5]=$("平均分数: ",-1)),t("strong",ye,m(d.value)+"%",1)]),t("span",null,[c[6]||(c[6]=$("最高分数: ",-1)),t("strong",we,m(l.value)+"%",1)])])])]),t("button",{onClick:c[0]||(c[0]=w=>r(e).closeWordHistoryModal()),class:"text-black hover:text-gray-600 p-1 transition"},c[8]||(c[8]=[t("span",{class:"mdi mdi-close text-xl"},null,-1)]))]),A(Vt)]),t("div",xe,[A(ue)]),t("div",be,[t("div",ke,[t("div",Re,[t("div",Se," 共 "+m(r(e).filteredHistory.length)+" 条练习记录 ",1)]),t("button",{onClick:c[1]||(c[1]=w=>r(e).closeWordHistoryModal()),class:"bg-indigo-500 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 transition"}," 关闭 ")])])])])):S("",!0)}}),Ms=L(_e,[["__scopeId","data-v-dd568ab9"]]),Ce={class:"pronunciation-checker"},$e={key:0,class:"recording-interface"},Pe={class:"text-white text-lg mt-4"},Te=W({__name:"PronunciationChecker",setup(M){const e=z();class f{recognition=null;isRecording=!1;targetWord="";onResult=null;onError=null;onEnd=null;retryCount=0;maxRetries=2;hasValidResult=!1;initSpeechRecognition(){if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const o=window.SpeechRecognition||window.webkitSpeechRecognition;this.recognition=new o,this.recognition.continuous=!0,this.recognition.interimResults=!0,this.recognition.lang="en-US",this.recognition.maxAlternatives=5,this.recognition.serviceURI&&(this.recognition.grammars=null);try{"webkitSpeechRecognition"in window&&(this.recognition.webkitSpeechRecognition=!0)}catch{}this.recognition.serviceURI&&(this.recognition.grammars=null),this.recognition.onresult=i=>{const s=i.results[i.results.length-1],a=.3;if(s.isFinal||s[0]&&s[0].confidence>a){let g="",x=0;for(let D=0;D<Math.min(s.length,5);D++){const O=s[D],E=O.confidence||0;E>x&&(x=E,g=O.transcript)}!g&&s.length>0&&(g=s[0].transcript,x=s[0].confidence||.7);const _=g.toLowerCase().trim();(s.isFinal||x>=a)&&_&&this.onResult&&(this.hasValidResult=!0,this.onResult(_))}},this.recognition.onerror=i=>{this.isRecording=!1;let s="",a=!1;switch(i.error){case"network":s="网络连接问题，请检查网络后重试",a=!0;break;case"not-allowed":s="请允许麦克风权限后重试";break;case"no-speech":this.retryCount<this.maxRetries?(a=!0,s="正在重新尝试检测语音..."):s="未检测到语音内容，请确保麦克风正常工作并靠近说话";break;case"aborted":this.retryCount<this.maxRetries?(a=!0,s="语音识别被中断，正在重试..."):s="语音识别多次中断，请检查麦克风设置";break;case"audio-capture":s="麦克风无法访问，请检查设备连接";break;case"service-not-allowed":s="语音识别服务不可用，请稍后重试";break;default:s=`语音识别出错: ${i.error}`}if(a&&this.retryCount<this.maxRetries){this.retryCount++;const g=i.error==="network"?2e3:1e3;setTimeout(()=>{this.recognition&&!this.isRecording&&(this.hasValidResult=!1,this.startRecording(this.targetWord,!0))},g);return}this.onError&&this.onError(s)},this.recognition.onstart=()=>{this.isRecording=!0},this.recognition.onend=()=>{this.isRecording=!1,setTimeout(()=>{this.onEnd&&!this.hasValidResult&&this.retryCount>=this.maxRetries&&this.onEnd()},20)}}else throw new Error("浏览器不支持语音识别")}startRecording(o,i=!1){i||(this.retryCount=0),this.recognition||this.initSpeechRecognition(),this.targetWord=o,this.isRecording=!0,this.hasValidResult=!1;try{this.recognition.start()}catch(s){if(this.isRecording=!1,s.toString().includes("network")&&this.retryCount<this.maxRetries){this.retryCount++,setTimeout(()=>{this.startRecording(o,!0)},2e3);return}this.onError&&this.onError("启动语音识别失败")}}stopRecording(){this.recognition&&this.isRecording&&(this.recognition.stop(),this.isRecording=!1)}}class d{phonemeCache=new Map;soundCache=new Map;similarSoundsMap=new Map([["b",["p"]],["p",["b"]],["d",["t"]],["t",["d"]],["g",["k"]],["k",["g","c"]],["c",["k","s"]],["s",["z","c"]],["z",["s"]],["f",["v"]],["v",["f"]],["th",["s","z","d","t"]],["m",["n"]],["n",["m"]]]);evaluateSimilarity(o,i){const s=o.toLowerCase().trim(),a=i.toLowerCase().trim();if(s===a)return{score:100,feedback:["完美发音！继续保持！"]};const g=this.fuzzyMatch(s,a);if(g.isMatch)return{score:g.score,feedback:["发音很好！",...g.feedback]};const x=this.levenshteinDistance(s,a),_=Math.max(s.length,a.length),D=(_-x)/_*100,O=this.comparePhonemes(s,a),E=this.comparePronunciation(s,a),Z=this.calculateLengthSimilarity(s,a),tt=Math.round(D*.4+O*.3+E*.2+Z*.1);return{score:Math.max(0,Math.min(100,tt)),feedback:this.generateFeedback(s,a,x)}}levenshteinDistance(o,i){const s=[];for(let a=0;a<=i.length;a++)s[a]=[a];for(let a=0;a<=o.length;a++)s[0][a]=a;for(let a=1;a<=i.length;a++)for(let g=1;g<=o.length;g++)i.charAt(a-1)===o.charAt(g-1)?s[a][g]=s[a-1][g-1]:s[a][g]=Math.min(s[a-1][g-1]+1,s[a][g-1]+1,s[a-1][g]+1);return s[i.length][o.length]}comparePhonemes(o,i){const s=this.extractPhonemes(o),a=this.extractPhonemes(i);let g=0;const x=Math.max(s.length,a.length),_=Math.min(s.length,a.length);for(let E=0;E<_;E++)s[E]===a[E]&&g++;const D=Math.abs(s.length-a.length)*.1,O=g/x*100;return Math.max(0,O-D)}fuzzyMatch(o,i){const s={c:["k","s"],k:["c"],s:["c","z"],z:["s"],f:["ph","v"],v:["f"],th:["s","z","d","t"],ph:["f"],ck:["k","c"],x:["ks","z"],qu:["kw","k"]};let a=o,g=i;for(const[_,D]of Object.entries(s))if(a.includes(_)){for(const O of D)if(g.includes(O)){g=g.split(O).join(_);break}}if(a===g)return{isMatch:!0,score:95,feedback:["发音基本正确，存在轻微的语音识别差异"]};const x=this.calculateStringSimilarity(a,g);return x>.85?{isMatch:!0,score:Math.round(x*90),feedback:["发音很接近目标，继续保持！"]}:{isMatch:!1,score:0,feedback:[]}}extractPhonemes(o){if(this.phonemeCache.has(o))return this.phonemeCache.get(o);const i=new Set(["a","e","i","o","u","y"]),s=o.split("").map(a=>i.has(a)?"V":"C");return this.phonemeCache.set(o,s),s}comparePronunciation(o,i){const s=this.extractSounds(o),a=this.extractSounds(i);let g=0;const x=Math.max(s.length,a.length);for(let _=0;_<Math.min(s.length,a.length);_++)this.soundsAreSimilar(s[_],a[_])&&g++;return g/x*100}extractSounds(o){if(this.soundCache.has(o))return this.soundCache.get(o);const i=[],s=new Set(["th","ch","sh","ph","wh","ck","ng"]);let a=0;for(;a<o.length;){if(a<o.length-1){const g=o.substring(a,a+2);if(s.has(g)){i.push(g),a+=2;continue}}i.push(o[a]),a++}return this.soundCache.set(o,i),i}soundsAreSimilar(o,i){return o===i?!0:this.similarSoundsMap.get(o)?.includes(i)||!1}calculateLengthSimilarity(o,i){const s=Math.abs(o.length-i.length),a=Math.max(o.length,i.length);return a===0?100:Math.max(0,(1-s/a)*100)}calculateStringSimilarity(o,i){const s=o.length>i.length?o:i,a=o.length>i.length?i:o;if(s.length===0)return 1;const g=this.levenshteinDistance(s,a);return(s.length-g)/s.length}generateFeedback(o,i,s){const a=[];s===0?a.push("发音完全正确！"):s<=2?a.push("发音很接近，继续练习！"):s<=4?a.push("发音基本正确，注意细节"):a.push("发音需要改进，建议多听标准发音"),o.length!==i.length&&a.push(`单词长度不匹配：目标${o.length}个字母，您说了${i.length}个字母`);const g=this.analyzeCommonErrors(o,i);return a.push(...g),a}analyzeCommonErrors(o,i){const s=[],a={th:'注意"th"的发音，舌尖要放在上下齿之间',ch:'注意"ch"的发音，类似中文的"吃"',sh:'注意"sh"的发音，类似中文的"诗"',ph:'注意"ph"发"f"音',wh:'注意"wh"的发音，要吹气'};for(const[g,x]of Object.entries(a))o.includes(g)&&!i.includes(g)&&s.push(x);return s}}const l=I(null),v=I(null),c=I(null),w=I(!1),k=()=>{l.value=new f,v.value=new d,l.value.onResult=u=>{y(u)},l.value.onError=u=>{P()},l.value.onEnd=()=>{e.isRecording&&!w.value&&(w.value=!0,e.setPronunciationResult({targetWord:e.currentRecordingWord,userInput:"",score:0,feedback:["未检测到语音内容，请重新尝试"]},!0))}},y=u=>{const o=e.currentRecordingWord;if(w.value||(w.value=!0,c.value&&(clearTimeout(c.value),c.value=null),!v.value||!o))return;const i=v.value.evaluateSimilarity(o,u);e.isRecording=!1,e.setPronunciationResult({targetWord:o,userInput:u,score:i.score,feedback:i.feedback},!0)},P=()=>{c.value&&(clearTimeout(c.value),c.value=null),e.stopPronunciationCheck()},R=async u=>{try{w.value=!1,l.value||k(),c.value=setTimeout(()=>{e.isRecording&&P()},3e4),l.value?.startRecording(u)}catch{P()}},n=()=>{c.value&&(clearTimeout(c.value),c.value=null),l.value?.stopRecording()};return it(()=>{k(),j(()=>e.isRecording,u=>{u&&e.currentRecordingWord?R(e.currentRecordingWord):u||n()},{immediate:!0})}),X(()=>{n()}),(u,o)=>(p(),h("div",Ce,[r(e).isRecording?(p(),h("div",$e,[o[1]||(o[1]=t("div",{class:"recording-animation"},[t("div",{class:"pulse-circle"}),t("span",{class:"mdi mdi-microphone text-4xl text-white"})],-1)),t("p",Pe,[o[0]||(o[0]=$(" 请朗读: ",-1)),t("strong",null,m(r(e).currentRecordingWord),1)]),o[2]||(o[2]=t("p",{class:"text-white/80 text-sm mt-2"},"正在录音中...",-1))])):S("",!0)]))}}),Me=L(Te,[["__scopeId","data-v-61733317"]]),We={class:"modal-header"},De={class:"result-content"},Oe={key:0,class:"error-message"},Ee={class:"error-content"},Ie={class:"error-text"},Le={key:1,class:"result-display"},Ae={class:"score-display"},Be={class:"word-comparison"},Ne={class:"word-item"},ze={class:"word-value target"},He={class:"word-item"},je={class:"word-value user"},Fe={class:"result-actions"},Ue={key:2},Ve={class:"word-comparison"},Ge={class:"comparison-item"},Ye={class:"target-word"},qe={class:"comparison-item"},Je={class:"user-input"},Ke={class:"recording-section"},Qe={class:"recording-controls"},Xe=["disabled"],Ze={class:"recording-info"},ts={key:0,class:"recording-status"},es={key:0,class:"retry-indicator"},ss={key:1,class:"recording-indicator"},os={key:2,class:"recording-timer"},ns={class:"recording-hint"},rs={key:3,class:"recording-tip"},is={key:1,class:"ready-status"},as={class:"target-word-display"},ls={class:"modal-actions"},ds=W({__name:"PronunciationModal",setup(M){const e=z(),f=I(0),d=I(!1),l=I(""),v=I("");let c=null;const w=()=>{e.isRecording?e.stopPronunciationCheck():e.isRecording=!0},k=()=>{e.stopPronunciationCheck()},y=()=>{v.value="",e.startPronunciationCheck(e.currentRecordingWord,!0)},P=()=>{v.value="",e.closePronunciationModal()};return j(()=>e.isRecording,R=>{R?(f.value=0,c=setInterval(()=>{f.value++},1e3)):(c&&(clearInterval(c),c=null),f.value=0)}),j(()=>e.pronunciationResult,R=>{R&&R.error&&(v.value=R.error)},{immediate:!0}),j(()=>f.value,R=>{R>=30&&(v.value="录音时间过长，请重新尝试",e.stopPronunciationCheck())}),X(()=>{c&&(clearInterval(c),c=null)}),(R,n)=>r(e).showPronunciationModal?(p(),h("div",{key:0,class:"pronunciation-modal",onClick:n[5]||(n[5]=(...u)=>r(e).closePronunciationModal&&r(e).closePronunciationModal(...u))},[t("div",{class:"modal-content",onClick:n[4]||(n[4]=U(()=>{},["stop"]))},[t("div",We,[n[7]||(n[7]=t("h3",{class:"modal-title"},"发音练习",-1)),t("button",{onClick:n[0]||(n[0]=(...u)=>r(e).closePronunciationModal&&r(e).closePronunciationModal(...u)),class:"close-btn"},n[6]||(n[6]=[t("span",{class:"mdi mdi-close"},null,-1)]))]),t("div",De,[v.value?(p(),h("div",Oe,[t("div",Ee,[n[9]||(n[9]=t("div",{class:"error-icon"},[t("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 15.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),n[10]||(n[10]=t("h4",{class:"error-title"},"录音出现问题",-1)),t("p",Ie,m(v.value),1),t("div",{class:"error-actions"},[t("button",{onClick:y,class:"retry-btn"},n[8]||(n[8]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),$(" 重新尝试 ",-1)])),t("button",{onClick:P,class:"close-error-btn"},"关闭")])])])):r(e).showResultModal?(p(),h("div",Le,[n[15]||(n[15]=t("div",{class:"result-header"},[t("h4",{class:"result-title"},"发音评分")],-1)),t("div",Ae,[t("div",{class:b(["score-circle",r(Q)(r(e).result?.score||0)])},m(r(e).result?.score||0)+"% ",3),t("div",{class:b(["score-label",r(rt)(r(e).result?.score||0)])},m(r(Y)(r(e).result?.score||0)),3)]),t("div",Be,[t("div",Ne,[n[11]||(n[11]=t("span",{class:"word-label"},"目标单词",-1)),t("span",ze,m(r(e).result?.targetWord),1)]),t("div",He,[n[12]||(n[12]=t("span",{class:"word-label"},"您的发音",-1)),t("span",je,m(r(e).result?.userInput),1)])]),t("div",Fe,[t("button",{onClick:n[1]||(n[1]=(...u)=>r(e).playTargetWord&&r(e).playTargetWord(...u)),class:"action-btn primary"},n[13]||(n[13]=[t("span",{class:"mdi mdi-volume-high"},null,-1),$(" 听标准发音 ",-1)])),t("button",{onClick:n[2]||(n[2]=(...u)=>r(e).retryPronunciation&&r(e).retryPronunciation(...u)),class:"action-btn success"},n[14]||(n[14]=[t("span",{class:"mdi mdi-refresh"},null,-1),$(" 重新练习 ",-1)]))])])):(p(),h("div",Ue,[t("div",Ve,[t("div",Ge,[n[16]||(n[16]=t("label",null,"目标单词:",-1)),t("span",Ye,m(r(e).currentRecordingWord),1)]),t("div",qe,[n[17]||(n[17]=t("label",null,"您的发音:",-1)),t("span",Je,m(r(e).isRecording?"正在录音...":"准备录音中..."),1)])]),t("div",Ke,[t("div",Qe,[t("button",{onClick:w,class:b(["record-btn",{recording:r(e).isRecording}]),disabled:!r(e).currentRecordingWord},[t("span",{class:b(["mdi",r(e).isRecording?"mdi-stop":"mdi-microphone"])},null,2)],10,Xe),t("div",Ze,[r(e).isRecording||d.value?(p(),h("div",ts,[d.value?(p(),h("div",es,[n[18]||(n[18]=t("div",{class:"retry-spinner"},null,-1)),t("span",null,m(l.value),1)])):(p(),h("div",ss,n[19]||(n[19]=[t("div",{class:"recording-dot"},null,-1),t("span",null,"正在录音...",-1)]))),d.value?S("",!0):(p(),h("div",os," 录音时长: "+m(f.value)+"s / 30s ",1)),t("div",ns,[n[20]||(n[20]=$(" 请朗读: ",-1)),t("strong",null,m(r(e).currentRecordingWord),1)]),d.value?S("",!0):(p(),h("div",rs,[n[21]||(n[21]=$(" 点击麦克风按钮可停止录音 ",-1)),t("button",{onClick:k,class:"manual-stop-btn"}," 手动停止 ")]))])):(p(),h("div",is,[n[23]||(n[23]=t("div",null,"准备录音中...",-1)),t("div",as,[n[22]||(n[22]=$(" 目标单词: ",-1)),t("strong",null,m(r(e).currentRecordingWord),1)])]))])])]),A(Me)]))]),t("div",ls,[t("button",{onClick:n[3]||(n[3]=(...u)=>r(e).closePronunciationModal&&r(e).closePronunciationModal(...u)),class:"action-btn secondary"}," 关闭 ")])])])):S("",!0)}}),Ws=L(ds,[["__scopeId","data-v-4e88b049"]]),cs={class:"result-content space-y-4"},us={key:0,class:"error-alert"},gs={class:"flex items-center justify-center gap-2 text-red-600 mb-4"},hs={class:"font-medium"},ps={class:"text-center"},ms={class:"text-lg mb-2"},fs={class:"text-indigo-700 font-bold"},vs={class:"text-lg mb-4"},ys={class:"text-green-600 font-bold"},ws={class:"score-section text-center"},xs={class:"feedback bg-gray-50 p-4 rounded-lg"},bs={key:0},ks={class:"mt-2 space-y-1"},Rs={class:"modal-actions flex gap-3 justify-center mt-6"},Ss=W({__name:"PronunciationResultModal",setup(M){const e=z();return(f,d)=>r(e).showResultModal?(p(),h("div",{key:0,class:"pronunciation-modal",onClick:d[4]||(d[4]=(...l)=>r(e).closeResultModal&&r(e).closeResultModal(...l))},[t("div",{class:"modal-content",onClick:d[3]||(d[3]=U(()=>{},["stop"]))},[d[10]||(d[10]=t("h3",{class:"text-2xl font-bold text-center mb-6 text-indigo-700"}," 发音练习结果 ",-1)),t("div",cs,[r(e).result?.error?(p(),h("div",us,[t("div",gs,[d[5]||(d[5]=t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 15.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),t("span",hs,m(r(e).result.error),1)])])):S("",!0),t("div",ps,[t("div",ms,[d[6]||(d[6]=t("strong",null,"目标单词:",-1)),t("span",fs,m(r(e).result?.targetWord),1)]),t("div",vs,[d[7]||(d[7]=t("strong",null,"您的发音:",-1)),t("span",ys,m(r(e).result?.userInput||"未检测到"),1)])]),t("div",ws,[t("div",{class:b(["score-circle",r(Q)(r(e).result?.score||0)])},m(r(e).result?.score||0)+"% ",3),t("div",{class:b(["text-xl font-bold mt-2",r(K)(r(e).result?.score||0)])},m(r(Y)(r(e).result?.score||0)),3)]),t("div",xs,[r(e).result?.feedback&&r(e).result.feedback.length>0?(p(),h("div",bs,[d[9]||(d[9]=t("strong",{class:"text-gray-700"},"改进建议:",-1)),t("ul",ks,[(p(!0),h(B,null,N(r(e).result.feedback,(l,v)=>(p(),h("li",{key:v,class:"text-gray-600 text-sm flex items-start"},[d[8]||(d[8]=t("span",{class:"mdi mdi-lightbulb text-yellow-500 mr-2 mt-0.5"},null,-1)),$(" "+m(l),1)]))),128))])])):S("",!0)])]),t("div",Rs,[t("button",{onClick:d[0]||(d[0]=(...l)=>r(e).playTargetWord&&r(e).playTargetWord(...l)),class:"bg-indigo-500 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 transition"}," 听标准发音 "),t("button",{onClick:d[1]||(d[1]=(...l)=>r(e).retryPronunciation&&r(e).retryPronunciation(...l)),class:"bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition"}," 重新练习 "),t("button",{onClick:d[2]||(d[2]=(...l)=>r(e).closeResultModal&&r(e).closeResultModal(...l)),class:"bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400 transition"}," 关闭 ")])])])):S("",!0)}}),Ds=L(Ss,[["__scopeId","data-v-5bb1820c"]]);export{Ms as H,Ws as P,Ps as W,Ts as _,Ds as a};
