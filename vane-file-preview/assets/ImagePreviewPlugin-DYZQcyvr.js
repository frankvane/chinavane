import{j as r,r as I,R as D}from"./index-yyTIZa1r.js";import{T as y,F as z,a as k,b as R}from"./ToolbarComponents-BZEdwMd_.js";const C=({context:s})=>{const{file:S,state:j}=s,[m,g]=I.useState(1),[e,i]=I.useState(0);return D.useEffect(()=>{var w,b,v;const n=f=>{g(f.scale)},l=f=>{i(f.angle)},d=()=>{g(1),i(0)},c=(w=s.bus)==null?void 0:w.on("zoom",n),u=(b=s.bus)==null?void 0:b.on("rotate",l),h=(v=s.bus)==null?void 0:v.on("reset",d);return()=>{c==null||c(),u==null||u(),h==null||h()}},[s.bus]),D.useEffect(()=>{var d,c;const n=(d=s.sharedData)==null?void 0:d.get("imageScale"),l=(c=s.sharedData)==null?void 0:c.get("imageRotation");n!==void 0&&n!==m&&g(n),l!==void 0&&l!==e&&i(l)},[s.sharedData,m,e]),D.useEffect(()=>{var n;(n=s.sharedData)==null||n.set("imageScale",m)},[m,s.sharedData]),D.useEffect(()=>{var n;(n=s.sharedData)==null||n.set("imageRotation",e)},[e,s.sharedData]),j.state!=="loaded"&&j.state!=="loading"?null:r.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#f5f5f5",overflow:"hidden"},children:r.jsx("img",{src:S.url,alt:S.name,style:{maxWidth:"100%",maxHeight:"100%",transform:`scale(${m}) rotate(${e}deg)`,transition:"transform 0.2s ease",cursor:"zoom-in"},onLoad:()=>{},onError:n=>{console.error("[ImagePreviewPlugin] Image load error:",n)}})})};function Z(s={}){const{enableZoom:S=!0,enableRotate:j=!0,maxZoom:m=5,minZoom:g=.1}=s;return{name:"ImagePreviewPlugin",version:"1.0.0",description:"Image preview with zoom and rotate controls",supportedTypes:["image/*"],supportedExtensions:[".jpg",".jpeg",".png",".gif",".webp",".svg",".bmp",".ico"],config:s,hooks:{getPriority:()=>10,render:e=>r.jsx(C,{context:e}),renderToolbar:e=>{const i=()=>{var a;return((a=e.sharedData)==null?void 0:a.get("imageScale"))||1},n=()=>{var a;return((a=e.sharedData)==null?void 0:a.get("imageRotation"))||0},l=a=>{var t,o,p;(t=e.sharedData)==null||t.set("imageScale",a),(o=e.bus)==null||o.emit("zoom",{scale:a}),(p=e.bus)==null||p.emit("sharedDataChanged",{key:"imageScale",value:a})},d=a=>{var t,o,p;(t=e.sharedData)==null||t.set("imageRotation",a),(o=e.bus)==null||o.emit("rotate",{angle:a}),(p=e.bus)==null||p.emit("sharedDataChanged",{key:"imageRotation",value:a})},c=()=>{var o;const a=i(),t=Math.min(a+.2,m);l(t),(o=e.bus)==null||o.emit("zoom",{scale:t})},u=()=>{var o;const a=i(),t=Math.max(a-.2,g);l(t),(o=e.bus)==null||o.emit("zoom",{scale:t})},h=()=>{var o;const t=(n()+90)%360;d(t),(o=e.bus)==null||o.emit("rotate",{angle:t})},w=()=>{var a,t,o;l(1),d(0),(a=e.bus)==null||a.emit("reset",{}),(t=e.bus)==null||t.emit("zoom",{scale:1}),(o=e.bus)==null||o.emit("rotate",{angle:0})},b=i(),v=()=>{const a=document.createElement("a");a.href=e.file.url,a.download=e.file.name,a.click()},f=n();return r.jsxs(y,{children:[r.jsx(z,{name:e.file.name,size:e.file.size,type:"Image",icon:"🖼️"}),r.jsx(k,{}),r.jsxs("span",{style:{fontSize:12,color:"#656d76",fontWeight:500,width:"50px"},children:[Math.round(b*100),"%"]}),S&&r.jsxs(r.Fragment,{children:[r.jsx(R,{onClick:u,icon:"🔍",title:"Zoom Out",variant:"icon",children:"-"}),r.jsx(R,{onClick:c,icon:"🔍",title:"Zoom In",variant:"icon",children:"+"})]}),j&&r.jsx(R,{onClick:h,icon:"🔄",title:`Rotate (${f}°)`,variant:"icon",children:"Rotate"}),r.jsx(R,{onClick:w,icon:"↺",title:"Reset View",variant:"icon",children:"Reset"}),r.jsx(k,{}),r.jsx(R,{onClick:v,icon:"📥",title:"Download Image",children:"Download"})]})},onLoadStart:e=>{},onLoadSuccess:e=>{},onLoadError:(e,i)=>(console.error(`[ImagePreviewPlugin] Image load failed: ${e.file.name}`,i),!1)}}}export{Z as c};
