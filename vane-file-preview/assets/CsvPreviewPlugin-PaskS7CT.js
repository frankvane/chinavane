import{g as be,c as we,j as l,r as B}from"./index-HctDrVfM.js";import{T as ke,F as Se,a as Ee,b as Ce}from"./ToolbarComponents-CDtc1__A.js";var ve={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/(function(ce,G){((K,k)=>{ce.exports=k()})(we,function K(){var k=typeof self<"u"?self:typeof window<"u"?window:k!==void 0?k:{},$,Z=!k.document&&!!k.postMessage,re=k.IS_PAPA_WORKER||!1,ne={},P=0,h={};function q(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(t){var r=le(t);r.chunkSize=parseInt(r.chunkSize),t.step||t.chunk||(r.chunkSize=null),this._handle=new oe(r),(this._handle.streamer=this)._config=r}).call(this,e),this.parseChunk=function(t,r){var o=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<o){let g=this._config.newline;g||(s=this._config.quoteChar||'"',g=this._handle.guessLineEndings(t,s)),t=[...t.split(g).slice(o)].join(g)}this.isFirstChunk&&S(this._config.beforeFirstChunk)&&(s=this._config.beforeFirstChunk(t))!==void 0&&(t=s),this.isFirstChunk=!1,this._halted=!1;var o=this._partialLine+t,s=(this._partialLine="",this._handle.parse(o,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(t=s.meta.cursor,o=(this._finished||(this._partialLine=o.substring(t-this._baseIndex),this._baseIndex=t),s&&s.data&&(this._rowCount+=s.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),re)k.postMessage({results:s,workerId:h.WORKER_ID,finished:o});else if(S(this._config.chunk)&&!r){if(this._config.chunk(s,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=s=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(s.data),this._completeResults.errors=this._completeResults.errors.concat(s.errors),this._completeResults.meta=s.meta),this._completed||!o||!S(this._config.complete)||s&&s.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),o||s&&s.meta.paused||this._nextChunk(),s}this._halted=!0},this._sendError=function(t){S(this._config.error)?this._config.error(t):re&&this._config.error&&k.postMessage({workerId:h.WORKER_ID,error:t,finished:!1})}}function ie(e){var t;(e=e||{}).chunkSize||(e.chunkSize=h.RemoteChunkSize),q.call(this,e),this._nextChunk=Z?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(r){this._input=r,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),Z||(t.onload=W(this._chunkLoaded,this),t.onerror=W(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!Z),this._config.downloadRequestHeaders){var r,o=this._config.downloadRequestHeaders;for(r in o)t.setRequestHeader(r,o[r])}var s;this._config.chunkSize&&(s=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+s));try{t.send(this._config.downloadRequestBody)}catch(g){this._chunkError(g.message)}Z&&t.status===0&&this._chunkError()}},this._chunkLoaded=function(){t.readyState===4&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(r=>(r=r.getResponseHeader("Content-Range"))!==null?parseInt(r.substring(r.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(r){r=t.statusText||r,this._sendError(new Error(r))}}function se(e){(e=e||{}).chunkSize||(e.chunkSize=h.LocalChunkSize),q.call(this,e);var t,r,o=typeof FileReader<"u";this.stream=function(s){this._input=s,r=s.slice||s.webkitSlice||s.mozSlice,o?((t=new FileReader).onload=W(this._chunkLoaded,this),t.onerror=W(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var s=this._input,g=(this._config.chunkSize&&(g=Math.min(this._start+this._config.chunkSize,this._input.size),s=r.call(s,this._start,g)),t.readAsText(s,this._config.encoding));o||this._chunkLoaded({target:{result:g}})},this._chunkLoaded=function(s){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(s.target.result)},this._chunkError=function(){this._sendError(t.error)}}function H(e){var t;q.call(this,e=e||{}),this.stream=function(r){return t=r,this._nextChunk()},this._nextChunk=function(){var r,o;if(!this._finished)return r=this._config.chunkSize,t=r?(o=t.substring(0,r),t.substring(r)):(o=t,""),this._finished=!t,this.parseChunk(o)}}function j(e){q.call(this,e=e||{});var t=[],r=!0,o=!1;this.pause=function(){q.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){q.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(s){this._input=s,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){o&&t.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):r=!0},this._streamData=W(function(s){try{t.push(typeof s=="string"?s:s.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(g){this._streamError(g)}},this),this._streamError=W(function(s){this._streamCleanUp(),this._sendError(s)},this),this._streamEnd=W(function(){this._streamCleanUp(),o=!0,this._streamData("")},this),this._streamCleanUp=W(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function oe(e){var t,r,o,s,g=Math.pow(2,53),I=-g,F=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,L=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,d=this,E=0,u=0,A=!1,i=!1,a=[],n={data:[],errors:[],meta:{}};function f(p){return e.skipEmptyLines==="greedy"?p.join("").trim()==="":p.length===1&&p[0].length===0}function v(){if(n&&o&&(T("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+h.DefaultDelimiter+"'"),o=!1),e.skipEmptyLines&&(n.data=n.data.filter(function(c){return!f(c)})),b()){let c=function(R,D){S(e.transformHeader)&&(R=e.transformHeader(R,D)),a.push(R)};if(n)if(Array.isArray(n.data[0])){for(var p=0;b()&&p<n.data.length;p++)n.data[p].forEach(c);n.data.splice(0,1)}else n.data.forEach(c)}function m(c,R){for(var D=e.header?{}:[],_=0;_<c.length;_++){var w=_,y=c[_],y=((N,x)=>(O=>(e.dynamicTypingFunction&&e.dynamicTyping[O]===void 0&&(e.dynamicTyping[O]=e.dynamicTypingFunction(O)),(e.dynamicTyping[O]||e.dynamicTyping)===!0))(N)?x==="true"||x==="TRUE"||x!=="false"&&x!=="FALSE"&&((O=>{if(F.test(O)&&(O=parseFloat(O),I<O&&O<g))return 1})(x)?parseFloat(x):L.test(x)?new Date(x):x===""?null:x):x)(w=e.header?_>=a.length?"__parsed_extra":a[_]:w,y=e.transform?e.transform(y,w):y);w==="__parsed_extra"?(D[w]=D[w]||[],D[w].push(y)):D[w]=y}return e.header&&(_>a.length?T("FieldMismatch","TooManyFields","Too many fields: expected "+a.length+" fields but parsed "+_,u+R):_<a.length&&T("FieldMismatch","TooFewFields","Too few fields: expected "+a.length+" fields but parsed "+_,u+R)),D}var C;n&&(e.header||e.dynamicTyping||e.transform)&&(C=1,!n.data.length||Array.isArray(n.data[0])?(n.data=n.data.map(m),C=n.data.length):n.data=m(n.data,0),e.header&&n.meta&&(n.meta.fields=a),u+=C)}function b(){return e.header&&a.length===0}function T(p,m,C,c){p={type:p,code:m,message:C},c!==void 0&&(p.row=c),n.errors.push(p)}S(e.step)&&(s=e.step,e.step=function(p){n=p,b()?v():(v(),n.data.length!==0&&(E+=p.data.length,e.preview&&E>e.preview?r.abort():(n.data=n.data[0],s(n,d))))}),this.parse=function(p,m,C){var c=e.quoteChar||'"',c=(e.newline||(e.newline=this.guessLineEndings(p,c)),o=!1,e.delimiter?S(e.delimiter)&&(e.delimiter=e.delimiter(p),n.meta.delimiter=e.delimiter):((c=((R,D,_,w,y)=>{var N,x,O,te;y=y||[",","	","|",";",h.RECORD_SEP,h.UNIT_SEP];for(var de=0;de<y.length;de++){for(var Q,fe=y[de],M=0,J=0,z=0,U=(O=void 0,new he({comments:w,delimiter:fe,newline:D,preview:10}).parse(R)),ee=0;ee<U.data.length;ee++)_&&f(U.data[ee])?z++:(Q=U.data[ee].length,J+=Q,O===void 0?O=Q:0<Q&&(M+=Math.abs(Q-O),O=Q));0<U.data.length&&(J/=U.data.length-z),(x===void 0||M<=x)&&(te===void 0||te<J)&&1.99<J&&(x=M,N=fe,te=J)}return{successful:!!(e.delimiter=N),bestDelimiter:N}})(p,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=c.bestDelimiter:(o=!0,e.delimiter=h.DefaultDelimiter),n.meta.delimiter=e.delimiter),le(e));return e.preview&&e.header&&c.preview++,t=p,r=new he(c),n=r.parse(t,m,C),v(),A?{meta:{paused:!0}}:n||{meta:{paused:!1}}},this.paused=function(){return A},this.pause=function(){A=!0,r.abort(),t=S(e.chunk)?"":t.substring(r.getCharIndex())},this.resume=function(){d.streamer._halted?(A=!1,d.streamer.parseChunk(t,!0)):setTimeout(d.resume,3)},this.aborted=function(){return i},this.abort=function(){i=!0,r.abort(),n.meta.aborted=!0,S(e.complete)&&e.complete(n),t=""},this.guessLineEndings=function(R,c){R=R.substring(0,1048576);var c=new RegExp(V(c)+"([^]*?)"+V(c),"gm"),C=(R=R.replace(c,"")).split("\r"),c=R.split(`
`),R=1<c.length&&c[0].length<C[0].length;if(C.length===1||R)return`
`;for(var D=0,_=0;_<C.length;_++)C[_][0]===`
`&&D++;return D>=C.length/2?`\r
`:"\r"}}function V(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function he(e){var t=(e=e||{}).delimiter,r=e.newline,o=e.comments,s=e.step,g=e.preview,I=e.fastMode,F=null,L=!1,d=e.quoteChar==null?'"':e.quoteChar,E=d;if(e.escapeChar!==void 0&&(E=e.escapeChar),(typeof t!="string"||-1<h.BAD_DELIMITERS.indexOf(t))&&(t=","),o===t)throw new Error("Comment character same as delimiter");o===!0?o="#":(typeof o!="string"||-1<h.BAD_DELIMITERS.indexOf(o))&&(o=!1),r!==`
`&&r!=="\r"&&r!==`\r
`&&(r=`
`);var u=0,A=!1;this.parse=function(i,a,n){if(typeof i!="string")throw new Error("Input must be a string");var f=i.length,v=t.length,b=r.length,T=o.length,p=S(s),m=[],C=[],c=[],R=u=0;if(!i)return M();if(I||I!==!1&&i.indexOf(d)===-1){for(var D=i.split(r),_=0;_<D.length;_++){if(c=D[_],u+=c.length,_!==D.length-1)u+=r.length;else if(n)return M();if(!o||c.substring(0,T)!==o){if(p){if(m=[],te(c.split(t)),J(),A)return M()}else te(c.split(t));if(g&&g<=_)return m=m.slice(0,g),M(!0)}}return M()}for(var w=i.indexOf(t,u),y=i.indexOf(r,u),N=new RegExp(V(E)+V(d),"g"),x=i.indexOf(d,u);;)if(i[u]===d)for(x=u,u++;;){if((x=i.indexOf(d,x+1))===-1)return n||C.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:m.length,index:u}),Q();if(x===f-1)return Q(i.substring(u,x).replace(N,d));if(d===E&&i[x+1]===E)x++;else if(d===E||x===0||i[x-1]!==E){w!==-1&&w<x+1&&(w=i.indexOf(t,x+1));var O=de((y=y!==-1&&y<x+1?i.indexOf(r,x+1):y)===-1?w:Math.min(w,y));if(i.substr(x+1+O,v)===t){c.push(i.substring(u,x).replace(N,d)),i[u=x+1+O+v]!==d&&(x=i.indexOf(d,u)),w=i.indexOf(t,u),y=i.indexOf(r,u);break}if(O=de(y),i.substring(x+1+O,x+1+O+b)===r){if(c.push(i.substring(u,x).replace(N,d)),fe(x+1+O+b),w=i.indexOf(t,u),x=i.indexOf(d,u),p&&(J(),A))return M();if(g&&m.length>=g)return M(!0);break}C.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:m.length,index:u}),x++}}else if(o&&c.length===0&&i.substring(u,u+T)===o){if(y===-1)return M();u=y+b,y=i.indexOf(r,u),w=i.indexOf(t,u)}else if(w!==-1&&(w<y||y===-1))c.push(i.substring(u,w)),u=w+v,w=i.indexOf(t,u);else{if(y===-1)break;if(c.push(i.substring(u,y)),fe(y+b),p&&(J(),A))return M();if(g&&m.length>=g)return M(!0)}return Q();function te(z){m.push(z),R=u}function de(z){var U=0;return U=z!==-1&&(z=i.substring(x+1,z))&&z.trim()===""?z.length:U}function Q(z){return n||(z===void 0&&(z=i.substring(u)),c.push(z),u=f,te(c),p&&J()),M()}function fe(z){u=z,te(c),c=[],y=i.indexOf(r,u)}function M(z){if(e.header&&!a&&m.length&&!L){var U=m[0],ee=Object.create(null),xe=new Set(U);let me=!1;for(let ue=0;ue<U.length;ue++){let X=U[ue];if(ee[X=S(e.transformHeader)?e.transformHeader(X,ue):X]){let pe,_e=ee[X];for(;pe=X+"_"+_e,_e++,xe.has(pe););xe.add(pe),U[ue]=pe,ee[X]++,me=!0,(F=F===null?{}:F)[pe]=X}else ee[X]=1,U[ue]=X;xe.add(X)}me&&console.warn("Duplicate headers found and renamed."),L=!0}return{data:m,errors:C,meta:{delimiter:t,linebreak:r,aborted:A,truncated:!!z,cursor:R+(a||0),renamedHeaders:F}}}function J(){s(M()),m=[],C=[]}},this.abort=function(){A=!0},this.getCharIndex=function(){return u}}function Y(e){var t=e.data,r=ne[t.workerId],o=!1;if(t.error)r.userError(t.error,t.file);else if(t.results&&t.results.data){var s={abort:function(){o=!0,ge(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:ae,resume:ae};if(S(r.userStep)){for(var g=0;g<t.results.data.length&&(r.userStep({data:t.results.data[g],errors:t.results.errors,meta:t.results.meta},s),!o);g++);delete t.results}else S(r.userChunk)&&(r.userChunk(t.results,s,t.file),delete t.results)}t.finished&&!o&&ge(t.workerId,t.results)}function ge(e,t){var r=ne[e];S(r.userComplete)&&r.userComplete(t),r.terminate(),delete ne[e]}function ae(){throw new Error("Not implemented.")}function le(e){if(typeof e!="object"||e===null)return e;var t,r=Array.isArray(e)?[]:{};for(t in e)r[t]=le(e[t]);return r}function W(e,t){return function(){e.apply(t,arguments)}}function S(e){return typeof e=="function"}return h.parse=function(e,t){var r=(t=t||{}).dynamicTyping||!1;if(S(r)&&(t.dynamicTypingFunction=r,r={}),t.dynamicTyping=r,t.transform=!!S(t.transform)&&t.transform,!t.worker||!h.WORKERS_SUPPORTED)return r=null,h.NODE_STREAM_INPUT,typeof e=="string"?(e=(o=>o.charCodeAt(0)!==65279?o:o.slice(1))(e),r=new(t.download?ie:H)(t)):e.readable===!0&&S(e.read)&&S(e.on)?r=new j(t):(k.File&&e instanceof File||e instanceof Object)&&(r=new se(t)),r.stream(e);(r=(()=>{var o;return!!h.WORKERS_SUPPORTED&&(o=(()=>{var s=k.URL||k.webkitURL||null,g=K.toString();return h.BLOB_URL||(h.BLOB_URL=s.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",g,")();"],{type:"text/javascript"})))})(),(o=new k.Worker(o)).onmessage=Y,o.id=P++,ne[o.id]=o)})()).userStep=t.step,r.userChunk=t.chunk,r.userComplete=t.complete,r.userError=t.error,t.step=S(t.step),t.chunk=S(t.chunk),t.complete=S(t.complete),t.error=S(t.error),delete t.worker,r.postMessage({input:e,config:t,workerId:r.id})},h.unparse=function(e,t){var r=!1,o=!0,s=",",g=`\r
`,I='"',F=I+I,L=!1,d=null,E=!1,u=((()=>{if(typeof t=="object"){if(typeof t.delimiter!="string"||h.BAD_DELIMITERS.filter(function(a){return t.delimiter.indexOf(a)!==-1}).length||(s=t.delimiter),typeof t.quotes!="boolean"&&typeof t.quotes!="function"&&!Array.isArray(t.quotes)||(r=t.quotes),typeof t.skipEmptyLines!="boolean"&&typeof t.skipEmptyLines!="string"||(L=t.skipEmptyLines),typeof t.newline=="string"&&(g=t.newline),typeof t.quoteChar=="string"&&(I=t.quoteChar),typeof t.header=="boolean"&&(o=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");d=t.columns}t.escapeChar!==void 0&&(F=t.escapeChar+I),t.escapeFormulae instanceof RegExp?E=t.escapeFormulae:typeof t.escapeFormulae=="boolean"&&t.escapeFormulae&&(E=/^[=+\-@\t\r].*$/)}})(),new RegExp(V(I),"g"));if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return A(null,e,L);if(typeof e[0]=="object")return A(d||Object.keys(e[0]),e,L)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||d),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:typeof e.data[0]=="object"?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||typeof e.data[0]=="object"||(e.data=[e.data])),A(e.fields||[],e.data||[],L);throw new Error("Unable to serialize unrecognized input");function A(a,n,f){var v="",b=(typeof a=="string"&&(a=JSON.parse(a)),typeof n=="string"&&(n=JSON.parse(n)),Array.isArray(a)&&0<a.length),T=!Array.isArray(n[0]);if(b&&o){for(var p=0;p<a.length;p++)0<p&&(v+=s),v+=i(a[p],p);0<n.length&&(v+=g)}for(var m=0;m<n.length;m++){var C=(b?a:n[m]).length,c=!1,R=b?Object.keys(n[m]).length===0:n[m].length===0;if(f&&!b&&(c=f==="greedy"?n[m].join("").trim()==="":n[m].length===1&&n[m][0].length===0),f==="greedy"&&b){for(var D=[],_=0;_<C;_++){var w=T?a[_]:_;D.push(n[m][w])}c=D.join("").trim()===""}if(!c){for(var y=0;y<C;y++){0<y&&!R&&(v+=s);var N=b&&T?a[y]:y;v+=i(n[m][N],y)}m<n.length-1&&(!f||0<C&&!R)&&(v+=g)}}return v}function i(a,n){var f,v;return a==null?"":a.constructor===Date?JSON.stringify(a).slice(1,25):(v=!1,E&&typeof a=="string"&&E.test(a)&&(a="'"+a,v=!0),f=a.toString().replace(u,F),(v=v||r===!0||typeof r=="function"&&r(a,n)||Array.isArray(r)&&r[n]||((b,T)=>{for(var p=0;p<T.length;p++)if(-1<b.indexOf(T[p]))return!0;return!1})(f,h.BAD_DELIMITERS)||-1<f.indexOf(s)||f.charAt(0)===" "||f.charAt(f.length-1)===" ")?I+f+I:f)}},h.RECORD_SEP="",h.UNIT_SEP="",h.BYTE_ORDER_MARK="\uFEFF",h.BAD_DELIMITERS=["\r",`
`,'"',h.BYTE_ORDER_MARK],h.WORKERS_SUPPORTED=!Z&&!!k.Worker,h.NODE_STREAM_INPUT=1,h.LocalChunkSize=10485760,h.RemoteChunkSize=5242880,h.DefaultDelimiter=",",h.Parser=he,h.ParserHandle=oe,h.NetworkStreamer=ie,h.FileStreamer=se,h.StringStreamer=H,h.ReadableStreamStreamer=j,k.jQuery&&(($=k.jQuery).fn.parse=function(e){var t=e.config||{},r=[];return this.each(function(g){if(!($(this).prop("tagName").toUpperCase()==="INPUT"&&$(this).attr("type").toLowerCase()==="file"&&k.FileReader)||!this.files||this.files.length===0)return!0;for(var I=0;I<this.files.length;I++)r.push({file:this.files[I],inputElem:this,instanceConfig:$.extend({},t)})}),o(),this;function o(){if(r.length===0)S(e.complete)&&e.complete();else{var g,I,F,L,d=r[0];if(S(e.before)){var E=e.before(d.file,d.inputElem);if(typeof E=="object"){if(E.action==="abort")return g="AbortError",I=d.file,F=d.inputElem,L=E.reason,void(S(e.error)&&e.error({name:g},I,F,L));if(E.action==="skip")return void s();typeof E.config=="object"&&(d.instanceConfig=$.extend(d.instanceConfig,E.config))}else if(E==="skip")return void s()}var u=d.instanceConfig.complete;d.instanceConfig.complete=function(A){S(u)&&u(A,d.file,d.inputElem),s()},h.parse(d.file,d.instanceConfig)}}function s(){r.splice(0,1),o()}}),re&&(k.onmessage=function(e){e=e.data,h.WORKER_ID===void 0&&e&&(h.WORKER_ID=e.workerId),typeof e.input=="string"?k.postMessage({workerId:h.WORKER_ID,results:h.parse(e.input,e.config),finished:!0}):(k.File&&e.input instanceof File||e.input instanceof Object)&&(e=h.parse(e.input,e.config))&&k.postMessage({workerId:h.WORKER_ID,results:e,finished:!0})}),(ie.prototype=Object.create(q.prototype)).constructor=ie,(se.prototype=Object.create(q.prototype)).constructor=se,(H.prototype=Object.create(H.prototype)).constructor=H,(j.prototype=Object.create(q.prototype)).constructor=j,h})})(ve);var Re=ve.exports;const ye=be(Re),je=({context:ce,config:G={}})=>{const{file:K,state:k}=ce,{pageSize:$=50,maxPreviewRows:Z=1e3,autoDetectDelimiter:re=!0,autoDetectEncoding:ne=!0}=G,[P,h]=B.useState(null),[q,ie]=B.useState(!0),[se,H]=B.useState(null),[j,oe]=B.useState(1),[V,he]=B.useState(""),[Y,ge]=B.useState(null),[ae,le]=B.useState("asc"),[W,S]=B.useState({}),[e,t]=B.useState(","),[r,o]=B.useState("utf-8"),[s,g]=B.useState("");B.useEffect(()=>{if(k.state!=="loaded"||!K.url)return;(async()=>{try{ie(!0),H(null),console.log("📊 开始解析 CSV 文件:",K.url);const a=await fetch(K.url);if(!a.ok)throw new Error(`文件加载失败: ${a.status} ${a.statusText}`);let n=await a.text();if(console.log("📄 文件内容长度:",n.length),ne){const f=F(n);f!=="utf-8"&&(console.log("🔍 检测到编码:",f),o(f))}if(re&&!s){const f=I(n);console.log("🔍 检测到分隔符:",f),t(f)}else s&&t(s);ye.parse(n,{delimiter:e,header:!1,skipEmptyLines:!0,complete:f=>{console.log("✅ CSV 解析完成:",f),f.errors.length>0&&console.warn("⚠️ 解析警告:",f.errors);const v=f.data;if(v.length===0){H("文件为空或格式不正确");return}const b=v[0]||[],T=v.slice(1),p=T.length;console.log("📊 解析结果:",{headers:b.length,rows:p,preview:T.slice(0,3)}),h({headers:b,rows:T.slice(0,Z),totalRows:Math.min(p,Z)})},error:f=>{console.error("❌ CSV 解析错误:",f),H(`解析失败: ${f.message}`)}})}catch(a){console.error("❌ 文件加载错误:",a),H(`文件加载失败: ${a.message}`)}finally{ie(!1)}})()},[K.url,k.state,e,re,ne,Z,s]);const I=i=>{const a=[",",";","	","|"],n=i.substring(0,2e3);let f=",",v=0;for(const b of a){const T=(n.match(new RegExp(`\\${b}`,"g"))||[]).length,m=n.split(`
`).slice(0,10).map(_=>(_.match(new RegExp(`\\${b}`,"g"))||[]).length).filter(_=>_>0);if(m.length===0)continue;const C=m.reduce((_,w)=>_+w,0)/m.length,c=m.reduce((_,w)=>_+Math.pow(w-C,2),0)/m.length,R=1/(1+Math.sqrt(c)),D=T*R;D>v&&(v=D,f=b)}return console.log("🔍 分隔符检测结果:",{detected:f,score:v,sample:n.substring(0,100)}),f},F=i=>i.includes("")?"gbk":"utf-8",L=B.useMemo(()=>{if(!P)return null;let i=P.rows;if(V&&(i=i.filter(a=>a.some(n=>String(n).toLowerCase().includes(V.toLowerCase())))),Y&&P.headers.includes(Y)){const a=P.headers.indexOf(Y);i=[...i].sort((n,f)=>{const v=n[a]||"",b=f[a]||"";return ae==="asc"?String(v).localeCompare(String(b)):String(b).localeCompare(String(v))})}return{...P,rows:i}},[P,V,Y,ae]),d=B.useMemo(()=>{if(!L)return null;const i=(j-1)*$,a=i+$,n=Math.ceil(L.rows.length/$);return{...L,rows:L.rows.slice(i,a),totalPages:n,currentPage:j,startIndex:i+1,endIndex:Math.min(a,L.rows.length)}},[L,j,$]),E=i=>{Y===i?le(ae==="asc"?"desc":"asc"):(ge(i),le("asc"))},u=(i,a)=>{S(n=>({...n,[i]:Math.max(50,a)}))},A=()=>{if(!P)return;const i=ye.unparse({fields:P.headers,data:P.rows}),a=new Blob([i],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(a),n.download=K.name.replace(/\.[^/.]+$/,".csv"),n.click()};return q?l.jsx("div",{style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#f8f9fa",color:"#6c757d"},children:l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"📊"}),l.jsx("div",{children:"Loading CSV..."})]})}):se?l.jsx("div",{style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#f8f9fa",color:"#dc3545"},children:l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"❌"}),l.jsxs("div",{children:["Error: ",se]})]})}):!P||!d?l.jsx("div",{style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#f8f9fa",color:"#6c757d"},children:l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"📊"}),l.jsx("div",{children:"No CSV data available"})]})}):l.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[l.jsxs("div",{style:{background:"#f8f9fa",borderBottom:"1px solid #dee2e6",padding:"12px 16px",display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap"},children:[l.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:l.jsx("input",{type:"text",placeholder:"搜索...",value:V,onChange:i=>he(i.target.value),style:{padding:"6px 12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",width:"200px"}})}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[l.jsx("label",{style:{fontSize:"12px",color:"#666"},children:"分隔符:"}),l.jsxs("select",{value:e,onChange:i=>{t(i.target.value),g(i.target.value)},style:{padding:"4px 8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"12px"},children:[l.jsx("option",{value:",",children:"逗号 (,)"}),l.jsx("option",{value:";",children:"分号 (;)"}),l.jsx("option",{value:"\\t",children:"制表符 (Tab)"}),l.jsx("option",{value:"|",children:"竖线 (|)"})]}),re&&!s&&l.jsx("span",{style:{fontSize:"10px",color:"#28a745",fontWeight:"500"},children:"🔍 自动检测"}),s&&l.jsx("button",{onClick:()=>{g(""),t(",")},style:{padding:"2px 6px",fontSize:"10px",backgroundColor:"#f8f9fa",border:"1px solid #ddd",borderRadius:"3px",cursor:"pointer",color:"#666"},title:"重置为自动检测",children:"🔄 重置"})]}),l.jsx("div",{style:{flex:1}}),l.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:["显示 ",d.startIndex,"-",d.endIndex," /"," ",P.totalRows," 行"]}),l.jsx("button",{onClick:A,style:{padding:"6px 12px",backgroundColor:"#007acc",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"📥 导出 CSV"})]}),l.jsx("div",{style:{flex:1,overflow:"auto",background:"#fff"},children:l.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"13px",fontFamily:"monospace"},children:[l.jsx("thead",{style:{background:"#f8f9fa",position:"sticky",top:0,zIndex:1},children:l.jsx("tr",{children:P.headers.map((i,a)=>l.jsxs("th",{onClick:()=>E(i),style:{padding:"8px 12px",textAlign:"left",borderBottom:"2px solid #dee2e6",cursor:"pointer",userSelect:"none",minWidth:W[i]||100,position:"relative",background:Y===i?"#e3f2fd":"#f8f9fa"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[l.jsx("span",{children:i||`列 ${a+1}`}),Y===i&&l.jsx("span",{style:{fontSize:"10px"},children:ae==="asc"?"↑":"↓"})]}),l.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:"4px",cursor:"col-resize",background:"transparent"},onMouseDown:n=>{n.preventDefault();const f=n.clientX,v=W[i]||100,b=p=>{const m=v+(p.clientX-f);u(i,m)},T=()=>{document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",T)};document.addEventListener("mousemove",b),document.addEventListener("mouseup",T)}})]},a))})}),l.jsx("tbody",{children:d.rows.map((i,a)=>l.jsx("tr",{style:{borderBottom:"1px solid #eee"},onMouseEnter:n=>{n.currentTarget.style.background="#f8f9fa"},onMouseLeave:n=>{n.currentTarget.style.background="transparent"},children:i.map((n,f)=>l.jsx("td",{style:{padding:"6px 12px",borderRight:"1px solid #eee",minWidth:W[P.headers[f]]||100,maxWidth:"300px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:String(n),children:String(n||"")},f))},a))})]})}),d.totalPages>1&&l.jsxs("div",{style:{background:"#f8f9fa",borderTop:"1px solid #dee2e6",padding:"12px 16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[l.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:["第 ",j," 页，共 ",d.totalPages," 页"]}),l.jsxs("div",{style:{display:"flex",gap:"8px"},children:[l.jsx("button",{onClick:()=>oe(1),disabled:j===1,style:{padding:"4px 8px",border:"1px solid #ddd",background:"white",borderRadius:"4px",cursor:j===1?"not-allowed":"pointer",opacity:j===1?.5:1,fontSize:"12px"},children:"首页"}),l.jsx("button",{onClick:()=>oe(Math.max(1,j-1)),disabled:j===1,style:{padding:"4px 8px",border:"1px solid #ddd",background:"white",borderRadius:"4px",cursor:j===1?"not-allowed":"pointer",opacity:j===1?.5:1,fontSize:"12px"},children:"上一页"}),l.jsx("button",{onClick:()=>oe(Math.min(d.totalPages,j+1)),disabled:j===d.totalPages,style:{padding:"4px 8px",border:"1px solid #ddd",background:"white",borderRadius:"4px",cursor:j===d.totalPages?"not-allowed":"pointer",opacity:j===d.totalPages?.5:1,fontSize:"12px"},children:"下一页"}),l.jsx("button",{onClick:()=>oe(d.totalPages),disabled:j===d.totalPages,style:{padding:"4px 8px",border:"1px solid #ddd",background:"white",borderRadius:"4px",cursor:j===d.totalPages?"not-allowed":"pointer",opacity:j===d.totalPages?.5:1,fontSize:"12px"},children:"末页"})]})]})]})};function Ie(ce){return{name:"CsvPreviewPlugin",version:"1.0.0",description:"CSV/TSV 表格预览插件，支持分页、筛选、排序、导出",supportedTypes:["text/csv","application/csv","text/tab-separated-values","text/plain"],supportedExtensions:[".csv",".tsv",".txt"],hooks:{getPriority:()=>7,render:G=>l.jsx(je,{context:G,config:ce}),renderToolbar:G=>{const K=()=>{const k=document.createElement("a");k.href=G.file.url,k.download=G.file.name,k.click()};return l.jsxs(ke,{children:[l.jsx(Se,{name:G.file.name,size:G.file.size,type:"CSV",icon:"📊"}),l.jsx(Ee,{}),l.jsx(Ce,{onClick:K,icon:"📥",title:"Download",children:"Download"})]})}}}}export{Ie as c};
