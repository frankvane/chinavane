import{u as F,r as n,j as r,_ as P,R as S}from"./index-HctDrVfM.js";import{h as V,t as H}from"./tomorrow-CRMQJKJ-.js";const N=(i,m,D)=>{const a=i[m];return a?typeof a=="function"?a():Promise.resolve(a):new Promise((v,w)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(w.bind(null,new Error("Unknown variable dynamic import: "+m+(m.split("/").length!==D?". Note that variables only represent file names one level deep.":""))))})},z={"/file-preview/image":"ImagePreviewDemo","/file-preview/pdf":"PdfPreviewDemo","/file-preview/video":"VideoPreviewDemo","/file-preview/audio":"AudioPreviewDemo","/file-preview/code":"CodePreviewDemo","/file-preview/markdown":"MarkdownPreviewDemo","/file-preview/office":"OfficePreviewDemo","/file-preview/csv":"CsvPreviewDemo","/file-preview/json":"JsonPreviewDemo","/file-preview/zip":"ZipPreviewDemo","/file-preview/epub":"EpubPreviewDemo","/fp-plugin/example":"Example"},J=({title:i,description:m,children:D})=>{const a=F(),[v,w]=n.useState(""),[o,y]=n.useState(!1);n.useEffect(()=>{(async()=>{const t=z[a.pathname];if(t)try{const u=await N(Object.assign({"../AudioPreviewDemo.tsx":()=>P(()=>import("./AudioPreviewDemo-6Q-7ScCr.js"),[],import.meta.url),"../CodePreviewDemo.tsx":()=>P(()=>import("./CodePreviewDemo-C9CZklgA.js"),[],import.meta.url),"../CsvPreviewDemo.tsx":()=>P(()=>import("./CsvPreviewDemo-BveMd0WO.js"),[],import.meta.url),"../EpubPreviewDemo.tsx":()=>P(()=>import("./EpubPreviewDemo-C4O6apVO.js"),[],import.meta.url),"../Example.tsx":()=>P(()=>import("./Example-LPgmykH4.js"),[],import.meta.url),"../Home.tsx":()=>P(()=>import("./Home-aFc5A3XB.js"),[],import.meta.url),"../ImagePreviewDemo.tsx":()=>P(()=>import("./ImagePreviewDemo-D2aVrKlm.js"),[],import.meta.url),"../JsonPreviewDemo.tsx":()=>P(()=>import("./JsonPreviewDemo-BV-H63hk.js"),[],import.meta.url),"../MarkdownPreviewDemo.tsx":()=>P(()=>import("./MarkdownPreviewDemo-4AXgRCEV.js"),[],import.meta.url),"../OfficePreviewDemo.tsx":()=>P(()=>import("./OfficePreviewDemo-wbsLtfxZ.js"),[],import.meta.url),"../PdfPreviewDemo.tsx":()=>P(()=>import("./PdfPreviewDemo-Wvqn0BQz.js"),[],import.meta.url),"../ReadmeDemo.tsx":()=>P(()=>import("./ReadmeDemo-DERvQzn5.js"),[],import.meta.url),"../VideoPreviewDemo.tsx":()=>P(()=>import("./VideoPreviewDemo-BEU9Agda.js"),[],import.meta.url),"../ZipPreviewDemo.tsx":()=>P(()=>import("./ZipPreviewDemo-CFXHV5di.js"),[],import.meta.url)}),`../${t}.tsx`,2);w(u.default)}catch(u){console.error("加载源码失败:",u),w("// 源码加载失败")}})()},[a.pathname]);const f=async()=>{try{await navigator.clipboard.writeText(v),y(!0),setTimeout(()=>y(!1),2e3)}catch(e){console.error("复制失败:",e)}};return r.jsxs("div",{className:"page",children:[r.jsxs("div",{className:"page-header",children:[r.jsx("h1",{className:"page-title",children:i}),m?r.jsx("p",{className:"page-desc",children:m}):null]}),r.jsx("div",{className:"page-card",children:D}),v&&r.jsxs("div",{className:"page-card",style:{marginTop:"20px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[r.jsx("h2",{style:{margin:0,fontSize:"1.2em"},children:"源码"}),r.jsx("button",{onClick:f,style:{padding:"8px 16px",background:o?"#27ae60":"#3498db",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:500,transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px"},onMouseEnter:e=>{o||(e.currentTarget.style.background="#2980b9")},onMouseLeave:e=>{o||(e.currentTarget.style.background="#3498db")},children:o?r.jsxs(r.Fragment,{children:[r.jsx("span",{children:"✓"}),r.jsx("span",{children:"已复制"})]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{children:"📋"}),r.jsx("span",{children:"复制代码"})]})})]}),r.jsx(V,{language:"tsx",style:H,showLineNumbers:!0,wrapLines:!0,wrapLongLines:!0,customStyle:{borderRadius:"4px",fontSize:"14px",lineHeight:"1.5",margin:0},children:v})]})]})},$=n.forwardRef((i,m)=>{const{file:D,onBeforeLoad:a,onLoadStart:v,onLoadSuccess:w,onLoadError:o,children:y,containerStyle:f,containerClassName:e,contentStyle:t,contentClassName:u}=i,l=n.useRef(null),_=n.useRef(null),[d,p]=n.useState({state:"idle"}),b=n.useCallback(async()=>{if(!(d.state==="loading"||d.state==="loaded")){p({state:"loading"}),v==null||v();try{if(await Promise.resolve(a==null?void 0:a())===!1){p({state:"idle"});return}p({state:"loaded"}),w==null||w()}catch(E){const h=E instanceof Error?E:new Error(String(E));p({state:"error",error:h,message:h.message}),o==null||o(h)}}},[d.state,a,v,w,o]);n.useEffect(()=>{b()},[b]),n.useImperativeHandle(m,()=>({reload:()=>{p({state:"idle"}),b()},reset:()=>{p({state:"idle"})},getState:()=>d}),[b,d]);const j=n.useMemo(()=>({position:"relative",width:"100%",height:"100%",overflow:"hidden",background:d.state==="error"?"#fee":"#fafafa",display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"flex-start",...f}),[f,d.state]),g=n.useMemo(()=>({width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"flex-start",overflow:"hidden",...t}),[t]);return r.jsxs("div",{ref:E=>{l.current=E,i.containerRefExternal&&(i.containerRefExternal.current=E)},className:e,style:j,children:[d.state==="loading"&&r.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",zIndex:2},children:r.jsx("span",{style:{color:"#999",fontSize:14},children:"Loading..."})}),d.state==="error"&&r.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#d32f2f",zIndex:2},children:[r.jsx("span",{style:{fontSize:14,marginBottom:8},children:"❌ Load Failed"}),d.message&&r.jsx("span",{style:{fontSize:12,color:"#666"},children:d.message})]}),r.jsx("div",{ref:E=>{_.current=E,i.contentRefExternal&&(i.contentRefExternal.current=E)},className:u,style:g,children:y})]})});$.displayName="FilePreviewCore";function B(){const i=new Map,m=new Map;return{emit:(o,y)=>{const f=i.get(o);f&&f.forEach(e=>{try{e(y)}catch(t){console.warn(`[PluginBus] Error in event handler for "${o}"`,t)}})},on:(o,y)=>(i.has(o)||i.set(o,[]),i.get(o).push(y),()=>{const f=i.get(o);if(!f)return;const e=f.indexOf(y);e>-1&&f.splice(e,1)}),getData:o=>m.get(o),setData:(o,y)=>{m.set(o,y)}}}function W(){const i=new Map,m=e=>{i.set(e.name,e),e.init&&Promise.resolve(e.init()).catch(t=>{console.warn(`[PluginManager] init failed for ${e.name}`,t)})},D=e=>{const t=i.get(e);t&&(t.destroy&&Promise.resolve(t.destroy()).catch(u=>{console.warn(`[PluginManager] destroy failed for ${t.name}`,u)}),i.delete(e))},a=e=>i.get(e),v=()=>Array.from(i.values()),w=async e=>{const t=Array.from(i.values()),u=[];for(const l of t){if(!(l.hooks.canHandle?await Promise.resolve(l.hooks.canHandle(e)):o(l,e)))continue;const d=l.hooks.getPriority?l.hooks.getPriority(e):0;u.push({plugin:l,priority:d})}return u.length===0?null:(u.sort((l,_)=>_.priority-l.priority),u[0].plugin)},o=(e,t)=>{const{supportedTypes:u,supportedExtensions:l}=e;return!!(u&&u.length>0&&u.some(_=>y(t.type,_))||l&&l.length>0&&l.some(_=>t.extension.toLowerCase().endsWith(_.toLowerCase())))},y=(e,t)=>{if(t==="*/*")return!0;if(t.endsWith("/*")){const u=t.slice(0,-2);return e.startsWith(u)}return e===t};return{register:m,unregister:D,getPlugin:a,getAllPlugins:v,findPluginForFile:w,executeHook:async(e,t,...u)=>{const l=Array.from(i.values());for(const _ of l){const d=_.hooks[e];if(d)try{const p=await Promise.resolve(d(t,...u));if(p===!1)return!1;if(p!==void 0&&p!==!0)return p}catch(p){console.warn(`[PluginManager] hook ${String(e)} failed in ${_.name}`,p)}}}}}function K(i,m){const D=Array.isArray(m)?{plugins:m,enableDebug:!1}:m,{plugins:a,enableDebug:v=!1}=D,w=n.forwardRef((o,y)=>{const{file:f}=o,t=n.useRef(W()).current,l=n.useRef(B()).current,_=n.useRef(null),d=n.useRef(null),[p]=n.useState(()=>new Map);n.useRef(p);const[b,j]=n.useState({state:"idle"}),[g,E]=n.useState(null);n.useEffect(()=>(a.forEach(s=>{t.register(s)}),()=>{a.forEach(s=>t.unregister(s.name))}),[a]),n.useEffect(()=>{(async()=>{const c=await t.findPluginForFile(f);E(c),c||j({state:"unsupported",message:`No plugin found for file type: ${f.type}`})})()},[f]),n.useEffect(()=>{if(v){const s=a.map(c=>c.name);console.debug("[withPlugins] active plugins:",s),console.debug("[withPlugins] active plugin for file:",g==null?void 0:g.name)}},[v,a,g]);const h=n.useMemo(()=>({file:f,state:b,containerRef:_,contentRef:d,bus:l,sharedData:p}),[f,b,l,p]);n.useEffect(()=>{const s=[];return a.forEach(c=>{var R,k;const x=(k=(R=c.hooks).onMount)==null?void 0:k.call(R,h);x&&s.push(x)}),()=>{a.forEach(c=>{var x,R;return(R=(x=c.hooks).onUnmount)==null?void 0:R.call(x,h)}),s.forEach(c=>typeof c=="function"&&c())}},[]);const M=n.useMemo(()=>{var c,x;if(!g)return null;const s=(x=(c=g.hooks).render)==null?void 0:x.call(c,h);return s?r.jsx(S.Fragment,{children:s},`plugin-render-${g.name}`):null},[h,g]),[L,T]=n.useState(0);n.useEffect(()=>{const s=()=>{T(x=>x+1)},c=l==null?void 0:l.on("sharedDataChanged",s);return()=>{c==null||c()}},[l]);const C=n.useMemo(()=>{var c,x;if(!g)return null;const s=(x=(c=g.hooks).renderToolbar)==null?void 0:x.call(c,h);return s?r.jsx(S.Fragment,{children:s},`plugin-toolbar-${g.name}-${L}`):null},[h,g,L]),I=(g==null?void 0:g.name)==="PdfPreviewPlugin",A=n.useMemo(()=>a.map((s,c)=>{var R,k;const x=(k=(R=s.hooks).renderOverlay)==null?void 0:k.call(R,h);return x?r.jsx(S.Fragment,{children:x},`plugin-overlay-${s.name}-${c}`):null}).filter(Boolean),[h,a]),O={...o,containerRefExternal:_,contentRefExternal:d,children:r.jsxs(r.Fragment,{children:[C&&r.jsx("div",{style:{position:"sticky",top:0,zIndex:10,display:"flex",gap:8,padding:8,background:"rgba(255, 255, 255, 0.95)",borderBottom:"1px solid #e0e0e0",flexShrink:0,backdropFilter:"blur(8px)"},children:C}),r.jsxs("div",{style:{flex:1,minHeight:0,overflow:"hidden"},children:[r.jsx("div",{style:{height:"100%",width:"100%",overflow:I?"hidden":"auto",overscrollBehavior:I?"none":"contain",boxSizing:"border-box"},children:M}),A,o.children]})]}),onBeforeLoad:async()=>await t.executeHook("onBeforeLoad",h)!==!1,onLoadStart:()=>{j({state:"loading"}),t.executeHook("onLoadStart",h).catch(()=>{})},onLoadSuccess:()=>{j({state:"loaded"}),t.executeHook("onLoadSuccess",h).catch(()=>{})},onLoadError:s=>{j({state:"error",error:s,message:s.message}),t.executeHook("onLoadError",h,s).catch(()=>{})}};return r.jsx(i,{ref:y,...O})});return w.displayName="WithPlugins(FilePreviewCore)",w}export{J as D,$ as F,K as w};
