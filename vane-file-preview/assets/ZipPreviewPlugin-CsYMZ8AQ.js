import{j as e,r as d}from"./index-yyTIZa1r.js";import{J as z}from"./jszip.min-DpW3x3L_.js";const v=({context:o})=>{const{file:l,state:c}=o,[t,p]=d.useState([]),[n,u]=d.useState(!0),[f,x]=d.useState(null);return d.useEffect(()=>{(async()=>{try{u(!0),x(null);const r=await fetch(l.url);if(!r.ok)throw new Error(`HTTP ${r.status}`);const y=await r.arrayBuffer(),j=await z.loadAsync(y),h=Object.values(j.files).map(i=>{var g,m;const a=((g=i==null?void 0:i._data)==null?void 0:g.uncompressedSize)??((m=i==null?void 0:i._data)==null?void 0:m.compressedSize)??0;return{name:i.name,isDirectory:!!i.dir,size:a}});h.sort((i,a)=>i.isDirectory!==a.isDirectory?i.isDirectory?-1:1:i.name.localeCompare(a.name)),p(h)}catch(r){x(r instanceof Error?r.message:"Failed to load zip")}finally{u(!1)}})()},[l.url]),c.state!=="loaded"&&c.state!=="loading"?null:n?e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",flexDirection:"column",gap:16},children:[e.jsx("div",{style:{fontSize:24},children:"📦"}),e.jsx("div",{children:"Loading zip contents..."})]}):f?e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",flexDirection:"column",gap:16,color:"#d32f2f"},children:[e.jsx("div",{style:{fontSize:24},children:"❌"}),e.jsxs("div",{children:["Error: ",f]})]}):e.jsx("div",{style:{padding:16,height:"100%",overflow:"auto",background:"#fafafa"},children:e.jsxs("div",{style:{background:"#fff",borderRadius:8,padding:16,boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[e.jsxs("h3",{style:{margin:"0 0 16px",fontSize:16,color:"#333"},children:["📦 ",l.name]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:t.map((s,r)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"8px 12px",background:s.isDirectory?"#f0f0f0":"#fff",border:"1px solid #e0e0e0",borderRadius:4,fontSize:14},children:[e.jsx("span",{style:{marginRight:8},children:s.isDirectory?"📁":"📄"}),e.jsx("span",{style:{flex:1,wordBreak:"break-all"},children:s.name}),!s.isDirectory&&e.jsx("span",{style:{color:"#666",fontSize:12},children:s.size>0?`${(s.size/1024).toFixed(1)} KB`:"—"})]},r))}),e.jsx("div",{style:{marginTop:16,padding:12,background:"#f5f5f5",borderRadius:4,fontSize:12,color:"#666"},children:"说明：当前展示为 zip 内容列表。若需要在线预览某些文本文件，可在此基础上按需增加点击后解析小文件的预览逻辑。"})]})})};function k(o={}){const{showFileSize:l=!0,maxFiles:c=100}=o;return{name:"ZipPreviewPlugin",version:"1.0.0",description:"Zip archive preview with file listing",supportedTypes:["application/zip","application/x-zip-compressed"],supportedExtensions:[".zip",".rar",".7z"],config:o,hooks:{getPriority:()=>8,render:t=>e.jsx(v,{context:t}),renderToolbar:t=>{const p=()=>{const n=document.createElement("a");n.href=t.file.url,n.download=t.file.name,n.click()};return e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs("span",{style:{fontSize:12,color:"#666",padding:"4px 8px"},children:["📦 ",t.file.name]}),e.jsx("button",{onClick:p,style:b,children:"📥 Download"})]})}}}}const b={padding:"4px 12px",border:"1px solid #ddd",borderRadius:4,background:"#fff",cursor:"pointer",fontSize:14};export{k as c};
